(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["minePages-chat-chat"],{"0de3":function(e,t,n){"use strict";function i(e,n){return t.default=i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,n)}n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=i,n("131a")},1696:function(e,t,n){"use strict";(function(e,i,s){var a=n("ee27").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("2c4c")),o=a(n("fbf1")),u=a(n("f20d")),c=a(n("c964")),l=a(n("920b")),f=a(n("92a6")),d=a(n("54f8")),h=a(n("f07e")),p=a(n("0122")),v=a(n("fc11")),m=a(n("276c")),g=a(n("e954"));n("6c579"),n("7a82"),n("d3b7"),n("159b"),n("b64b"),n("e439"),n("14d9"),n("a434"),n("fb6a"),n("d9e2"),n("d401"),n("6062"),n("3ca3"),n("ddb0"),n("7db0"),n("caad6"),n("2532"),n("a630"),n("acd8"),n("498a"),n("ac1f"),n("00b4"),n("25f0"),n("dca8"),n("ace4"),n("5cc6"),n("907a"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("986a"),n("1d02"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("b39a"),n("72f7"),n("5319"),n("e9c4"),n("8ba4"),n("a9e3"),n("e25e"),n("99af"),n("c975"),n("4ec9"),n("3c65"),n("c740"),n("1276"),n("4d63"),n("c607"),n("2c3e"),n("466d"),n("c19f"),n("f4b3"),n("bf19"),n("d81d"),n("a4d3"),n("e01a"),n("5377"),n("2ca0"),n("33d1"),n("ea98"),n("4de4"),n("4e82"),n("07ac"),n("2b3d"),n("9861");var y="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof e?e:"undefined"!=typeof self?self:{};function b(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})})),t}var k={exports:{}};!function(e){function t(e){if(e)return function(e){for(var n in t.prototype)e[n]=t.prototype[n];return e}(e)}k.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},t.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var s=0;s<i.length;s++)if((n=i[s])===t||n.fn===t){i.splice(s,1);break}return this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var i=0,s=(n=n.slice(0)).length;i<s;++i)n[i].apply(this,t);return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}}();var E,S,w,C=k.exports,M=function(){function e(){(0,m.default)(this,e),this.emitter=new C}return(0,g.default)(e,[{key:"on",value:function(e,t){return this.emitter.on(e,t),this}},{key:"once",value:function(e,t){return this.emitter.once(e,t),this}},{key:"off",value:function(e,t){return this.emitter.off(e,t),this}},{key:"fire",value:function(e,t){return this.emitter.emit(e,t),this}}]),e}(),I=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,null,[{key:"initial",value:function(){this.eventDriver=new M}},{key:"on",value:function(e,t){this.eventDriver.on(e,t)}},{key:"off",value:function(e,t){this.eventDriver.off(e,t)}},{key:"once",value:function(e,t){this.eventDriver.once(e,t)}},{key:"fire",value:function(e,t){this.eventDriver.fire(e,t)}}]),e}();!function(e){e.BROWSER="BROWSER",e.UNKNOWN="UNKNOWN",e.APP_IOS="APP_IOS",e.APP_ANDROID="APP_ANDROID",e.APPLET_WX="APPLET_WX",e.APPLET_WX_GAME="APPLET_WX_GAME",e.APPLET_ALIPAY="APPLET_ALIPAY",e.APPLET_BYTEDANCE="APPLET_BYTEDANCE"}(E||(E={}));var A=function(){function e(){var t;(0,m.default)(this,e),this.platform=null,this.methods=(t={},(0,v.default)(t,E.BROWSER,this.isBrowser),(0,v.default)(t,E.APP_IOS,this.isAppiOS),(0,v.default)(t,E.APP_ANDROID,this.isAppAndroid),(0,v.default)(t,E.APPLET_WX,this.isWXApplet),(0,v.default)(t,E.APPLET_WX_GAME,this.isWXGameApplet),t);for(var n=this.methods,i=Object.keys(n),s=0,a=i;s<a.length;s++){var r=a[s];if((0,n[r])()){this.platform=r;break}}this.platform=this.platform||E.UNKNOWN,this.platform}return(0,g.default)(e,[{key:"isBrowser",value:function(){return"undefined"!=typeof navigator&&"Taro"!==navigator.product&&"ReactNative"!==navigator.product&&"undefined"==typeof GameGlobal&&("undefined"==typeof cc||null!==cc.sys.browserType)}},{key:"isAppiOS",value:function(){return"undefined"!=typeof cc&&cc.sys.isNative&&cc.sys.isMobile&&"iOS"===cc.sys.os||"object"==("undefined"===typeof uni?"undefined":(0,p.default)(uni))&&!!uni.getSystemInfoSync&&"ios"===uni.getSystemInfoSync().platform&&"object"==("undefined"===typeof plus?"undefined":(0,p.default)(plus))}},{key:"isAppAndroid",value:function(){return"undefined"!=typeof cc&&cc.sys.isNative&&cc.sys.isMobile&&"Android"===cc.sys.os||"object"==("undefined"===typeof uni?"undefined":(0,p.default)(uni))&&!!uni.getSystemInfoSync&&"android"===uni.getSystemInfoSync().platform&&"object"==("undefined"===typeof plus?"undefined":(0,p.default)(plus))}},{key:"isWXApplet",value:function(){return"object"==("undefined"===typeof wx?"undefined":(0,p.default)(wx))&&!!wx.getSystemInfoSync&&"undefined"==typeof WebSocket&&"undefined"==typeof XMLHttpRequest&&"undefined"==typeof plus}},{key:"isWXGameApplet",value:function(){return"object"==("undefined"===typeof GameGlobal?"undefined":(0,p.default)(GameGlobal))}},{key:"isAlipayApplet",value:function(){return!1}},{key:"isBytedanceApplet",value:function(){return!1}},{key:"isQQApplet",value:function(){return!1}},{key:"isBaiduApplet",value:function(){return!1}}],[{key:"currentPlatform",value:function(){return e.instance.platform}}]),e}();A.instance=new A,function(e){e.UNIAPP="UNIAPP",e.REACT_NATIVE="REACT_NATIVE",e.COCOS="COCOS",e.TARO="TARO",e.IONIC="IONIC",e.NATIVE_APPLET_WX="NATIVE_APPLET_WX",e.NATIVE_APPLET_ALIPAY="NATIVE_APPLET_ALIPAY",e.UNKNOWN="UNKNOWN"}(S||(S={}));var T=function(){function t(){var e;(0,m.default)(this,t),this.framework=null,this.methods=(e={},(0,v.default)(e,S.UNIAPP,this.isUniApp),(0,v.default)(e,S.REACT_NATIVE,this.isReactNative),(0,v.default)(e,S.TARO,this.isTaro),(0,v.default)(e,S.NATIVE_APPLET_WX,this.isWXApplet),(0,v.default)(e,S.COCOS,this.isCocos),e);for(var n=this.methods,i=Object.keys(n),s=0,a=i;s<a.length;s++){var r=a[s];if((0,n[r])()){this.framework=r;break}}this.framework=this.framework||S.UNKNOWN,this.framework}return(0,g.default)(t,[{key:"isUniApp",value:function(){return"object"==("undefined"===typeof uni?"undefined":(0,p.default)(uni))&&!!uni.getSystemInfoSync}},{key:"isReactNative",value:function(){return"undefined"!=typeof e&&e.__fbGenNativeModule}},{key:"isTaro",value:function(){return"undefined"!=typeof i&&void 0!==Object({NODE_ENV:"production",VUE_APP_DARK_MODE:"false",VUE_APP_INDEX_CSS_HASH:"2da1efab",VUE_APP_INDEX_DARK_CSS_HASH:"e6047db7",VUE_APP_NAME:"旅行·攻略",VUE_APP_PLATFORM:"h5",BASE_URL:"/"})&&void 0!==Object({NODE_ENV:"production",VUE_APP_DARK_MODE:"false",VUE_APP_INDEX_CSS_HASH:"2da1efab",VUE_APP_INDEX_DARK_CSS_HASH:"e6047db7",VUE_APP_NAME:"旅行·攻略",VUE_APP_PLATFORM:"h5",BASE_URL:"/"}).TARO_ENV}},{key:"isWXApplet",value:function(){return A.currentPlatform()===E.APPLET_WX&&"undefined"==typeof uni}},{key:"isCocos",value:function(){try{return void 0!==cc.sys.localStorage}catch(y){return!1}}}],[{key:"currentFramework",value:function(){return this.instance.framework}}]),t}();T.instance=new T;var _=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,null,[{key:"init",value:function(e){T.currentFramework()===S.REACT_NATIVE&&(this.validate(e),this.platform=e.platform,this.asyncStorage=e.asyncStorage)}},{key:"validate",value:function(e){if(!e)throw new Error("'reactNativeOptions' is missing when calling GoEasy.getInstance()");if(!e.platform)throw new Error("'platform' is missing in GoEasy 'reactNativeOptions'");if(!e.asyncStorage)throw new Error("'asyncStorage' is missing in GoEasy 'reactNativeOptions'")}}]),e}();!function(e){e.DISCONNECTED="disconnected",e.DISCONNECTING="disconnecting",e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.RECONNECTED="reconnected",e.EXPIRED_RECONNECTED="reconnected",e.CONNECT_FAILED="connect_failed"}(w||(w={}));var N,O,R="IM",x="PUBSUB",P=function(){function e(t){(0,m.default)(this,e),this.rocketsBuffer=new Set,this.socket=t,this.socket.addConnectedObserver(this.onSocketConnected.bind(this))}return(0,g.default)(e,[{key:"emit",value:function(e){this.socket.status!==w.DISCONNECTED?(e.start(),this.doEmit(e)):e.fail({resultCode:"409",content:"Please connect first"})}},{key:"doEmit",value:function(e){var t=this;if(!e.complete)if(this.socket.status!==w.CONNECT_FAILED)if(this.isConnected())if(this.hasPermission(e)){var n=setTimeout((function(){t.doEmit(e)}),e.singleTimeout);e.unique&&(e.params.retried=e.retried),this.socket.socketio().emit(e.name,e.params,(function(t){clearTimeout(n),200===t.resultCode||200==t.code?e.success(t):e.fail(t)})),e.retried++}else e.fail({resultCode:401,content:"No permission"});else this.isConnecting()&&this.rocketsBuffer.add(e);else e.fail({resultCode:408,content:"Failed to connect GoEasy."})}},{key:"hasPermission",value:function(e){return!!this.socket.permissions.find((function(t){return t===e.permission}))}},{key:"isConnected",value:function(){return[w.CONNECTED,w.RECONNECTED,w.EXPIRED_RECONNECTED].includes(this.socket.status)}},{key:"isConnecting",value:function(){return[w.CONNECTING,w.RECONNECTING].includes(this.socket.status)}},{key:"onSocketConnected",value:function(){this.emitBuffer()}},{key:"emitBuffer",value:function(){var e=this;Array.from(this.rocketsBuffer).forEach((function(t){e.rocketsBuffer.delete(t),e.doEmit(t)}))}}]),e}(),D=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,null,[{key:"i",value:function(e){this.socket=e,this.emitter=new P(e)}},{key:"s",value:function(){if(this.socket)return this.socket;throw new Error("Please connect first.")}},{key:"e",value:function(e){this.emitter.emit(e)}},{key:"u",value:function(){return this.s().userId}},{key:"ud",value:function(){return this.s().connectOptions.data}},{key:"supportIM",value:function(){return this.s().options.modules.includes(R)}}]),e}(),U="2.8.8";!function(e){e.PRIVATE="private",e.GROUP="group",e.SYSTEM="system",e.CS="cs"}(N||(N={})),function(e){e.NEW="new",e.SENDING="sending",e.SUCCESS="success",e.FAIL="fail"}(O||(O={}));var L=(0,g.default)((function e(){(0,m.default)(this,e)})),F=(0,g.default)((function e(t,n){(0,m.default)(this,e),this.id=t,this.data=n})),G=new(function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"isDef",value:function(e){return!this.isUndef(e)}},{key:"isUndef",value:function(e){return null==e}},{key:"isPrimitive",value:function(e){return"string"==typeof e||"number"==typeof e||"symbol"==(0,p.default)(e)||"boolean"==typeof e}},{key:"isObject",value:function(e){return null!==e&&"object"==(0,p.default)(e)}},{key:"isPlainObject",value:function(e){return"[object Object]"===Object.prototype.toString.call(e)}},{key:"isRegExp",value:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}},{key:"isValidArrayIndex",value:function(e){var t=parseFloat(String(e));return t>=0&&Math.floor(t)===t&&isFinite(e)}},{key:"isString",value:function(e){return"string"==typeof e}},{key:"isNumber",value:function(e){return"number"==typeof e}},{key:"isStringOrNumber",value:function(e){return this.isString(e)||this.isNumber(e)}},{key:"isArray",value:function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{key:"isEmpty",value:function(e){return this.isArray(e)?0===e.length:this.isObject(e)?!this.isDef(e):!this.isNumber(e)&&(this.isString(e)?""===e.trim():!this.isDef(e))}},{key:"isNative",value:function(e){return"function"==typeof e&&/native code/.test(e.toString())}},{key:"isFunction",value:function(e){return"function"==typeof e}},{key:"isBoolean",value:function(e){return"boolean"==typeof e}},{key:"isTrue",value:function(e){return!0===e}},{key:"isFalse",value:function(e){return!1===e}},{key:"isNull",value:function(e){return null===e}}]),e}()),B=new(function(){function e(){(0,m.default)(this,e),this.uniAppRunningBackend=!1,this.listenAppRunning()}return(0,g.default)(e,[{key:"listenAppRunning",value:function(){var e=this;T.currentFramework()===S.UNIAPP&&"object"==("undefined"===typeof plus?"undefined":(0,p.default)(plus))&&(plus.globalEvent.addEventListener("resume",(function(){e.uniAppRunningBackend=!1,e.uniAppRunningBackend}),!1),plus.globalEvent.addEventListener("pause",(function(){e.uniAppRunningBackend=!0,e.uniAppRunningBackend}),!1))}},{key:"runningBackend",value:function(){return this.uniAppRunningBackend}}]),e}()),q=Object.freeze({__proto__:null,uniApp:B}),j={exports:{}},H="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(H){var V=new Uint8Array(16);j.exports=function(){return H(V),V}}else{var z=new Array(16);j.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),z[t]=e>>>((3&t)<<3)&255;return z}}for(var W=[],X=0;X<256;++X)W[X]=(X+256).toString(16).substr(1);var J,K,Y=function(e,t){var n=t||0,i=W;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]]].join("")},Q=j.exports,$=Y,Z=0,ee=0,te=j.exports,ne=Y,ie=function(e,t,n){var i=t&&n||0,s=t||[],a=(e=e||{}).node||J,r=void 0!==e.clockseq?e.clockseq:K;if(null==a||null==r){var o=Q();null==a&&(a=J=[1|o[0],o[1],o[2],o[3],o[4],o[5]]),null==r&&(r=K=16383&(o[6]<<8|o[7]))}var u=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:ee+1,l=u-Z+(c-ee)/1e4;if(l<0&&void 0===e.clockseq&&(r=r+1&16383),(l<0||u>Z)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Z=u,ee=c,K=r;var f=(1e4*(268435455&(u+=122192928e5))+c)%4294967296;s[i++]=f>>>24&255,s[i++]=f>>>16&255,s[i++]=f>>>8&255,s[i++]=255&f;var d=u/4294967296*1e4&268435455;s[i++]=d>>>8&255,s[i++]=255&d,s[i++]=d>>>24&15|16,s[i++]=d>>>16&255,s[i++]=r>>>8|128,s[i++]=255&r;for(var h=0;h<6;++h)s[i+h]=a[h];return t||$(s)},se=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||te)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[i+a]=s[a];return t||ne(s)},ae=se;ae.v1=ie,ae.v4=se;var re,oe,ue,ce=ae,le=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,null,[{key:"get",value:function(){return ce.v1().replace(/-/g,"")}}]),e}();!function(e){e.WRITE="WRITE",e.READ="READ",e.NONE="NONE"}(re||(re={}));var fe=function(){function e(t){var n=this;(0,m.default)(this,e),this.permission=re.NONE,this.singleTimeout=0,this.totalTimeout=0,this.startTime=0,this.complete=!1,this.retried=0,this.unique=!1,this.uuid=le.get(),this.name=t.name,this.params=t.params,this.permission=t.permission,this.totalTimeout=t.totalTimeout,this.singleTimeout=t.singleTimeout,t.unique&&(this.unique=t.unique),this.success=function(e){n.complete||(n.end(),t.success(e))},this.fail=function(e){n.complete||(n.end(),t.fail(e))}}return(0,g.default)(e,[{key:"start",value:function(){this.startTime=Date.now(),this.initAutoTimeout()}},{key:"end",value:function(){this.complete=!0,clearTimeout(this.timeoutHandler)}},{key:"initAutoTimeout",value:function(){var e=this;this.timeoutHandler=setTimeout((function(){e.complete||e.fail({resultCode:408,content:"Host unreachable or timeout"})}),this.totalTimeout)}}]),e}();!function(e){e.authorize="authorize",e.manualDisconnect="manualDisconnect",e.subscribe="subscribe",e.unsubscribe="unsubscribe",e.publish="publish",e.ack="ack",e.historyMessages="historyMessages",e.hereNow="hereNow",e.hereNowByUserIds="hereNowByUserIds",e.PUBSUB_PRESENCE_SUBSCRIBE="PUBSUB_PRESENCE_SUBSCRIBE",e.PUBSUB_PRESENCE_UNSUBSCRIBE="PUBSUB_PRESENCE_UNSUBSCRIBE",e.PUBSUB_PRESENCE_HERENOW="PUBSUB_PRESENCE_HERENOW",e.imLastConversations="imLastConversations",e.markPrivateMessageAsRead="markPrivateMessageAsRead",e.markGroupMessageAsRead="markGroupMessageAsRead",e.imGroupOnlineCount="imGroupOnlineCount",e.imHereNow="imHereNow",e.imGroupHereNow="imGroupHereNow",e.publishIM="publishIM",e.subscribeUserPresence="subscribeUserPresence",e.unsubscribeUserPresence="unsubscribeUserPresence",e.subscribeGroupPresence="subscribeGroupPresence",e.unsubscribeGroupPresence="unsubscribeGroupPresence",e.removeConversation="removeConversation",e.topConversation="topConversation",e.imData="imData",e.subscribeGroups="subscribeGroups",e.unsubscribeGroup="unsubscribeGroup",e.IM_DELETE_MESSAGE="IM_DELETE_MESSAGE",e.IM_HISTORY="IM_HISTORY",e.IM_HISTORY_CHANGE="IM_HISTORY_CHANGE",e.IM_RECALL_MESSAGE="IM_RECALL_MESSAGE",e.IM_MARK_AS_READ="IM_MARK_AS_READ",e.RTC_ASK_NEW_TOKEN="RTC_ASK_NEW_TOKEN",e.RTC_DIAL="RTC_DIAL",e.RTC_ACCEPT="RTC_ACCEPT",e.RTC_ACCEPT_FAILED="RTC_ACCEPT_FAILED",e.RTC_MANUAL_END="RTC_MANUAL_END",e.RTC_CLIENT_BUSY="RTC_CLIENT_BUSY",e.RTC_TIMEOUT="RTC_TIMEOUT",e.RTC_CALL_DATA="RTC_CALL_DATA",e.CS_PENDING_CONVERSATION="CS_PENDING_CONVERSATION",e.CS_ACCEPT="CS_ACCEPT",e.CS_END="CS_END",e.CS_TRANSFER="CS_TRANSFER",e.CS_AGENTS="CS_AGENTS",e.CS_CUSTOMER_STATUS="CS_CUSTOMER_STATUS",e.CS_MY_TEAMS="CS_MY_TEAMS",e.CS_ONLINE="CS_ONLINE",e.CS_OFFLINE="CS_OFFLINE",e.CS_LIVE_SESSION="CS_LIVE_SESSION",e.CS_QUIT_LIVE="CS_QUIT_LIVE",e.SET_IOS_BADGE="SET_IOS_BADGE"}(oe||(oe={})),function(e){e[e.connect=3e3]="connect",e[e.reconnectionDelayMax=3e3]="reconnectionDelayMax",e[e.commonQuerySingle=2500]="commonQuerySingle",e[e.commonQueryTotal=12e3]="commonQueryTotal",e[e.commonRequestSingle=1700]="commonRequestSingle",e[e.commonRequestTotal=12e3]="commonRequestTotal",e[e.commonInfiniteSingle=1700]="commonInfiniteSingle",e[e.commonInfiniteTotal=864e5]="commonInfiniteTotal"}(ue||(ue={}));var de=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,null,[{key:"onSuccess",value:function(e,t){G.isFunction(e.onSuccess)&&e.onSuccess(t)}},{key:"onFailed",value:function(e,t){if(!G.isObject(e)||!G.isFunction(e.onFailed))throw t;e.onFailed(t)}}]),e}(),he=function(){function e(t){(0,m.default)(this,e),this.uniappPlugin=null,this.regIdPromise=null,this.onClickNotificationCallback=null,this.payloadAssemblers=new Array,this.allowNotification=t,this.supportNotification()&&(this.uniappPlugin=uni.requireNativePlugin("GoEasy-Uniapp"),this.uniappPlugin?this.regIdPromise=this.askRegId():console.warn("No GoEasy-Uniapp Native Plugin."))}return(0,g.default)(e,[{key:"addAssembler",value:function(e){this.payloadAssemblers.push(e)}},{key:"assemblePayload",value:function(e){var t=this.payloadAssemblers.find((function(t){return t.support(e)}));return t?t.assemble(e):e}},{key:"createLocalNotification",value:function(t,n,i,s,a){B.runningBackend()&&(i.g=1,"undefined"!=typeof plus&&(s?(this.uniappPlugin.playSound(s),plus.push.createMessage(n,JSON.stringify(i),{title:t,sound:"none"})):plus.push.createMessage(n,JSON.stringify(i),{title:t}),"+1"===a&&this.setClientBadge(e.instance.badge+1)))}},{key:"setBadge",value:function(e){var t=this;if(!Number.isInteger(e.badge)||e.badge<0)de.onFailed(e,"badge must be an integer greater than or equal to 0.");else if(this.supportNotification())if(A.currentPlatform()===E.APP_IOS){var n=new fe({name:oe.SET_IOS_BADGE,params:{badge:e.badge},unique:!0,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,permission:re.WRITE,success:function(){de.onSuccess(e),t.setClientBadge(e.badge)},fail:function(t){de.onFailed(e,t.content)}});D.e(n)}else de.onSuccess(e),this.setClientBadge(e.badge)}},{key:"setClientBadge",value:function(t){"vivo"!==plus.device.vendor&&(e.instance.badge=t,plus.runtime.setBadgeNumber(t))}},{key:"askRegId",value:function(){var e=this,t=null,n=0;return function i(){return new Promise((function(s,a){e.uniappPlugin.regId((function(e){s(e)}),(function(s){if(!(1e6===s.data.code&&n<=10))return clearTimeout(t),a(s);t=setTimeout((function(){n++,e.regIdPromise=i()}),3500)}))}))}()}},{key:"getRegIdPromise",value:function(){return this.regIdPromise}},{key:"supportNotification",value:function(){var e=A.currentPlatform(),t=T.currentFramework();return this.allowNotification&&t===S.UNIAPP&&(e===E.APP_ANDROID||e===E.APP_IOS)}},{key:"listenPlusClickNotification",value:function(){var e=this;plus.push.addEventListener("click",(function(t){try{if(t){var n="string"==typeof t.payload?JSON.parse(t.payload):t.payload;if(e.availableIntent(n)){var i=e.assemblePayload(n);plus.push.clear(),e.onClickNotificationCallback(i)}}}catch(t){}}))}},{key:"availableIntent",value:function(e){return e&&Object.keys(e).length&&e.g&&1===parseInt(e.g)}},{key:"getIntentData",value:function(){var e=this;this.uniappPlugin.getIntentData((function(t){if(e.availableIntent(t)){var n=e.assemblePayload(t),i=A.currentPlatform();plus.push.clear(),i===E.APP_ANDROID&&e.uniappPlugin.clearAll(),e.onClickNotificationCallback(n)}}))}},{key:"listenClick",value:function(){this.listenPlusClickNotification();var e=A.currentPlatform();this.uniappPlugin&&e===E.APP_ANDROID&&this.getIntentData()}},{key:"onClickNotification",value:function(e){if(this.supportNotification()){if(!G.isFunction(e))throw new Error("The arguments must be a function.");null===this.onClickNotificationCallback?(this.onClickNotificationCallback=e,this.listenClick()):console.warn("The onClickNotification event has been listened on. Please do not listen to it more than once.")}else console.warn("The current environment doesn't support or allowNotification is false.")}}],[{key:"init",value:function(t){this.instance=new e(t),this.instance.supportNotification()&&this.instance.setClientBadge(0)}}]),e}();function pe(){}var ve=new(function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"validateId",value:function(e,t){if(G.isEmpty(e))throw{code:400,content:" ".concat(t," is required.")};if(!G.isStringOrNumber(e))throw{code:400,content:"TypeError: ".concat(t," require string or number.")}}},{key:"validateIdArray",value:function(e,t){if(!Array.isArray(e)||0===e.length)throw{code:400,content:"TypeError: ".concat(t," require array.")};if(e.length>300)throw{code:400,content:"".concat(t," is over max length 500.")};for(var n=0;n<e.length;n++){if(!G.isStringOrNumber(e[n]))throw{code:400,content:"TypeError: ".concat(t," item require string or number.")};if(G.isNumber(e[n])&&(e[n]=e[n].toString()),0==e[n].length)throw{code:400,content:"".concat(t," has empty item.")}}if(Array.from(new Set(e)).length<e.length)throw{code:400,content:"Duplicate element in ".concat(t)}}},{key:"validateChannel",value:function(e,t){this.validateId(e,t)}},{key:"validateChannelArray",value:function(e,t){this.validateIdArray(e,t)}},{key:"validateChannelAndChannels",value:function(e,t){var n=!G.isEmpty(e),i=!G.isEmpty(t);if(!n&&!i)throw{code:400,content:"channel is required."};if(n&&i)throw{code:400,content:"subscribe to either channel or channels, not both."};n&&this.validateId(e,"channel"),i&&this.validateIdArray(t,"channels")}},{key:"validateCallbackOptions",value:function(e){if(!G.isObject(e))throw{code:400,content:"bad parameters"}}},{key:"validateNotification",value:function(e){function t(e,t,n){if(!(G.isString(e[t])&&e[t].length<=n))throw{code:400,content:"notification.".concat(t," must be a string of no more than ").concat(n," characters")}}function n(e,t,n,i){var s=e[t];if(G.isObject(s)&&G.isDef(s[n])){var a={code:400,content:"notification.vendorOptions.".concat(t,".").concat(n," require a ").concat(i,"}")},r=s[n];if("string"===i&&!G.isString(r))throw a;if("number"===i&&!G.isNumber(r))throw a}}if(!G.isObject(e))throw{code:400,content:"TypeError: notification requires an object."};if(t(e,"title",32),t(e,"body",50),G.isDef(e.sound)&&!G.isString(e.sound))throw{code:400,content:"notification.sound must be a string"};if(G.isDef(e.badge)&&!G.isString(e.badge))throw{code:400,content:"notification.badge must be a string"};e.badge=e.badge||"0";var i=e.vendorOptions;G.isObject(i)&&(n(i,"huawei","category","string"),n(i,"xiaomi","channel_id","string"),n(i,"oppo","channel_id","string"),n(i,"vivo","classification","number"),n(i,"vivo","category","string"))}},{key:"validateValIsEmpty",value:function(e,t){if(G.isUndef(e)||G.isEmpty(e))throw{code:400,content:"".concat(t," is empty")}}},{key:"validateWXMPTemplateMsg",value:function(e){if(G.isObject(e)){if(!G.isString(e.template_id))throw{code:400,content:"template_id must be string."};if(!G.isEmpty(e.url)&&!G.isString(e.url))throw{code:400,content:"url must be string"};if(!(G.isEmpty(e.miniprogram)||G.isString(e.miniprogram.appid)&&G.isString(e.miniprogram.pagepath)))throw{code:400,content:"miniprogram.appid and miniprogram.pagepath must be strings."};if(!G.isObject(e.data))throw{code:400,content:"data requires an object."}}else if(G.isPrimitive(e))throw{code:400,content:"wxmpTemplateMsg must be an object."}}}]),e}());function me(e){if(null===e||"object"!=(0,p.default)(e)||"isActiveClone"in e)return e;var t=e instanceof Array?[]:{};for(var n in e)"object"==(0,p.default)(e[n])?t[n]=me(e[n]):t[n]=e[n];return t}var ge,ye=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"publish",value:function(e){G.isFunction(e.onFailed)||(e.onFailed=pe),G.isFunction(e.onSuccess)||(e.onSuccess=pe),this.validate(e),e.channel=e.channel.toString();var t={channel:e.channel,content:e.message,nt:e.notification,at:e.accessToken,guid:le.get(),q:e.qos};e.wxmpTemplateMsg&&(t.wxmpTemplateMsg=me(e.wxmpTemplateMsg),t.wxmpTemplateMsg.data=JSON.stringify(t.wxmpTemplateMsg.data));var n=new fe({name:oe.publish,params:t,unique:!0,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,permission:re.WRITE,success:function(t){e.onSuccess({code:200,content:"ok"})},fail:function(t){e.onFailed({code:t.resultCode,content:t.content})}});D.e(n)}},{key:"validate",value:function(e){if(ve.validateChannel(e.channel,"channel"),G.isEmpty(e.message))throw{code:400,content:"message is required."};if(!G.isString(e.message))throw{code:400,content:"TypeError: message requires string."};if(e.message.length>1e4)throw{code:400,content:"Message over max length 10000."};if(e.qos&&!(e.qos in[0,1]))throw{code:400,content:"Qos must be 0 or 1."};e.wxmpTemplateMsg&&ve.validateWXMPTemplateMsg(e.wxmpTemplateMsg),G.isDef(e.notification)&&ve.validateNotification(e.notification)}}]),e}(),be=(0,g.default)((function e(t){if((0,m.default)(this,e),this.options=t,this.channels=t.channels||[t.channel],!G.isEmpty(t.channel)){var n=t.channel.toString();this.channels=[n]}G.isEmpty(t.channels)||(this.channels=t.channels.toString().split(","))}));!function(e){e.message="message",e.imMessage="imMessage",e.userPresence="userPresence",e.groupPresence="groupPresence",e.PS_PRESENCE_EVENT="PS_PRESENCE_EVENT",e.IM_MSG_READ="IM_MSG_READ",e.IM_MSG_DELETED="IM_MSG_DELETED",e.IM_MSG_RECALLED="IM_MSG_RECALLED",e.RTC_RING_EVENT="RTC_RING_EVENT",e.RTC_CANCEL_RING="RTC_CANCEL_RING",e.RTC_REMOTE_USER_LEFT="RTC_REMOTE_USER_LEFT",e.RTC_CALL_END="RTC_CALL_END",e.CS_ONLINE_CHANGED="CS_ONLINE_CHANGED"}(ge||(ge={}));var ke=function(){function e(){(0,m.default)(this,e),this.subscriptions=[],he.instance.addAssembler(new(function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"assemble",value:function(e){return{channel:e.ch,content:e.ctt}}},{key:"support",value:function(e){return!!e.ch}}]),e}()))}return(0,g.default)(e,[{key:"initialGoEasySocket",value:function(){D.s().addMessageObserver(ge.message,this.onNewMessage.bind(this)),D.s().addExpiredReconnectedObserver(this.expiredResubscribe.bind(this)),D.s().addConnectedObserver(this.resubscribePresenceChannel.bind(this))}},{key:"clearSubscriptions",value:function(){this.subscriptions=[]}},{key:"expiredResubscribe",value:function(){var e=this;this.subscriptions.forEach((function(t){e.doSubscribe(t,!1)}))}},{key:"resubscribePresenceChannel",value:function(){var e=this;this.subscriptions.forEach((function(t){var n=t.options;n.presence&&n.presence.enable&&e.doSubscribe(t,!0)}))}},{key:"onNewMessage",value:function(e){if(!(e.n.indexOf("_presence")>-1)){e.a&&D.s().sendAck("ack",{publishGuid:e.i});var t={time:e.t,channel:e.n,content:e.c};this.createNotification(e),this.findSubscriptionByChannel(t.channel).options.onMessage(t)}}},{key:"createNotification",value:function(e){var t=he.instance.supportNotification();if(G.isObject(e.nt)&&t){var n={ch:e.n,ctt:e.c};he.instance.createLocalNotification(e.nt.t,e.nt.c,n,e.nt.sound,e.nt.badge)}}},{key:"subscribe",value:function(e){var t=this;if(ve.validateChannelAndChannels(e.channel,e.channels),G.isDef(e.presence)){var n=e.presence.enable;if(!G.isBoolean(n))throw{code:400,content:"Subscription failed. presence.enable must be a boolean"};if(n&&D.s().anonymous)throw{code:400,content:"Subscription failed. If presence is enable, the id must be specified when calling the connect method"}}var i=new be(e);this.doSubscribe(i,!1).then((function(){t.subscriptions.push(i),de.onSuccess(e,{code:200,content:"ok"})})).catch((function(t){de.onFailed(e,{code:t.resultCode,content:t.content})}))}},{key:"doSubscribe",value:function(e,t){var n=e.options;return new Promise((function(i,s){var a=new fe({name:oe.subscribe,permission:re.READ,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,params:{channels:e.channels,accessToken:n.accessToken,presence:n.presence,resubscribe:t},success:function(){i()},fail:function(e){s(e)}});D.e(a)}))}},{key:"unsubscribe",value:function(e){var t=this;ve.validateChannel(e.channel,"channel"),e.channel=e.channel.toString();var n=this.findSubscriptionByChannel(e.channel);if(n){var i=new fe({name:oe.unsubscribe,params:{channel:e.channel,presence:n.options.presence},permission:re.READ,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,success:function(){e.onSuccess({code:200,content:"ok"}),t.removeChannel(e.channel)},fail:function(t){e.onFailed({code:t.resultCode,content:t.content})}});D.e(i)}else e.onFailed({code:400,content:"channel["+e.channel+"] is not subscribed"})}},{key:"removeChannel",value:function(e){for(var t=this.subscriptions.length-1;t>=0;t--){var n=this.subscriptions[t].channels,i=n.indexOf(e);if(i>-1){n.splice(i,1),0===n.length&&this.subscriptions.splice(t,1);break}}}},{key:"findSubscriptionByChannel",value:function(e){for(var t=!1,n=null,i=this.subscriptions.length-1;i>=0;i--){for(var s=this.subscriptions[i].channels,a=0;a<s.length;a++)if(s[a]==e){t=!0,n=this.subscriptions[i];break}if(t)break}return n}}]),e}(),Ee=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"get",value:function(e){G.isFunction(e.onSuccess)||(e.onSuccess=pe),G.isFunction(e.onFailed)||(e.onFailed=pe),ve.validateChannel(e.channel,"channel"),e.channel=e.channel.toString();var t=new fe({name:oe.historyMessages,permission:re.READ,params:e,singleTimeout:ue.commonQuerySingle,totalTimeout:ue.commonQueryTotal,success:function(t){e.onSuccess({code:t.resultCode||t.code||200,content:t.content})},fail:function(t){e.onFailed({code:t.resultCode||t.code,content:t.content})}});D.e(t)}}]),e}();function Se(e,t,n,i){return new(n||(n=Promise))((function(s,a){function r(e){try{u(i.next(e))}catch(e){a(e)}}function o(e){try{u(i.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}u((i=i.apply(e,t||[])).next())}))}var we=function(){function e(){(0,m.default)(this,e),this.channelPresenceMap=new Map,D.s().addDisconnectedObserver(this.expireAllChannelPresences.bind(this)),D.s().addConnectedObserver(this.resubscribe.bind(this)),D.s().addMessageObserver(ge.PS_PRESENCE_EVENT,this.onPresenceEvent.bind(this))}return(0,g.default)(e,[{key:"hereNow",value:function(e){var t,n=this.channelPresenceMap.get(e.channel);n&&n.queryPromise?(e.limit&&e.limit>n.membersLimit&&n.doQuery(e.limit),t=n.queryPromise):t=Me(e.channel,e.limit),t.then((function(t){e.onSuccess(t)})).catch((function(t){e.onFailed(t)}))}},{key:"subscribe",value:function(e){if(G.isUndef(e.onPresence)||!G.isFunction(e.onPresence))throw{code:400,content:"Subscription Presence failed. onPresence callback function is required"};var t=e.channel,n=this.channelPresenceMap.get(t);n||(n=new Ce(t),this.channelPresenceMap.set(t,n)),n.subscribe(e)}},{key:"unsubscribe",value:function(e){var t=this,n=e.channel;if(this.channelPresenceMap.get(n)){var i=new fe({name:oe.PUBSUB_PRESENCE_UNSUBSCRIBE,permission:re.WRITE,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,params:{channel:n},success:function(i){t.channelPresenceMap.delete(n),e.onSuccess()},fail:function(t){e.onFailed(t)}});D.e(i)}else e.onSuccess()}},{key:"onPresenceEvent",value:function(e){this.channelPresenceMap.get(e.channel).onPresence(e)}},{key:"expireAllChannelPresences",value:function(){this.channelPresenceMap.forEach((function(e,t){e.expire()}))}},{key:"resubscribe",value:function(){this.channelPresenceMap.forEach((function(e,t){e.subscribed()&&e.doSubscribe()}))}}]),e}(),Ce=function(){function e(t){(0,m.default)(this,e),this.membersLimit=10,this.queried=!1,this.channel=t}return(0,g.default)(e,[{key:"onPresence",value:function(e){return Se(this,void 0,void 0,(0,h.default)().mark((function t(){return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.queried){t.next=4;break}this.update(e),t.next=6;break;case 4:return t.next=6,this.queryPromise;case 6:this.on({channel:this.channel,action:e.action,member:e.member,time:e.time,amount:this.amount,members:this.membersByLimit()});case 7:case"end":return t.stop()}}),t,this)})))}},{key:"membersByLimit",value:function(){return this.members.slice(0,this.membersLimit)}},{key:"subscribe",value:function(e){return Se(this,void 0,void 0,(0,h.default)().mark((function t(){return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.membersLimit&&(this.membersLimit=Math.min(e.membersLimit,300)),this.subscribed()){t.next=9;break}return t.prev=1,t.next=4,this.doSubscribe();case 4:t.next=9;break;case 6:return t.prev=6,t.t0=t["catch"](1),t.abrupt("return",void e.onFailed(t.t0));case 9:this.on=e.onPresence,e.onSuccess();case 10:case"end":return t.stop()}}),t,this,[[1,6]])})))}},{key:"doSubscribe",value:function(){var e=this;return this.doQuery(this.membersLimit),new Promise((function(t,n){var i=new fe({name:oe.PUBSUB_PRESENCE_SUBSCRIBE,permission:re.READ,params:{channel:e.channel},singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,success:function(e){t()},fail:function(e){n(e)}});D.e(i)}))}},{key:"doQuery",value:function(e){var t=this;this.queryPromise=Me(this.channel,e),this.queryPromise.then((function(e){t.members=e.content.members,t.amount=e.content.amount,t.queried=!0})).catch((function(e){throw e}))}},{key:"update",value:function(e){if(["join","back"].includes(e.action))this.members.unshift(e.member);else if(["leave","timeout"].includes(e.action)){var t=this.members.findIndex((function(t){return t.id===e.member.id}));t>-1&&this.members.splice(t,1)}this.amount=e.amount}},{key:"expire",value:function(){this.queried=!1,this.queryPromise=null}},{key:"subscribed",value:function(){return void 0!==this.on}}]),e}();function Me(e,t){return t||(t=10),new Promise((function(n,i){var s={channel:e,limit:t},a=new fe({name:oe.PUBSUB_PRESENCE_HERENOW,permission:re.READ,params:s,singleTimeout:ue.commonQuerySingle,totalTimeout:ue.commonQueryTotal,success:function(e){n(e)},fail:function(e){i(e)}});D.e(a)}))}var Ie=function(){function e(t){(0,m.default)(this,e),this.subscriber=new ke,this.options=t}return(0,g.default)(e,[{key:"initialGoEasySocket",value:function(){this.publisher=new ye,this.histories=new Ee,this.subscriber.initialGoEasySocket(),this.presence2=new we}},{key:"initialBeforeConnect",value:function(){this.subscriber.clearSubscriptions()}},{key:"catch",value:function(e,t){try{this.validateOptions(),e()}catch(e){de.onFailed(t,e)}}},{key:"validateOptions",value:function(){if(!D.s()||[w.DISCONNECTED,w.DISCONNECTING,w.CONNECT_FAILED].includes(D.s().getStatus()))throw Error("Please call connect() first.");if(!this.options.modules||!this.options.modules.includes(x))throw{code:400,content:"Invalid options: module '".concat(x,"' is not enabled")}}},{key:"publish",value:function(e){var t=this;this.catch((function(){t.publisher.publish(e)}),e)}},{key:"subscribe",value:function(e){var t=this;this.catch((function(){t.subscriber.subscribe(e)}),e)}},{key:"unsubscribe",value:function(e){var t=this;this.catch((function(){t.subscriber.unsubscribe(e)}),e)}},{key:"subscribePresence",value:function(e){var t=this;this.catch((function(){t.presence2.subscribe(e)}),e)}},{key:"unsubscribePresence",value:function(e){var t=this;this.catch((function(){t.presence2.unsubscribe(e)}),e)}},{key:"history",value:function(e){var t=this;this.catch((function(){t.histories.get(e)}),e)}},{key:"hereNow",value:function(e){var t=this;this.catch((function(){t.presence2.hereNow(e)}),e)}}],[{key:"init",value:function(t){e.instance=new e(t)}}]),e}(),Ae=function(){function e(t){(0,m.default)(this,e),Ie.init(t)}return(0,g.default)(e,[{key:"initialGoEasySocket",value:function(){Ie.instance.initialGoEasySocket()}},{key:"initialBeforeConnect",value:function(){Ie.instance.initialBeforeConnect()}},{key:"publish",value:function(e){Ie.instance.publish(e)}},{key:"subscribe",value:function(e){Ie.instance.subscribe(e)}},{key:"unsubscribe",value:function(e){Ie.instance.unsubscribe(e)}},{key:"subscribePresence",value:function(e){Ie.instance.subscribePresence(e)}},{key:"unsubscribePresence",value:function(e){Ie.instance.unsubscribePresence(e)}},{key:"history",value:function(e){Ie.instance.history(e)}},{key:"hereNow",value:function(e){Ie.instance.hereNow(e)}}]),e}(),Te={exports:{}},_e=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ne=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Oe=function(e){var t=e,n=e.indexOf("["),i=e.indexOf("]");-1!=n&&-1!=i&&(e=e.substring(0,n)+e.substring(n,i).replace(/:/g,";")+e.substring(i,e.length));for(var s=_e.exec(e||""),a={},r=14;r--;)a[Ne[r]]=s[r]||"";return-1!=n&&-1!=i&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a},Re={exports:{}},xe={exports:{}},Pe=1e3,De=6e4,Ue=60*De,Le=24*Ue,Fe=function(e,t){t=t||{};var n=(0,p.default)(e);if("string"===n&&e.length>0)return function(e){if(e=String(e),!(e.length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"days":case"day":case"d":return n*Le;case"hours":case"hour":case"hrs":case"hr":case"h":return n*Ue;case"minutes":case"minute":case"mins":case"min":case"m":return n*De;case"seconds":case"second":case"secs":case"sec":case"s":return n*Pe;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}(e);if("number"===n&&!1===isNaN(e))return t.long?function(e){return Ge(e,Le,"day")||Ge(e,Ue,"hour")||Ge(e,De,"minute")||Ge(e,Pe,"second")||e+" ms"}(e):function(e){return e>=Le?Math.round(e/Le)+"d":e>=Ue?Math.round(e/Ue)+"h":e>=De?Math.round(e/De)+"m":e>=Pe?Math.round(e/Pe)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function Ge(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}!function(e,t){function n(e){var n;function s(){if(s.enabled){var e=s,i=+new Date,a=i-(n||i);e.diff=a,e.prev=n,e.curr=i,n=i;for(var r=new Array(arguments.length),o=0;o<r.length;o++)r[o]=arguments[o];r[0]=t.coerce(r[0]),"string"!=typeof r[0]&&r.unshift("%O");var u=0;r[0]=r[0].replace(/%([a-zA-Z%])/g,(function(n,i){if("%%"===n)return n;u++;var s=t.formatters[i];if("function"==typeof s){var a=r[u];n=s.call(e,a),r.splice(u,1),u--}return n})),t.formatArgs.call(e,r),(s.log||t.log||console.log.bind(console)).apply(e,r)}}return s.namespace=e,s.enabled=t.enabled(e),s.useColors=t.useColors(),s.color=function(e){var n,i=0;for(n in e)i=(i<<5)-i+e.charCodeAt(n),i|=0;return t.colors[Math.abs(i)%t.colors.length]}(e),s.destroy=i,"function"==typeof t.init&&t.init(s),t.instances.push(s),s}function i(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=xe.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var i=("string"==typeof e?e:"").split(/[\s,]+/),s=i.length;for(n=0;n<s;n++)i[n]&&("-"===(e=i[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var a=t.instances[n];a.enabled=t.enabled(a.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,i;for(n=0,i=t.skips.length;n<i;n++)if(t.skips[n].test(e))return!1;for(n=0,i=t.names.length;n<i;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=Fe,t.instances=[],t.names=[],t.skips=[],t.formatters={}}(0,xe.exports),function(e,t){function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!=typeof i&&"env"in i&&(e=Object({NODE_ENV:"production",VUE_APP_DARK_MODE:"false",VUE_APP_INDEX_CSS_HASH:"2da1efab",VUE_APP_INDEX_DARK_CSS_HASH:"e6047db7",VUE_APP_NAME:"旅行·攻略",VUE_APP_PLATFORM:"h5",BASE_URL:"/"}).DEBUG),e}(t=e.exports=xe.exports).log=function(){return"object"==("undefined"===typeof console?"undefined":(0,p.default)(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var i="color: "+this.color;e.splice(1,0,i,"color: inherit");var s=0,a=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(s++,"%c"===e&&(a=s))})),e.splice(a,0,i)}},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())}(Re,Re.exports);var Be=Oe,qe=Re.exports("socket.io-client:url"),je=function(e,t){var n=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(qe("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),qe("parse %s",e),n=Be(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";var i=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+i+":"+n.port,n.href=n.protocol+"://"+i+(t&&t.port===n.port?"":":"+n.port),n},He={},Ve={}.toString,ze=Array.isArray||function(e){return"[object Array]"==Ve.call(e)};!function(e){Re.exports("socket.io-parser");var t=k.exports,n=ze;function i(){}e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=i,e.Decoder=a;var s=e.ERROR+'"encode error"';function a(){this.reconstructor=null}function r(t){return{type:e.ERROR,data:"parser error: "+t}}i.prototype.encode=function(t,n){var i=function(t){var n=""+t.type;if(e.BINARY_EVENT!==t.type&&e.BINARY_ACK!==t.type||(n+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(n+=t.nsp+","),null!=t.id&&(n+=t.id),null!=t.data){var i=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(t.data);if(!1===i)return s;n+=i}return n}(t);n([i])},t(a.prototype),a.prototype.add=function(t){var i;if("string"!=typeof t)throw new Error("Unknown type: "+t);i=function(t){var i=0,s={type:Number(t.charAt(0))};if(null==e.types[s.type])return r("unknown packet type "+s.type);if(e.BINARY_EVENT===s.type||e.BINARY_ACK===s.type){for(var a="";"-"!==t.charAt(++i)&&(a+=t.charAt(i),i!=t.length););if(a!=Number(a)||"-"!==t.charAt(i))throw new Error("Illegal attachments");s.attachments=Number(a)}if("/"===t.charAt(i+1))for(s.nsp="";++i;){if(","===(u=t.charAt(i)))break;if(s.nsp+=u,i===t.length)break}else s.nsp="/";var o=t.charAt(i+1);if(""!==o&&Number(o)==o){for(s.id="";++i;){var u;if(null==(u=t.charAt(i))||Number(u)!=u){--i;break}if(s.id+=t.charAt(i),i===t.length)break}s.id=Number(s.id)}if(t.charAt(++i)){var c=function(e){try{return JSON.parse(e)}catch(e){return!1}}(t.substr(i));if(!1===c||s.type!==e.ERROR&&!n(c))return r("invalid payload");s.data=c}return s}(t),this.emit("decoded",i)},a.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}(He);var We={exports:{}},Xe={},Je={},Ke=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var i in e)n.call(e,i)&&t.push(i);return t},Ye=ze,Qe=Object.prototype.toString,$e="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Qe.call(Blob),Ze="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Qe.call(File),et=function e(t){if(!t||"object"!=(0,p.default)(t))return!1;if(Ye(t)){for(var n=0,i=t.length;n<i;n++)if(e(t[n]))return!0;return!1}if("function"==typeof s&&s.isBuffer&&s.isBuffer(t)||"function"==typeof ArrayBuffer&&t instanceof ArrayBuffer||$e&&t instanceof Blob||Ze&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)&&e(t[a]))return!0;return!1},nt=function(e,t,n){var i=!1;return n=n||it,s.count=e,0===e?t():s;function s(e,a){if(s.count<=0)throw new Error("after called too many times");--s.count,e?(i=!0,t(e),t=n):0!==s.count||i||t(null,a)}};function it(){}var st,at,rt,ot=String.fromCharCode;function ut(e){for(var t,n,i=[],s=0,a=e.length;s<a;)(t=e.charCodeAt(s++))>=55296&&t<=56319&&s<a?56320==(64512&(n=e.charCodeAt(s++)))?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),s--):i.push(t);return i}function ct(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function lt(e,t){return ot(e>>t&63|128)}function ft(e,t){if(0==(4294967168&e))return ot(e);var n="";return 0==(4294965248&e)?n=ot(e>>6&31|192):0==(4294901760&e)?(ct(e,t)||(e=65533),n=ot(e>>12&15|224),n+=lt(e,6)):0==(4292870144&e)&&(n=ot(e>>18&7|240),n+=lt(e,12),n+=lt(e,6)),n+ot(63&e|128)}function dt(){if(rt>=at)throw Error("Invalid byte index");var e=255&st[rt];if(rt++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function ht(e){var t,n;if(rt>at)throw Error("Invalid byte index");if(rt==at)return!1;if(t=255&st[rt],rt++,0==(128&t))return t;if(192==(224&t)){if((n=(31&t)<<6|dt())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&t)){if((n=(15&t)<<12|dt()<<6|dt())>=2048)return ct(n,e)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(n=(7&t)<<18|dt()<<12|dt()<<6|dt())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}var pt={version:"2.1.2",encode:function(e,t){for(var n=!1!==(t=t||{}).strict,i=ut(e),s=i.length,a=-1,r="";++a<s;)r+=ft(i[a],n);return r},decode:function(e,t){var n=!1!==(t=t||{}).strict;st=ut(e),at=st.length,rt=0;for(var i,s=[];!1!==(i=ht(n));)s.push(i);return function(e){for(var t,n=e.length,i=-1,s="";++i<n;)(t=e[i])>65535&&(s+=ot((t-=65536)>>>10&1023|55296),t=56320|1023&t),s+=ot(t);return s}(s)}},vt=void 0!==vt?vt:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,mt=function(){try{return 2===new Blob(["hi"]).size}catch(y){return!1}}(),gt=mt&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(y){return!1}}(),yt=vt&&vt.prototype.append&&vt.prototype.getBlob;function bt(e){return e.map((function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var n=new Uint8Array(e.byteLength);n.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=n.buffer}return t}return e}))}function kt(e,t){t=t||{};var n=new vt;return bt(e).forEach((function(e){n.append(e)})),t.type?n.getBlob(t.type):n.getBlob()}function Et(e,t){return new Blob(bt(e),t||{})}"undefined"!=typeof Blob&&(kt.prototype=Blob.prototype,Et.prototype=Blob.prototype);var St=mt?gt?Blob:Et:yt?kt:void 0;!function(e){var t=Ke,n=et,i=nt,s=pt;"undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),"undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),e.protocol=3;var a=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},r=t(a),o={type:"error",data:"parser error"},u=St;e.encodePacket=function(e,t,n,i){"function"==typeof t&&(i=t,t=!1),"function"==typeof n&&(i=n,n=null),void 0===e.data||e.data.buffer||e.data;var r=a[e.type];return void 0!==e.data&&(r+=n?s.encode(String(e.data),{strict:!1}):String(e.data)),i(""+r)},e.decodePacket=function(e,t,n){if(void 0===e)return o;if("string"==typeof e){if(n&&!1===(e=function(e){try{e=s.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return o;var i=e.charAt(0);return Number(i)==i&&r[i]?e.length>1?{type:r[i],data:e.substring(1)}:{type:r[i]}:o}i=new Uint8Array(e)[0];var a=sliceBuffer(e,1);return u&&"blob"===t&&(a=new u([a])),{type:r[i],data:a}},e.encodePayload=function(t,s,a){"function"==typeof s&&(a=s,s=null);var r=n(t);if(!t.length)return a("0:");!function(e,t,n){for(var s=new Array(e.length),a=i(e.length,n),r=function(e,n,i){t(n,(function(t,n){s[e]=n,i(t,s)}))},o=0;o<e.length;o++)r(o,e[o],a)}(t,(function(t,n){e.encodePacket(t,!!r&&s,!0,(function(e){n(null,function(e){return e.length+":"+e}(e))}))}),(function(e,t){return a(t.join(""))}))},e.decodePayload=function(t,n,i){var s;if("function"==typeof n&&(i=n,n=null),""===t)return i(o,0,1);for(var a,r,u="",c=0,l=t.length;c<l;c++){var f=t.charAt(c);if(":"===f){if(""===u||u!=(a=Number(u)))return i(o,0,1);if(u!=(r=t.substr(c+1,a)).length)return i(o,0,1);if(r.length){if(s=e.decodePacket(r,n,!0),o.type===s.type&&o.data===s.data)return i(o,0,1);if(!1===i(s,c+a,l))return}c+=a,u=""}else u+=f}return""!==u?i(o,0,1):void 0}}(Je);var wt=Je,Ct=Mt;function Mt(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}(0,k.exports)(Mt.prototype),Mt.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},Mt.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},Mt.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},Mt.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},Mt.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},Mt.prototype.onData=function(e){var t=wt.decodePacket(e,this.socket.binaryType);this.onPacket(t)},Mt.prototype.onPacket=function(e){this.emit("packet",e)},Mt.prototype.onClose=function(){this.readyState="closed",this.emit("close")};var It,At={encode:function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},decode:function(e){for(var t={},n=e.split("&"),i=0,s=n.length;i<s;i++){var a=n[i].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return t}},Tt=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},_t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Nt={},Ot=0,Rt=0;function xt(e){var t="";do{t=_t[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function Pt(){var e=xt(+new Date);return e!==It?(Ot=0,It=e):e+"."+xt(Ot++)}for(;Rt<64;Rt++)Nt[_t[Rt]]=Rt;Pt.encode=xt,Pt.decode=function(e){var t=0;for(Rt=0;Rt<e.length;Rt++)t=64*t+Nt[e.charAt(Rt)];return t};var Dt=Pt,Ut={exports:{}};try{Ut.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(y){Ut.exports=!1}var Lt=Ut.exports,Ft=Ct,Gt=At,Bt=Je,qt=Tt,jt=Dt,Ht=Re.exports("engine.io-client:polling"),Vt=Wt,zt=null!=new function(e){var t=e.xdomain,n=e.xscheme,i=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||Lt))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&i)return new XDomainRequest}catch(e){}if(!t)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}({xdomain:!1}).responseType;function Wt(e){var t=e&&e.forceBase64;zt&&!t||(this.supportsBinary=!1),Ft.call(this,e)}qt(Wt,Ft),Wt.prototype.name="polling",Wt.prototype.doOpen=function(){this.poll()},Wt.prototype.pause=function(e){var t=this;function n(){Ht("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var i=0;this.polling&&(Ht("we are currently polling - waiting to pause"),i++,this.once("pollComplete",(function(){Ht("pre-pause polling complete"),--i||n()}))),this.writable||(Ht("we are currently writing - waiting to pause"),i++,this.once("drain",(function(){Ht("pre-pause writing complete"),--i||n()})))}else n()},Wt.prototype.poll=function(){Ht("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},Wt.prototype.onData=function(e){var t=this;Ht("polling got data %s",e),Bt.decodePayload(e,this.socket.binaryType,(function(e,n,i){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():Ht('ignoring poll - transport state "%s"',this.readyState))},Wt.prototype.doClose=function(){var e=this;function t(){Ht("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(Ht("transport open - closing"),t()):(Ht("transport not open - deferring close"),this.once("open",t))},Wt.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};Bt.encodePayload(e,this.supportsBinary,(function(e){t.doWrite(e,n)}))},Wt.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=jt()),this.supportsBinary||e.sid||(e.b64=1),e=Gt.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e};var Xt,Jt=Vt,Kt=en,Yt=/\n/g,Qt=/\\n/g;function $t(){}function Zt(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==y?y:{}}function en(e){if(Jt.call(this,e),this.query=this.query||{},!Xt){var t=Zt();Xt=t.___eio=t.___eio||[]}this.index=Xt.length;var n=this;Xt.push((function(e){n.onData(e)})),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){n.script&&(n.script.onerror=$t)}),!1)}Tt(en,Jt),en.prototype.supportsBinary=!1,en.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),Jt.prototype.doClose.call(this)},en.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)},en.prototype.doWrite=function(e,t){var n=this;if(!this.form){var i,s=document.createElement("form"),a=document.createElement("textarea"),r=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=r,s.method="POST",s.setAttribute("accept-charset","utf-8"),a.name="d",s.appendChild(a),document.body.appendChild(s),this.form=s,this.area=a}function o(){u(),t()}function u(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';i=document.createElement(e)}catch(e){(i=document.createElement("iframe")).name=n.iframeId,i.src="javascript:0"}i.id=n.iframeId,n.form.appendChild(i),n.iframe=i}this.form.action=this.uri(),u(),e=e.replace(Qt,"\\\n"),this.area.value=e.replace(Yt,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&o()}:this.iframe.onload=o};var tn,nn=Ct,sn=Je,an=At,rn=Tt,on=Dt,un=Re.exports("engine.io-client:websocket");("undefined"==typeof uni&&"undefined"==typeof wx&&"undefined"==typeof my||"undefined"!=typeof WebSocket)&&("undefined"!=typeof WebSocket?tn=WebSocket:"undefined"!=typeof self&&(tn=self.WebSocket||self.MozWebSocket));var cn=tn||void 0;("undefined"==typeof uni&&"undefined"==typeof wx&&"undefined"==typeof my||"undefined"!=typeof WebSocket)&&"undefined"==typeof GameGlobal||(cn=function(e){var t=this;if(t.onopen=function(){},t.onclose=function(){},t.onmessage=function(e){},t.onerror=function(e){},"object"==("undefined"===typeof tt?"undefined":(0,p.default)(tt))&&tt.getSystemInfo){var n=tt.connectSocket({url:e});t.send=function(e){n.send({data:e})},t.close=function(){n.close()},n.onOpen((function(){t.onopen()})),n.onError((function(e){t.onerror(e)})),n.onMessage((function(e){t.onmessage(e)})),n.onClose((function(){t.onclose()}))}else if("undefined"!=typeof my)my.connectSocket({url:e}),t.send=function(e){my.sendSocketMessage({data:e})},t.close=function(e){my.closeSocket()},my.onSocketOpen((function(e){t.onopen()})),my.onSocketError((function(e){t.onerror(e)})),my.onSocketMessage((function(e){t.onmessage(e)})),my.onSocketClose((function(e){t.onclose(e)}));else if("undefined"!=typeof uni)if("undefined"!=typeof my)my.connectSocket({url:e}),t.send=function(e){my.sendSocketMessage({data:e})},t.close=function(e){my.closeSocket()},my.onSocketOpen((function(e){t.onopen()})),my.onSocketError((function(e){t.onerror(e)})),my.onSocketMessage((function(e){t.onmessage(e)})),my.onSocketClose((function(e){t.onclose(e)}));else{var i=uni.connectSocket({url:e,complete:function(){}});t.send=function(e){i.send({data:e})},t.close=function(){i.close()},i.onOpen((function(e){t.onopen()})),i.onError((function(e){t.onerror(e)})),i.onMessage((function(e){t.onmessage(e)})),i.onClose((function(e){t.onclose()}))}else{var s=wx.connectSocket({url:e});t.send=function(e){s.send({data:e})},t.close=function(e){s.close({code:1e3})},s.onOpen((function(){t.onopen()})),s.onError((function(e){t.onerror(e)})),s.onMessage((function(e){t.onmessage(e)})),s.onClose((function(e){t.onclose(e)}))}});var ln=fn;function fn(e){e&&e.forceBase64&&(this.supportsBinary=!1),("undefined"==typeof uni&&"undefined"==typeof wx&&"undefined"==typeof my||"undefined"!=typeof WebSocket)&&(this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=tn&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(cn=void 0)),nn.call(this,e)}rn(fn,nn),fn.prototype.name="websocket",fn.prototype.supportsBinary=!1,fn.prototype.doOpen=function(){if(this.check()){var e,t,n=this.uri();("undefined"==typeof uni&&"undefined"==typeof wx&&"undefined"==typeof my||"undefined"!=typeof WebSocket)&&(e=this.protocols),(t=("undefined"!=typeof uni||"undefined"!=typeof wx&&"undefined"!=typeof my)&&"undefined"==typeof WebSocket?{agent:this.agent}:{agent:this.agent,perMessageDeflate:this.perMessageDeflate}).pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(t.headers=this.extraHeaders),this.localAddress&&(t.localAddress=this.localAddress);try{"undefined"==typeof uni&&"undefined"==typeof wx&&"undefined"==typeof my||"undefined"!=typeof WebSocket?this.ws=this.usingBrowserWebSocket&&!this.isReactNative?e?new cn(n,e):new cn(n):new cn(n,e,t):this.ws=new cn(n)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},fn.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},fn.prototype.write=function(e){var t=this;this.writable=!1;for(var n=e.length,i=0,a=n;i<a;i++)!function(e){sn.encodePacket(e,t.supportsBinary,(function(i){if("undefined"==typeof uni&&"undefined"==typeof wx&&"undefined"==typeof my||"undefined"!=typeof WebSocket){if(!t.usingBrowserWebSocket){var a={};e.options&&(a.compress=e.options.compress),t.perMessageDeflate&&("string"==typeof i?s.byteLength(i):i.length)<t.perMessageDeflate.threshold&&(a.compress=!1)}try{t.usingBrowserWebSocket?t.ws.send(i):t.ws.send(i,a)}catch(e){un("websocket closed before onclose event")}}else try{t.ws.send(i)}catch(e){un("websocket closed before onclose event")}--n||r()}))}(e[i]);function r(){t.emit("flush"),setTimeout((function(){t.writable=!0,t.emit("drain")}),0)}},fn.prototype.onClose=function(){nn.prototype.onClose.call(this)},fn.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},fn.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=on()),this.supportsBinary||(e.b64=1),(e=an.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},fn.prototype.check=function(){return!(!cn||"__initialize"in cn&&this.name===fn.prototype.name)};var dn=Kt,hn=ln;Xe.polling=function(e){var t=!1,n=!1;if(e.jsonp,"undefined"!=typeof location){var i="https:"===location.protocol,s=location.port;s||(s=i?443:80),t=e.hostname!==location.hostname||s!==e.port,n=e.secure!==i}return e.xdomain=t,e.xscheme=n,new dn(e)},Xe.websocket=hn;var pn=[].indexOf,vn=function(e,t){if(pn)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1},mn=Xe,gn=k.exports,yn=Re.exports("engine.io-client:socket"),bn=vn,kn=Je,En=Oe,Sn=At,wn=Cn;function Cn(e,t){if(!(this instanceof Cn))return new Cn(e,t);t=t||{},e&&"object"==(0,p.default)(e)&&(t=e,e=null),e?(e=En(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=En(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=Sn.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}Cn.priorWebsocketSuccess=!1,gn(Cn.prototype),Cn.protocol=kn.protocol,Cn.Socket=Cn,Cn.Transport=Ct,Cn.transports=Xe,Cn.parser=Je,Cn.prototype.createTransport=function(e){yn('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);t.EIO=kn.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new mn[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},Cn.prototype.open=function(){var e;if(this.rememberUpgrade&&Cn.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},Cn.prototype.setTransport=function(e){yn("setting transport %s",e.name);var t=this;this.transport&&(yn("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))},Cn.prototype.probe=function(e){yn('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,i=this;function s(){if(i.onlyBinaryUpgrades){var s=!this.supportsBinary&&i.transport.supportsBinary;n=n||s}n||(yn('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(function(s){if(!n)if("pong"===s.type&&"probe"===s.data){if(yn('probe transport "%s" pong',e),i.upgrading=!0,i.emit("upgrading",t),!t)return;Cn.priorWebsocketSuccess="websocket"===t.name,yn('pausing current transport "%s"',i.transport.name),i.transport.pause((function(){n||"closed"!==i.readyState&&(yn("changing transport and sending upgrade packet"),l(),i.setTransport(t),t.send([{type:"upgrade"}]),i.emit("upgrade",t),t=null,i.upgrading=!1,i.flush())}))}else{yn('probe transport "%s" failed',e);var a=new Error("probe error");a.transport=t.name,i.emit("upgradeError",a)}})))}function a(){n||(n=!0,l(),t.close(),t=null)}function r(n){var s=new Error("probe error: "+n);s.transport=t.name,a(),yn('probe transport "%s" failed because of error: %s',e,n),i.emit("upgradeError",s)}function o(){r("transport closed")}function u(){r("socket closed")}function c(e){t&&e.name!==t.name&&(yn('"%s" works - aborting "%s"',e.name,t.name),a())}function l(){t.removeListener("open",s),t.removeListener("error",r),t.removeListener("close",o),i.removeListener("close",u),i.removeListener("upgrading",c)}Cn.priorWebsocketSuccess=!1,t.once("open",s),t.once("error",r),t.once("close",o),this.once("close",u),this.once("upgrading",c),t.open()},Cn.prototype.onOpen=function(){if(yn("socket open"),this.readyState="open",Cn.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){yn("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},Cn.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(yn('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else yn('packet received with socket readyState "%s"',this.readyState)},Cn.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},Cn.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout((function(){"closed"!==t.readyState&&t.onClose("ping timeout")}),e||t.pingInterval+t.pingTimeout)},Cn.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout((function(){yn("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)}),e.pingInterval)},Cn.prototype.ping=function(){var e=this;this.sendPacket("ping",(function(){e.emit("ping")}))},Cn.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},Cn.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(yn("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Cn.prototype.write=Cn.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},Cn.prototype.sendPacket=function(e,t,n,i){if("function"==typeof t&&(i=t,t=void 0),"function"==typeof n&&(i=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var s={type:e,data:t,options:n};this.emit("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}},Cn.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?i():t()})):this.upgrading?i():t()}function t(){e.onClose("forced close"),yn("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function i(){e.once("upgrade",n),e.once("upgradeError",n)}return this},Cn.prototype.onError=function(e){yn("socket error %j",e),Cn.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},Cn.prototype.onClose=function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(yn('socket close with reason: "%s"',e),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)},Cn.prototype.filterUpgrades=function(e){for(var t=[],n=0,i=e.length;n<i;n++)~bn(this.transports,e[n])&&t.push(e[n]);return t},We.exports=wn,We.exports.parser=Je;var Mn={exports:{}},In=function(e,t){for(var n=[],i=(t=t||0)||0;i<e.length;i++)n[i-t]=e[i];return n},An=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}},Tn=[].slice,_n=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=Tn.call(arguments,2);return function(){return t.apply(e,n.concat(Tn.call(arguments)))}};!function(e,t){var n=He,i=k.exports,s=In,a=An,r=_n,o=(Re.exports("socket.io-client:socket"),At),u=et;e.exports=f;var c={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},l=i.prototype.emit;function f(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}i(f.prototype),f.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[a(e,"open",r(this,"onopen")),a(e,"packet",r(this,"onpacket")),a(e,"close",r(this,"onclose"))]}},f.prototype.open=f.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},f.prototype.send=function(){var e=s(arguments);return e.unshift("message"),this.emit.apply(this,e),this},f.prototype.emit=function(e){if(c.hasOwnProperty(e))return l.apply(this,arguments),this;var t=s(arguments),i={type:(void 0!==this.flags.binary?this.flags.binary:u(t))?n.BINARY_EVENT:n.EVENT,data:t,options:{}};return i.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(this.ids,this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),this.flags={},this},f.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},f.prototype.onopen=function(){if("/"!==this.nsp)if(this.query){var e="object"==(0,p.default)(this.query)?o.encode(this.query):this.query;this.packet({type:n.CONNECT,query:e})}else this.packet({type:n.CONNECT})},f.prototype.onclose=function(e){this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},f.prototype.onpacket=function(e){var t=e.nsp===this.nsp,i=e.type===n.ERROR&&"/"===e.nsp;if(t||i)switch(e.type){case n.CONNECT:this.onconnect();break;case n.EVENT:case n.BINARY_EVENT:this.onevent(e);break;case n.ACK:case n.BINARY_ACK:this.onack(e);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",e.data)}},f.prototype.onevent=function(e){var t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?l.apply(this,t):this.receiveBuffer.push(t)},f.prototype.ack=function(e){var t=this,i=!1;return function(){if(!i){i=!0;var a=s(arguments);t.packet({type:u(a)?n.BINARY_ACK:n.ACK,id:e,data:a})}}},f.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(e.id,e.data,t.apply(this,e.data),delete this.acks[e.id]):e.id},f.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},f.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)l.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},f.prototype.ondisconnect=function(){this.nsp,this.destroy(),this.onclose("io server disconnect")},f.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},f.prototype.close=f.prototype.disconnect=function(){return this.connected&&(this.nsp,this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},f.prototype.compress=function(e){return this.flags.compress=e,this},f.prototype.binary=function(e){return this.flags.binary=e,this}}(Mn);var Nn=On;function On(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}On.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},On.prototype.reset=function(){this.attempts=0},On.prototype.setMin=function(e){this.ms=e},On.prototype.setMax=function(e){this.max=e},On.prototype.setJitter=function(e){this.jitter=e};var Rn=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,null,[{key:"get",value:function(e){var t,n=encodeURIComponent(e)+"=",i=document.cookie.split("; "),s=(0,d.default)(i);try{for(s.s();!(t=s.n()).done;){var a=t.value;if(a.startsWith(n))return decodeURIComponent(a.substring(n.length))}}catch(r){s.e(r)}finally{s.f()}return null}},{key:"set",value:function(e,t,n,i){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"/",a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=encodeURIComponent(e)+"="+encodeURIComponent(t);n instanceof Date&&(r+="; expires="+n.toGMTString()),s&&(r+="; path="+s),i&&(r+="; domain="+i),a&&(r+="; secure"),document.cookie=r}},{key:"remove",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/",s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.set(t,"",new Date(0),n,i,s)}}]),e}(),xn=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"asyncGet",value:function(e){var t=this.get(e);return Promise.resolve(t)}},{key:"asyncPut",value:function(e,t){return this.put(e,t),Promise.resolve()}},{key:"get",value:function(e){var t=this.doGet(e);return t=JSON.parse(t),t}},{key:"put",value:function(e,t){this.doPut(e,JSON.stringify(t))}}]),e}(),Pn=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){var e;return(0,m.default)(this,n),e=t.call(this),e.domain=null,e.domain="undefined"!=typeof location&&/^(?:[A-za-z0-9-]+\.)+[A-za-z]{2,4}(?:[\/\?#][\/=\?%\-&~`@[\]\':+!\.#\w]*)?$/.test(location.host)?location.host.split(".").slice(-2).join("."):null,e}return(0,g.default)(n,[{key:"doGet",value:function(e){return Rn.get(e)||null}},{key:"doPut",value:function(e,t){var n=new Date(2030,12,31,0,0,0,0),i=this.domain;Rn.set(e,t,n,i)}},{key:"remove",value:function(e){var t=this.domain;Rn.remove(e,t)}},{key:"support",value:function(){return"undefined"!=typeof navigator&&!0===navigator.cookieEnabled}}]),n}(xn),Dn=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"doGet",value:function(e){return localStorage.getItem(e)||null}},{key:"doPut",value:function(e,t){localStorage.setItem(e,t)}},{key:"remove",value:function(e){localStorage.removeItem(e)}},{key:"support",value:function(){return!("undefined"!=typeof GameGlobal||"undefined"==typeof localStorage||!localStorage.setItem)}}]),n}(xn),Un=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"doGet",value:function(e){return uni.getStorageSync(e)||null}},{key:"doPut",value:function(e,t){uni.setStorageSync(e,t)}},{key:"remove",value:function(e){uni.removeStorageSync(e)}},{key:"support",value:function(){return!("object"!=("undefined"===typeof uni?"undefined":(0,p.default)(uni))||!uni.getStorageSync)}}]),n}(xn),Ln=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"doGet",value:function(e){return cc.sys.localStorage.getItem(e)||null}},{key:"doPut",value:function(e,t){cc.sys.localStorage.setItem(e,t)}},{key:"remove",value:function(e){cc.sys.localStorage.removeItem(e)}},{key:"support",value:function(){return"undefined"!=typeof cc&&void 0!==cc.sys.localStorage}}]),n}(xn),Fn=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"doGet",value:function(e){return wx.getStorageSync(e)||null}},{key:"doPut",value:function(e,t){wx.setStorageSync(e,t)}},{key:"remove",value:function(e){wx.removeStorageSync(e)}},{key:"support",value:function(){return!("object"!=("undefined"===typeof wx?"undefined":(0,p.default)(wx))||!wx.getStorageSync)}}]),n}(xn),Gn=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"asyncGet",value:function(e){return Se(this,void 0,void 0,(0,h.default)().mark((function t(){var n;return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,_.asyncStorage.getItem(e);case 2:return n=t.sent,t.abrupt("return",JSON.parse(n));case 4:case"end":return t.stop()}}),t)})))}},{key:"asyncPut",value:function(e,t){return _.asyncStorage.setItem(e,JSON.stringify(t))}},{key:"doPut",value:function(e,t){throw new Error("Method not implemented.")}},{key:"remove",value:function(e){_.asyncStorage.removeItem(e)}},{key:"support",value:function(){return T.currentFramework()===S.REACT_NATIVE}},{key:"doGet",value:function(e){throw new Error("Method not implemented.")}}]),n}(xn),Bn=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"doGet",value:function(e){var t=my.getStorageSync({key:e}).data||null;return JSON.parse(t)}},{key:"doPut",value:function(e,t){my.setStorageSync({key:e,data:JSON.stringify(t)})}},{key:"remove",value:function(e){my.removeStorageSync({key:e})}},{key:"support",value:function(){return!("undefined"==typeof my||!my.getStorageSync)}}]),n}(xn),qn=function(){function e(){(0,m.default)(this,e),this.supportedStorage=null;var t=e.storages;t.push(new Un),t.push(new Ln),t.push(new Dn),t.push(new Fn),t.push(new Gn),t.push(new Bn),t.push(new Pn),this.dispatch(),this.supportedStorage}return(0,g.default)(e,[{key:"dispatch",value:function(){var t,n=(0,d.default)(e.storages);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.support()){this.supportedStorage=i;break}}}catch(s){n.e(s)}finally{n.f()}}}],[{key:"localStorage",value:function(){return this.instance.supportedStorage}}]),e}();qn.storages=new Array,qn.instance=new qn;var jn=new(function(){function e(){(0,m.default)(this,e),this.INDEX_KEY="DOMAIN_INDEX",this.MAX=5,this.storage=qn.localStorage(),this.init()}return(0,g.default)(e,[{key:"init",value:function(){return Se(this,void 0,void 0,(0,h.default)().mark((function e(){return(0,h.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.t0=this.support(),!e.t0){e.next=13;break}if(this.index=Math.floor(Math.random()*(this.MAX-1)+1),e.t1=null!==this.storage,!e.t1){e.next=13;break}return e.t3=parseInt,e.next=8,this.storage.asyncGet(this.INDEX_KEY);case 8:if(e.t4=e.sent,e.t2=(0,e.t3)(e.t4),e.t2){e.next=12;break}e.t2=this.index;case 12:this.index=e.t2;case 13:case"end":return e.stop()}}),e,this)})))}},{key:"refresh",value:function(){return Se(this,void 0,void 0,(0,h.default)().mark((function e(){var t;return(0,h.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.index,t>0&&t<this.MAX?t+=1:t===this.MAX&&(t=1),e.t0=null!==this.storage,!e.t0){e.next=7;break}return this.index=t,e.next=7,this.storage.asyncPut(this.INDEX_KEY,t);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"i",value:function(){var e=this.index;return this.refresh(),e}},{key:"support",value:function(){return[E.BROWSER].includes(A.currentPlatform())}}]),e}()),Hn=b(Object.freeze({__proto__:null,domainIndex:jn})),Vn=b(q),zn=We.exports,Wn=Mn.exports,Xn=k.exports,Jn=He,Kn=An,Yn=_n,Qn=(Re.exports("socket.io-client:manager"),vn),$n=Nn,Zn=Hn.domainIndex,ei=Vn.uniApp,ti=Object.prototype.hasOwnProperty,ni=ii;function ii(e,t){if(!(this instanceof ii))return new ii(e,t);e&&"object"==(0,p.default)(e)&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new $n({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||Jn;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}function si(){var e=!1;return"object"==("undefined"===typeof uni?"undefined":(0,p.default)(uni))&&uni.getSystemInfo&&(e=!0),e&&ei.runningBackend()}ii.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)ti.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},ii.prototype.updateSocketIds=function(){for(var e in this.nsps)ti.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},ii.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},Xn(ii.prototype),ii.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},ii.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},ii.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},ii.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},ii.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},ii.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},ii.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},ii.prototype.open=ii.prototype.connect=function(e,t){if(this.readyState,~this.readyState.indexOf("open"))return this;this.uri,this.engine=zn(this.uri,this.opts);var n=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var s=Kn(n,"open",(function(){i.onopen(),e&&e()})),a=Kn(n,"error",function(){var t=(0,c.default)((0,h.default)().mark((function t(n){var s,a,r;return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!Zn.support()){t.next=6;break}return s=parseInt(i.uri.match(/[1-9][0-9]*/g)[0]),t.next=4,Zn.i();case 4:a=t.sent,i.uri=i.uri.replace(s,a);case 6:i.cleanup(),i.readyState="closed",i.emitAll("connect_error",n),e?(r=new Error("Connection error"),r.data=n,e(r)):i.maybeReconnectOnOpen();case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());if(!1!==this._timeout){var r=this._timeout,o=setTimeout((function(){s.destroy(),n.close(),n.emit("error","timeout"),i.emitAll("connect_timeout",r)}),r);this.subs.push({destroy:function(){clearTimeout(o)}})}return this.subs.push(s),this.subs.push(a),this},ii.prototype.onopen=function(){this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(Kn(e,"data",Yn(this,"ondata"))),this.subs.push(Kn(e,"ping",Yn(this,"onping"))),this.subs.push(Kn(e,"pong",Yn(this,"onpong"))),this.subs.push(Kn(e,"error",Yn(this,"onerror"))),this.subs.push(Kn(e,"close",Yn(this,"onclose"))),this.subs.push(Kn(this.decoder,"decoded",Yn(this,"ondecoded")))},ii.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},ii.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},ii.prototype.ondata=function(e){this.decoder.add(e)},ii.prototype.ondecoded=function(e){this.emit("packet",e)},ii.prototype.onerror=function(e){this.emitAll("error",e)},ii.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new Wn(this,e,t),this.nsps[e]=n;var i=this;n.on("connecting",s),n.on("connect",(function(){n.id=i.generateId(e)})),this.autoConnect&&s()}function s(){~Qn(i.connecting,n)||i.connecting.push(n)}return n},ii.prototype.destroy=function(e){var t=Qn(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},ii.prototype.packet=function(e){var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,(function(n){for(var i=0;i<n.length;i++)t.engine.write(n[i],e.options);t.encoding=!1,t.processPacketQueue()})))},ii.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},ii.prototype.cleanup=function(){for(var e=this.subs.length,t=0;t<e;t++)this.subs.shift().destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},ii.prototype.close=ii.prototype.disconnect=function(){this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},ii.prototype.onclose=function(e){this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},ii.prototype.reconnect=function(){if(si(),this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();this.reconnecting=!0;var n=setTimeout((function(){e.skipReconnect||(e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||(si()?(e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error","Uniapp running backend, skipped reconnect...")):e.open((function(t){t?(e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):e.onreconnect()}))))}),t);this.subs.push({destroy:function(){clearTimeout(n)}})}},ii.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)},function(e,t){var n=je,i=He,s=ni;Re.exports("socket.io-client"),e.exports=t=r;var a=t.managers={};function r(e,t){"object"==(0,p.default)(e)&&(t=e,e=void 0),t=t||{};var i,r=n(e),o=r.source,u=r.id,c=r.path,l=a[u]&&c in a[u].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||l?i=s(o,t):(a[u]||(a[u]=s(o,t)),i=a[u]),r.query&&!t.query&&(t.query=r.query),i.socket(r.path,t)}t.protocol=i.protocol,t.connect=r,t.Manager=ni,t.Socket=Mn.exports}(Te,Te.exports);var ai,ri,oi,ui,ci=Te.exports,li=function(){function e(){(0,m.default)(this,e),this.io=ci,this.status=w.DISCONNECTED,this.permissions=[re.NONE],this.connectedObservers=[],this.disconnectedObservers=[]}return(0,g.default)(e,[{key:"connect",value:function(){this.status=w.CONNECTING}},{key:"socketio",value:function(){return this.io}},{key:"on",value:function(e,t){this.io.on(e,t)}},{key:"disconnect",value:function(){this.io.disconnect()}},{key:"getStatus",value:function(){return this.status}},{key:"addConnectedObserver",value:function(e){G.isFunction(e)&&this.connectedObservers.push(e)}},{key:"addDisconnectedObserver",value:function(e){G.isFunction(e)&&this.disconnectedObservers.push(e)}},{key:"notify",value:function(e,t){for(var n=0;n<e.length;n++)e[n](t)}}]),e}(),fi=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(e){var i;return(0,m.default)(this,n),i=t.call(this),i.reconnectingObservers=[],i.addReconnectingObserver(e.onReconnecting),i.addDisconnectedObserver(e.onDisconnected),i}return(0,g.default)(n,[{key:"connect",value:function(e){(0,o.default)((0,u.default)(n.prototype),"connect",this).call(this),this.io=this.io.connect(e.uri,e.opts),this.initListener()}},{key:"initListener",value:function(){var e=this;this.io.on("connect",(function(){e.status=w.CONNECTED,e.notify(e.connectedObservers)})),this.io.on("reconnecting",(function(t){e.status=w.CONNECTING,e.notify(e.reconnectingObservers,t)})),this.io.on("disconnect",(function(){e.status=w.DISCONNECTED,e.notify(e.disconnectedObservers)})),this.io.on("connect_error",(function(e){}))}},{key:"addReconnectingObserver",value:function(e){this.reconnectingObservers.push(e)}}]),n}(li),di=function(){function e(t){(0,m.default)(this,e),this.callback=pe,this.guidList=[],this.callback=t}return(0,g.default)(e,[{key:"onMessage",value:function(e,t){if("string"==typeof t&&(t=JSON.parse(t)),t.i){if(this.guidList.findIndex((function(e){return e===t.i}))>-1)return;this.guidList.unshift(t.i),this.guidList.length>300&&this.guidList.pop()}this.callback(t)}}]),e}();!function(e){e.MANUAL_DISCONNECTED="MANUAL_DISCONNECTED"}(ai||(ai={}));var hi=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,null,[{key:"get",value:function(){return Se(this,void 0,void 0,(0,h.default)().mark((function t(){var n,i;return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=qn.localStorage(),t.t0=null!==i,!t.t0){t.next=6;break}return t.next=5,i.asyncGet(e.SM_KEY);case 5:n=t.sent;case 6:return t.abrupt("return",n);case 7:case"end":return t.stop()}}),t)})))}},{key:"put",value:function(t){return Se(this,void 0,void 0,(0,h.default)().mark((function n(){var i,s;return(0,h.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:i=qn.localStorage(),s=t.sm,null!==i&&s&&i.asyncPut(e.SM_KEY,s);case 3:case"end":return n.stop()}}),n)})))}}]),e}();hi.SM_KEY="GE-SM";var pi=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,null,[{key:"e",value:function(e,t){function n(e){return function(e){return e>=32&&e<=126}(e)?String.fromCharCode(function(e){var n=e+t;return n>126?n-126+32:n}(e)):String.fromCharCode(e)}for(var i="",s=0;s<e.length;s++)i+=n(e.charCodeAt(s));return i}}]),e}(),vi=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,null,[{key:"initRNUniqueId",value:function(){if(T.currentFramework()===S.REACT_NATIVE){var e=_.platform,t=e.constants,n={os:e.OS};return"android"===n.os?n.f=t.Fingerprint:n.v=e.Version,JSON.stringify(n)}return null}},{key:"initPlusDeviceId",value:function(){return new Promise((function(e,t){"undefined"!=typeof plus?plus.device.getInfo({success:function(t){e(t.uuid)},fail:function(e){t(e)}}):e(null)}))}},{key:"getVideoCard",value:function(){var e;if(A.currentPlatform()===E.BROWSER&&"undefined"!=typeof document){var t=document.createElement("canvas"),n=null!==(e=t.getContext("webgl"))&&void 0!==e?e:t.getContext("experimental-webgl");if(n&&"getExtension"in n){var i=0,s=0;if(navigator.userAgent.indexOf("Firefox")>-1)s=n.VENDOR,i=n.RENDERER;else{var a=n.getExtension("WEBGL_debug_renderer_info");if(!a)return null;s=a.UNMASKED_VENDOR_WEBGL,i=a.UNMASKED_RENDERER_WEBGL}var r={vendor:(n.getParameter(s)||"").toString(),renderer:(n.getParameter(i)||"").toString()};return JSON.stringify(r)}}return null}},{key:"z",value:function(){return Se(this,void 0,void 0,(0,h.default)().mark((function e(){var t;return(0,h.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={p:A.currentPlatform(),f:T.currentFramework(),vc:this.getVideoCard(),rfp:this.initRNUniqueId()},e.abrupt("return",pi.e(JSON.stringify(t),5));case 2:case"end":return e.stop()}}),e,this)})))}}]),e}(),mi=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(e,i){var s;return(0,m.default)(this,n),s=t.call(this),s.ioSocket=null,s.sid=null,s.anonymous=!1,s.userId=null,s.artifactVersion=U,s.uri=null,s.ioOpts=null,s.reconnectingTimes=0,s.messageObservers={},s.connectFailedObservers=[],s.connectingObservers=[],s.expiredReconnectedObservers=[],s.options=e,s.connectOptions=i,s.ioSocket=new fi({onDisconnected:s.onIoDisconnected.bind((0,r.default)(s)),onReconnecting:s.onIoReconnecting.bind((0,r.default)(s))}),s.ioSocketEmitter=new P(s.ioSocket),s.ioSocket.addConnectedObserver(s.onIoReconnected.bind((0,r.default)(s))),s.initUserId(),s.addConnectedObserver(i.onSuccess),s.addConnectFailedObserver(i.onFailed),s.addConnectingObserver(i.onProgress),s}return(0,g.default)(n,[{key:"initUserId",value:function(){var e=this.connectOptions.id;G.isEmpty(e)?this.anonymous=!0:this.userId=e.toString()}},{key:"socketio",value:function(){return this.ioSocket.socketio()}},{key:"extendOptions",value:function(){var e=this.connectOptions;if(G.isNull(e.data)||G.isDef(e.data)&&!G.isObject(e.data))throw{code:400,content:"TypeError: data requires an object."};if((G.isDef(e.data)?String(e.data).length:0)>300&&G.isObject(e)&&G.isFunction(e.onFailed))throw{code:400,content:"user.data-length limit 300 byte."};if(G.isObject(e.wxmpId)){if(G.isEmpty(e.wxmpId.appid))throw{code:400,content:"wxmpId.appid is required."};if(G.isEmpty(e.wxmpId.openid))throw{code:400,content:"wxmpId.openid is required. requires string."}}else if(G.isPrimitive(e.wxmpId))throw{code:400,content:"TypeError: wxmpId requires an object."}}},{key:"initUriAndOpts",value:function(){var e=this.options,t=!0;if(jn.support()){var n,i="://"+jn.i()+e.host;!0===e.supportOldBrowser?(n=["polling","websocket"],t=!1):n=["websocket"],!1!==e.forceTLS&&t?this.uri="https"+i+":443":this.uri="http"+i+":80",this.ioOpts={transports:n,timeout:ue.connect}}else this.uri="https://wx-"+e.host+":443",this.ioOpts={transports:["websocket"],reconnectionDelayMax:ue.reconnectionDelayMax}}},{key:"onIoReconnected",value:function(){this.status===w.RECONNECTING&&this.authorize()}},{key:"sendAck",value:function(e,t){this.ioSocket.io.emit(e,t)}},{key:"connect",value:function(){this.initUriAndOpts(),this.extendOptions(),(0,o.default)((0,u.default)(n.prototype),"connect",this).call(this),this.onConnecting(),this.ioSocket.connect({uri:this.uri,opts:this.ioOpts}),this.authorize()}},{key:"disconnect",value:function(){var e=this;return new Promise((function(t,n){var i=function(){e.status=w.DISCONNECTED,e.ioSocket.disconnect(),I.fire(ai.MANUAL_DISCONNECTED),t()};if(e.options.allowNotification){var s=new fe({name:oe.manualDisconnect,params:{},permission:re.READ,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,fail:function(e){n(e)},success:i});D.e(s)}else i()}))}},{key:"initRegId",value:function(){return Se(this,void 0,void 0,(0,h.default)().mark((function e(){var t;return(0,h.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=he.instance,!(t&&t.supportNotification()&&t.getRegIdPromise())){e.next=12;break}return e.prev=2,e.next=5,t.getRegIdPromise();case 5:this.regId=e.sent,this.regId,e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](2),console.warn("Failed to register the Manufacturers Push service:"+JSON.stringify(e.t0));case 12:case"end":return e.stop()}}),e,this,[[2,9]])})))}},{key:"authorize",value:function(){return Se(this,void 0,void 0,(0,h.default)().mark((function e(){var t=this;return(0,h.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.initRegId().then((function(){return Se(t,void 0,void 0,(0,h.default)().mark((function e(){var t,n,i,s=this;return(0,h.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.connectOptions,e.t0=this.options.appkey,e.t1=this.userId,e.t2=JSON.stringify(t.data),e.t3=t.otp,e.t4=this.artifactVersion,e.t5=this.sid,e.t6=this.options.allowNotification,e.t7=this.regId,e.t8=t.wxmpId,e.t9=this.options.modules,e.t10=this.anonymous,e.next=14,vi.z();case 14:return e.t11=e.sent,e.next=17,hi.get();case 17:e.t12=e.sent,n={appkey:e.t0,userId:e.t1,userData:e.t2,otp:e.t3,artifactVersion:e.t4,sid:e.t5,allowNT:e.t6,regId:e.t7,wxmpId:e.t8,modules:e.t9,a:e.t10,z:e.t11,sm:e.t12},JSON.stringify(n),i=new fe({name:oe.authorize,params:n,permission:re.NONE,singleTimeout:ue.commonInfiniteSingle,totalTimeout:ue.commonInfiniteTotal,success:function(e){s.onAuthorizeSuccess(e)},fail:function(e){s.onAuthorizeFailed(e)}}),this.ioSocketEmitter.emit(i);case 22:case"end":return e.stop()}}),e,this)})))}));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"onConnecting",value:function(){this.notify(this.connectingObservers,this.reconnectingTimes)}},{key:"onIoReconnecting",value:function(){this.reconnectingTimes++,this.status==w.CONNECTED||this.status==w.EXPIRED_RECONNECTED||this.status==w.RECONNECTING?this.status=w.RECONNECTING:this.status=w.CONNECTING,this.onConnecting()}},{key:"onIoDisconnected",value:function(){this.status==w.DISCONNECTING&&(this.status=w.DISCONNECTED),this.notify(this.disconnectedObservers)}},{key:"onAuthorizeSuccess",value:function(e){hi.put(e),this.status===w.RECONNECTING?this.sid!==e.sid?(this.status=w.EXPIRED_RECONNECTED,this.sid=e.sid,this.notify(this.expiredReconnectedObservers)):this.status=w.RECONNECTED:(this.status=w.CONNECTED,this.sid=e.sid),e.enablePublish&&(this.permissions.find((function(e){return e==re.WRITE}))||this.permissions.push(re.WRITE)),e.enableSubscribe&&(this.permissions.find((function(e){return e==re.READ}))||this.permissions.push(re.READ)),this.reconnectingTimes=0,this.notify(this.connectedObservers)}},{key:"onAuthorizeFailed",value:function(e){this.ioSocket.disconnect(),this.status=w.CONNECT_FAILED;var t={code:e.resultCode||408,content:e.content||"Host unreachable or timeout"};this.notify(this.connectFailedObservers,t)}},{key:"addConnectingObserver",value:function(e){G.isFunction(e)&&this.connectingObservers.push(e)}},{key:"addConnectFailedObserver",value:function(e){G.isFunction(e)&&this.connectFailedObservers.push(e)}},{key:"addExpiredReconnectedObserver",value:function(e){G.isFunction(e)&&this.expiredReconnectedObservers.push(e)}},{key:"addMessageObserver",value:function(e,t){var n=this;this.messageObservers[e]||(this.messageObservers[e]=[],this.ioSocket.io.on(e,(function(t){n.notifyMessageObservers(e,t)}))),this.messageObservers[e].push(new di(t))}},{key:"notifyMessageObservers",value:function(e,t){for(var n=this.messageObservers[e],i=0;i<n.length;i++)n[i].onMessage(e,t)}}]),n}(li);!function(e){e.PRIVATE_MESSAGE_RECEIVED="PRIVATE_MESSAGE_RECEIVED",e.GROUP_MESSAGE_RECEIVED="GROUP_MESSAGE_RECEIVED",e.SYSTEM_MESSAGE_RECEIVED="SYSTEM_MESSAGE_RECEIVED",e.CONVERSATIONS_UPDATED="CONVERSATIONS_UPDATED",e.USER_PRESENCE="USER_PRESENCE",e.GROUP_PRESENCE="GROUP_PRESENCE",e.MESSAGE_DELETED="MESSAGE_DELETED",e.MESSAGE_READ="MESSAGE_READ",e.MESSAGE_RECALLED="MESSAGE_RECALLED",e.CS_MESSAGE_RECEIVED="CS_MESSAGE_RECEIVED",e.PENDING_CONVERSATIONS_UPDATED="PENDING_CONVERSATIONS_UPDATED"}(ri||(ri={})),function(e){e.VIDEO="VIDEO",e.VOICE="VOICE"}(oi||(oi={})),function(e){e.RING="RING",e.USER_ACCEPTED="USER_ACCEPTED",e.CALL_ENDED="CALL_ENDED",e.USER_QUITED="USER_QUITED"}(ui||(ui={}));var gi,yi=k.exports,bi=function(){function e(){(0,m.default)(this,e),this.emitter=new yi}return(0,g.default)(e,[{key:"on",value:function(e,t){if(!G.isString(e))throw Error("event require a string.");if(!G.isDef(ri[e])&&!G.isDef(ui[e]))throw Error("An event that is not defined");if(!G.isFunction(t))throw Error("callback must be a function");this.emitter.on(e,t)}},{key:"fire",value:function(e,t){this.emitter.emit(e,t)}},{key:"off",value:function(e,t){this.emitter.off(e,t)}}]),e}(),ki=(0,g.default)((function e(){(0,m.default)(this,e)})),Ei=new(function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.call(this)}return(0,g.default)(n,[{key:"upload",value:function(e,t){var n=this;try{return delete e.parameters.fileRes,new Promise((function(i,s){uni.uploadFile({url:e.host,filePath:n.getTempFilePath(e),name:"file",formData:e.parameters,success:function(e){200===e.statusCode?i():s({code:e.statusCode,content:e.errMsg})},fail:function(e){s({code:500,content:e.errMsg})}}).onProgressUpdate((function(e){t&&t(e)}))}))}catch(e){return new Promise((function(t,n){n({code:500,content:e})}))}}},{key:"getTempFilePath",value:function(e){var t=e.file;return t.tempFilePath||t.fullPath||t.path}}]),n}(ki)),Si=new(function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"upload",value:function(e,t){var n=this;try{return new Promise((function(i,s){wx.uploadFile({url:e.host,filePath:n.getTempFilePath(e),name:"file",formData:e.parameters,success:function(e){200===e.statusCode?i():s({code:e.statusCode,content:e.errMsg})},fail:function(e){s({code:500,content:e.errMsg})}}).onProgressUpdate((function(e){t&&t(e)}))}))}catch(e){return new Promise((function(t,n){n({code:500,content:e})}))}}},{key:"getTempFilePath",value:function(e){var t=e.file||e.fileRes;return t.path||t.tempFilePath}}]),n}(ki)),wi=new(function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.call(this)}return(0,g.default)(n,[{key:"upload",value:function(e,t){try{return new Promise((function(n,i){var s=new XMLHttpRequest;for(var a in s.open("post",e.host,!0),e.headers)s.setRequestHeader(a,e.headers[a]);s.upload.onprogress=function(e){t&&t(e)},s.upload.onloadstart=function(e){t&&t(e)},s.upload.onloadend=function(e){t&&t(e)};var r=new FormData;for(var o in e.parameters)"fileRes"==o?r.append("file",e.parameters[o]):r.append(o,e.parameters[o]);s.send(r),s.onreadystatechange=function(){4==s.readyState&&(s.status>=200&&s.status<300||304==s.status?n():i({code:s.status,content:s.responseText}))}}))}catch(e){return new Promise((function(t,n){n({code:500,content:e})}))}}}]),n}(ki)),Ci=(0,g.default)((function e(t,n,i){(0,m.default)(this,e),this.storageLocation=t,this.url=n,this.name=i})),Mi=new(function(){function e(){var t;(0,m.default)(this,e),this.uploader=(t={},(0,v.default)(t,S.UNIAPP,Ei),(0,v.default)(t,S.NATIVE_APPLET_WX,Si),(0,v.default)(t,S.TARO,A.currentPlatform()===E.APPLET_WX?Si:wi),(0,v.default)(t,S.UNKNOWN,wi),t)}return(0,g.default)(e,[{key:"upload",value:function(e,t){return Se(this,void 0,void 0,(0,h.default)().mark((function n(){var i,s;return(0,h.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=T.currentFramework(),s=this.uploader[i],n.next=4,s.upload(e,t);case 4:return n.abrupt("return",new Ci(e.storageLocation,e.url,e.newFileName));case 5:case"end":return n.stop()}}),n,this)})))}}]),e}()),Ii=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"resolve",value:function(e){return new Promise((function(t,n){var i=new fe({name:"uploadToken",params:{filename:e},permission:re.WRITE,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,fail:function(e){n(e.content)},success:function(e){200===e.code?t(e.content):n(e.content)}});D.e(i)}))}}]),e}();!function(e){e.aliYun="ALI",e.qiNiu="QN",e.tencent="TX"}(gi||(gi={}));var Ai,Ti,_i,Ni=(0,g.default)((function e(t,n,i,s,a,r,o){(0,m.default)(this,e),this.storageLocation=t,this.host=n,this.headers=i,this.parameters=s,this.file=a,this.newFileName=r,this.url=o})),Oi=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"newFileName",value:function(e){return e&&e.newFilename||""}}]),e}(),Ri=new(function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.call(this)}return(0,g.default)(n,[{key:"url",value:function(e){return e.host+"/"+e.dir+"/"+this.newFileName(e)}},{key:"build",value:function(e,t,n){var i,s=this.newFileName(e);return i={key:e.dir+"/"+s,OSSAccessKeyId:e.accessKeyId,policy:e.policy,signature:e.signature,success_action_status:"200",fileRes:t},n&&(i={key:e.dir+"/"+s,OSSAccessKeyId:e.accessKeyId,policy:e.policy,signature:e.signature,success_action_status:"200","Content-Disposition":"attachment;filename="+t.name,fileRes:t}),new Ni(gi.aliYun,e.host,null,i,t,s,this.url(e))}}]),n}(Oi)),xi=new(function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.call(this)}return(0,g.default)(n,[{key:"url",value:function(e){return e.host+"/"+e.key}},{key:"build",value:function(e,t,n){var i={"q-sign-algorithm":e.qSignAlgorithm,"q-ak":e.qAk,"q-key-time":e.qKeyTime,"q-signature":e.qSignature,policy:e.policy,"x-cos-security-token":e.xCosSecurityToken,success_action_status:"200",key:e.key,fileRes:t};return n&&(i={"q-sign-algorithm":e.qSignAlgorithm,"q-ak":e.qAk,"q-key-time":e.qKeyTime,"q-signature":e.qSignature,policy:e.policy,"x-cos-security-token":e.xCosSecurityToken,success_action_status:"200",key:e.key,"Content-Disposition":"attachment;filename=".concat(t.name),fileRes:t}),new Ni(gi.tencent,e.host,null,i,t,e.key,this.url(e))}}]),n}(Oi)),Pi=function(){function e(){(0,m.default)(this,e),this.uploadTokenResolver=new Ii}return(0,g.default)(e,[{key:"builder",value:function(e){if(e===gi.aliYun)return Ri;if(e===gi.tencent)return xi;throw new Error("Only Ali OSS and Tencent COS are supported, unknown storage location:"+e)}},{key:"build",value:function(e,t,n){return Se(this,void 0,void 0,(0,h.default)().mark((function i(){var s,a;return(0,h.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,this.uploadTokenResolver.resolve(t);case 3:return s=i.sent,a=this.builder(s.vendor).build(s,e,n),i.abrupt("return",Promise.resolve(a));case 8:return i.prev=8,i.t0=i["catch"](0),i.abrupt("return",Promise.reject(i.t0));case 11:case"end":return i.stop()}}),i,this,[[0,8]])})))}}]),e}(),Di=function(){function e(){(0,m.default)(this,e),this.requestBuilder=new Pi,this.fileUploader=Mi}return(0,g.default)(e,[{key:"upload",value:function(e,t,n,i){return Se(this,void 0,void 0,(0,h.default)().mark((function s(){var a;return(0,h.default)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,this.requestBuilder.build(e,t,i);case 3:return a=s.sent,s.abrupt("return",this.fileUploader.upload(a,n));case 7:return s.prev=7,s.t0=s["catch"](0),s.abrupt("return",Promise.reject(s.t0));case 10:case"end":return s.stop()}}),s,this,[[0,7]])})))}}]),e}(),Ui=(0,g.default)((function e(){(0,m.default)(this,e)}));!function(e){e.TEXT="text",e.IMAGE="image",e.FILE="file",e.VIDEO="video",e.AUDIO="audio"}(Ai||(Ai={}));var Li=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){var e;return(0,m.default)(this,n),e=t.apply(this,arguments),e.goEasyUploader=new Di,e}return(0,g.default)(n,[{key:"improve",value:function(e){var t=this,n=e.message;return new Promise((function(e,i){var s,a,r=n.buildOptions.createOptions;n.type===Ai.VIDEO?(a=n.payload,s=a.video.name):(a=n.payload,s=a.name),t.goEasyUploader.upload(r.file,s,r.onProgress,n.type===Ai.FILE).then((function(i){t.setPayload(i,n),e()})).catch((function(e){i(e)}))}))}},{key:"setPayload",value:function(e,t){t.payload.url=e.url}}]),n}(Ui),Fi=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"setPayload",value:function(e,t){var n,i=t.payload;switch(i.video.url=e.url,i.video.name=e.name,i.thumbnail.height>200&&(i.thumbnail.height=200,i.thumbnail.width=200*i.video.width/i.video.height),e.storageLocation){case gi.aliYun:n="?x-oss-process=video/snapshot,t_0000,f_jpg,h_"+i.thumbnail.height+",m_fast,ar_auto";break;case gi.tencent:n="?ci-process=snapshot&time=1&format=jpg&height="+i.thumbnail.height;break;default:throw new Error("Only Ali OSS and Tencent COS are supported, unknown storage location:"+e.storageLocation)}i.thumbnail.url=e.url+n}}]),n}(Li),Gi=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"setPayload",value:function(e,t){var n,i=t.payload;i.url=e.url;var s=i.height>200?200:i.height;switch(e.storageLocation){case gi.aliYun:n="?x-oss-process=image/resize,m_lfit,h_"+s;break;case gi.tencent:n="?imageMogr2/thumbnail/x".concat(s);break;default:throw new Error("Only Ali OSS and Tencent COS are supported, unknown storage location:"+e.storageLocation)}i.thumbnail=e.url+n}}]),n}(Li),Bi=function(){function e(){var t;(0,m.default)(this,e),this.improvers=(t={},(0,v.default)(t,Ai.FILE,new Li),(0,v.default)(t,Ai.AUDIO,new Li),(0,v.default)(t,Ai.IMAGE,new Gi),(0,v.default)(t,Ai.VIDEO,new Fi),t)}return(0,g.default)(e,[{key:"improve",value:function(e){var t=this.improvers[e.message.type];if(t)try{return t.improve(e)}catch(e){return Promise.reject(e)}return Promise.resolve()}}]),e}(),qi=function(){function e(t,n,i,s,a){(0,m.default)(this,e),this.validate(t),this.mt=t.type,this.to=n.id.toString(),this.d=JSON.stringify(n.data),this.p=JSON.stringify(t.payload),i&&(this.nt=i),a&&(this.at=a),s&&(this.wxmpTemplateMsg=me(s),this.wxmpTemplateMsg.data=JSON.stringify(this.wxmpTemplateMsg.data));var r=n.type;if(this.t=r,r===N.CS){var o=t;this.tid=o.teamId}this.guid=t.messageId}return(0,g.default)(e,[{key:"validate",value:function(e){if(e.type===Ai.TEXT&&JSON.stringify(e.payload).length>3072)throw Error("message-length limit 3kb")}}]),e}();!function(e){e.MESSAGE_SENDING="IM_INTERNAL_MESSAGE_SENDING",e.MESSAGE_SEND_SUCCESS="IM_INTERNAL_MESSAGE_SEND_SUCCESS",e.MESSAGE_SEND_FAILED="IM_INTERNAL_MESSAGE_SEND_FAILED",e.MESSAGE_RECEIVED="IM_INTERNAL_MESSAGE_RECEIVED",e.MESSAGE_RECALLED="IM_INTERNAL_MESSAGE_RECALLED",e.MAX_MESSAGE_CHANGED="IM_INTERNAL_MAX_MESSAGE_CHANGED",e.MAX_MESSAGE_DELETED="IM_INTERNAL_MAX_MESSAGE_DELETED",e.UNREAD_AMOUNT_CHANGED="IM_INTERNAL_UNREAD_MESSAGE_CHANGED",e.CS_ONLINE_SUCCESS="CS_ONLINE_SUCCESS",e.CS_OFFLINE_SUCCESS="CS_OFFLINE_SUCCESS",e.CS_ACCEPTED="CS_ACCEPTED",e.CS_ENDED="CS_ENDED",e.CS_TRANSFER="CS_TRANSFER",e.CS_AGENT_MESSAGE_RECEIVED="CS_AGENT_MESSAGE_RECEIVED"}(Ti||(Ti={}));var ji=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"clearUseLessAttribute",value:function(){delete this.buildOptions}},{key:"isOtherSent",value:function(){return this.senderId!==D.u()}},{key:"getToData",value:function(){return this.buildOptions.createOptions.to.data}}]),e}(),Hi=function(){function e(){(0,m.default)(this,e),this.payloadImprover=new Bi}return(0,g.default)(e,[{key:"send",value:function(e){var t=this;this.validate(e);var n=e.message,i=e.accessToken,s=n.buildOptions,a=s.createOptions,r=a.notification,o=a.wxmpTemplateMsg,u=a.to;u.data||(u.data={}),n.status=O.SENDING;var c=s.complete,l=this.payloadImprover.improve(e);Promise.all([c,l]).then((function(){return Se(t,void 0,void 0,(0,h.default)().mark((function t(){var s;return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a.beforeSend){t.next=4;break}return s=JSON.parse(JSON.stringify(n)),t.next=4,a.beforeSend(s);case 4:this.doSend(n,u,r,o,i,e);case 5:case"end":return t.stop()}}),t,this)})))})).catch((function(t){n.status=O.FAIL,de.onFailed(e,{code:t&&t.code||400,content:t&&t.content||t})}))}},{key:"doSend",value:function(e,t,n,i,s,a){var r=new qi(e,t,n,i,s);I.fire(Ti.MESSAGE_SENDING,e);var o=new fe({name:oe.publishIM,params:r,unique:!0,permission:re.WRITE,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,fail:function(t){e.status=O.FAIL,I.fire(Ti.MESSAGE_SEND_FAILED,e),de.onFailed(a,{code:t.resultCode,content:t.content})},success:function(t){if(e.status=O.SUCCESS,e.timestamp=t.content.timestamp,e.scene()===N.CS){var n=e;n.customerId()!==D.u()&&(n.sessionId=t.content.sessionId)}e.clearUseLessAttribute(),I.fire(Ti.MESSAGE_SEND_SUCCESS,e),de.onSuccess(a,e)}});D.e(o)}},{key:"validate",value:function(e){var t=e.message;if(!(t instanceof ji))throw new Error("it is invalid message");if(t.status!==O.NEW)throw new Error("Please create a new message, a message can only be sent once")}}]),e}(),Vi=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"insert",value:function(e,t){var n=this.binarySearch(e,t);if(n>=0)e.splice(n,1,t);else{var i=-n-1;e.splice(i,0,t)}}},{key:"binarySearch",value:function(e,t){for(var n=0,i=e.length-1;n<=i;){var s=i+n>>1,a=this.compare(t,e[s]);if(a>0)n=s+1;else{if(!(a<0))return s;i=s-1}}return-n-1}}]),e}(),zi=function(){function e(t){(0,m.default)(this,e),this.messages=new Array,this.allLoaded=!1,this.target=t}return(0,g.default)(e,[{key:"all",value:function(){return this.messages}},{key:"sliceOverLengthMessages",value:function(){this.messages.length>e.CACHE_MAX_LENGTH&&(this.messages=this.messages.slice(-e.CACHE_MAX_LENGTH),!0===this.allLoaded&&(this.allLoaded=!1))}},{key:"getMaxMessage",value:function(){return this.messages[this.messages.length-1]}},{key:"loadLocalMessages",value:function(e,t){var n=[],i=this.messages.length;if(t){if(i>0){var s=this.messages[0].timestamp,a=this.messages[i-1].timestamp;if(t>=s&&t<=a)for(var r=i-1;r>=0;r--){var o=this.messages[r];if(o.timestamp<t){if(!(n.length<e))break;n.unshift(o)}}}}else n=this.messages.slice(-e);return n}},{key:"cacheServerMessages",value:function(t,n){var i=this,s=this.messages[0];this.messages.length<e.CACHE_MAX_LENGTH&&(!t.lastTimestamp||this.messages.length>0&&s.timestamp===t.lastTimestamp)&&(n.forEach((function(t){e.sortedInserter.insert(i.messages,t)})),n.length<t.limit&&(this.allLoaded=!0))}},{key:"findMessageByTime",value:function(e){return this.messages.find((function(t){return e===t.timestamp}))}},{key:"findMessagesByTimes",value:function(e){var t=this,n=[];return e.forEach((function(e){var i=t.findMessageByTime(e);G.isDef(i)&&n.push(i)})),n}},{key:"existsMessage",value:function(e){return this.findMessageIndexById(e)>-1}},{key:"findMessageIndexById",value:function(e){return this.messages.findIndex((function(t){return e===t.messageId}))}},{key:"deleteMessage",value:function(e){var t=this.findMessageIndexById(e);t>=0&&this.messages.splice(t,1)}},{key:"recallMessage",value:function(e){var t=this;return e.times.map((function(e){return t.findMessageByTime(e)})).filter((function(e){return G.isDef(e)})).map((function(t){return t.recalled=!0,t.recaller=e.recaller,t}))}},{key:"isEmpty",value:function(){return 0===this.messages.length}},{key:"deleteMessages",value:function(e){var t=this;e.forEach((function(e){t.deleteMessage(e.messageId)}))}},{key:"saveMessage",value:function(t){e.sortedInserter.insert(this.messages,t),this.sliceOverLengthMessages()}},{key:"maxSuccessMessageTime",value:function(){for(var e=this.messages.length-1;e>=0;e--)if(this.messages[e].status===O.SUCCESS)return this.messages[e].timestamp;return 0}},{key:"minTime",value:function(){return this.isEmpty()?0:this.messages[0].timestamp}},{key:"correctPosition",value:function(e){this.deleteMessage(e.messageId),this.saveMessage(e)}}]),e}();zi.CACHE_MAX_LENGTH=200,zi.sortedInserter=new(function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"compare",value:function(e,t){var n=e.timestamp-t.timestamp;return n>0?1:0===n?0:-1}}]),n}(Vi));var Wi=function(){function e(t,n,i){(0,m.default)(this,e),this.scene=t,this.id=n,G.isDef(i)&&(this.teamId=i)}return(0,g.default)(e,[{key:"toString",value:function(){return N.PRIVATE===this.scene||N.GROUP===this.scene?this.scene+"#"+this.id:this.scene+"#"+this.id+"#"+this.teamId}},{key:"customerId",value:function(){if(N.CS===this.scene)return this.id===this.teamId?D.u():this.id}}],[{key:"byScene",value:function(t,n,i){return new e(t,n,i)}},{key:"byIMMessage",value:function(t){var n,i,s=t.scene();if(s===N.PRIVATE){var a=t.senderId,r=t.targetId();i=D.u()===a?r:a}else if(s===N.GROUP)i=t.targetId();else{if(s!==N.CS)throw{code:400,content:"scene ".concat(s," not exists")};i=t.targetId(),n=t.teamId}return new e(s,i,n)}},{key:"byMessageReadRemoteEvent",value:function(t){var n,i=t.scene,s=t.targetId,a=t.markerId,r=t.teamId;return i===N.PRIVATE?n=D.u()===a?s:a:i===N.GROUP?n=s:i===N.CS&&(n=s===r?a===D.u()?r:a:a===D.u()?s:r),new e(i,n,r)}},{key:"byIMMessageDeletedEvent",value:function(t){var n=t.scene,i=t.deleterId;if(n===N.PRIVATE){var s=D.u()===i?t.targetId:i;return new e(n,s)}if(n===N.GROUP)return new e(n,t.targetId)}},{key:"byConversationDTO",value:function(e){var t=e.lastMessage;return this.byIMMessage(t)}},{key:"byConversationId",value:function(t,n){var i;if(t===N.PRIVATE){var s=n.split(":",2);i=s[0]===D.u()?s[1]:s[0]}else i=n;return new e(t,i)}}]),e}(),Xi=(0,g.default)((function e(t){var n=this;(0,m.default)(this,e),this.times=new Array;var i=t[0],s=Wi.byIMMessage(i);this.scene=s.scene,this.targetId=s.id,t.forEach((function(e){e.status===O.SUCCESS&&n.times.push(e.timestamp)})),this.times.sort((function(e,t){return e<t?-1:e==t?0:1}))})),Ji=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,null,[{key:"deleteServerMessages",value:function(e){var t=new Xi(e);return t.times.length<0?Promise.resolve():new Promise((function(e,n){var i=new fe({name:oe.IM_DELETE_MESSAGE,params:t,permission:re.WRITE,singleTimeout:ue.commonQuerySingle,totalTimeout:ue.commonQueryTotal,success:function(t){200===t.code?e(t):n(t)},fail:function(e){n(e)}});D.e(i)}))}},{key:"validate",value:function(e){for(var t=e.messages,n=0;n<t.length;n++){var i=t[n];if(i.status===O.SENDING)throw{code:400,content:"message["+n+"] is '"+i.status+"' and cannot be deleted"}}}}]),e}(),Ki=(0,g.default)((function e(t,n,i,s,a){(0,m.default)(this,e),this.scene=t,this.id=n,this.after=i,this.min=s,this.teamId=a})),Yi=(0,g.default)((function e(t,n,i,s){(0,m.default)(this,e),this.id=t,this.scene=n,this.lastTimestamp=i,this.teamId=s})),Qi=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){var e;return(0,m.default)(this,n),e=t.apply(this,arguments),e.read=!1,e}return(0,g.default)(n,[{key:"scene",value:function(){return N.PRIVATE}},{key:"targetId",value:function(){return this.receiverId}}]),n}(ji),$i=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"scene",value:function(){return N.GROUP}},{key:"targetId",value:function(){return this.groupId}}]),n}(ji),Zi=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){var e;return(0,m.default)(this,n),e=t.apply(this,arguments),e.accepted=!1,e}return(0,g.default)(n,[{key:"scene",value:function(){return N.CS}},{key:"targetId",value:function(){return D.u()===this.customerId()?this.teamId:this.customerId()}},{key:"sendByCustomer",value:function(){return this.to===this.teamId}},{key:"customerId",value:function(){return this.sendByCustomer()?this.senderId:this.to}},{key:"isOtherSent",value:function(){return D.u()===this.customerId()?this.senderId!==D.u():this.senderId===this.customerId()}}]),n}(ji);!function(e){e.ACCEPT="CS_ACCEPT",e.END="CS_END",e.TRANSFER="CS_TRANSFER"}(_i||(_i={}));var es=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"build",value:function(e){var t,n=e.t;n===N.PRIVATE?(t=new Qi,t.read=!1,t.receiverId=e.r):n===N.GROUP?(t=new $i,t.groupId=e.r,t.senderData=e.d?JSON.parse(e.d):{}):n===N.CS&&(t=new Zi,t.to=e.r,t.teamId=e.tid,t.senderData=e.d?JSON.parse(e.d):{},t.accepted=e.accepted,t.customerId()!==D.u()&&(t.sessionId=e.sessionId)),t.senderId=e.s,t.messageId=e.i,t.timestamp=e.ts,t.type=e.mt;var i=e.p;if(G.isDef(i))if(n===N.CS&&t.type===_i.TRANSFER){var s=JSON.parse(i);s.transferTo.data=JSON.parse(s.transferTo.data),t.payload=s}else t.payload=JSON.parse(i);var a=e.rc;return G.isDef(a)&&!0===a?(t.recalled=a,t.recaller=e.recaller):t.recalled=!1,t.status=O.SUCCESS,t}}]),e}(),ts=function(){function e(){(0,m.default)(this,e),this.builder=new es}return(0,g.default)(e,[{key:"sync",value:function(e,t,n,i,s){var a=new Ki(e,t,n,i,s);return new Promise((function(e,t){var n=new fe({name:oe.IM_HISTORY_CHANGE,params:a,permission:re.READ,singleTimeout:ue.commonQuerySingle,totalTimeout:ue.commonQueryTotal,fail:function(e){t(e)},success:function(t){var n=t.content;e(n)}});D.e(n)}))}},{key:"loadServerMessages",value:function(e,t){var n=this;return new Promise((function(i,s){var a=new fe({name:oe.IM_HISTORY,params:t,permission:re.READ,singleTimeout:ue.commonQuerySingle,totalTimeout:ue.commonQueryTotal,fail:function(e){s(e)},success:function(t){var s=t.content;s.messages=n.convertServerMessages(e,s.messages),i(s)}});D.e(a)}))}},{key:"convertServerMessages",value:function(e,t){var n=this,i=[],s=e.scene,a=e.id;return t.forEach((function(t){if(t.t=s,N.PRIVATE===s)t.r=t.s===D.u()?a:D.u();else if(N.GROUP===s)t.r=a;else if(N.CS===s){var r=e.customerId(),o=e.teamId;r===D.u()?t.r=o:t.r=r}var u=n.builder.build(t);i.push(u)})),i}},{key:"updateServerOffsets",value:function(e,t){return Se(this,void 0,void 0,(0,h.default)().mark((function n(){var i;return(0,h.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=new Yi(t.id,t.scene,e,t.teamId),n.abrupt("return",new Promise((function(e,t){var n=new fe({name:oe.IM_MARK_AS_READ,params:i,permission:re.WRITE,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,success:function(t){e(t)},fail:function(e){t(e)}});D.e(n)})));case 2:case"end":return n.stop()}}),n)})))}}]),e}();ts.instance=new ts;var ns=function(){function e(){(0,m.default)(this,e),this.offsetMap=new Map,this.markingTime=0,this.userId=D.u()}return(0,g.default)(e,[{key:"updateOffset",value:function(e,t){var n=this.offsetMap.get(e);return G.isDef(n)?t>n&&(this.offsetMap.set(e,t),!0):(this.offsetMap.set(e,t),!0)}},{key:"updateUserOffsets",value:function(e){var t=this;e.forEach((function(e){var n=e.userId,i=e.offset;t.updateOffset(n,i)}))}},{key:"updateMyOffset",value:function(e){return this.updateOffset(this.userId,e)}},{key:"myOffset",value:function(){return this.getOffset(this.userId)}},{key:"getOffset",value:function(e){var t=this.offsetMap.get(e);return t||0}}]),e}(),is=(0,g.default)((function e(t,n,i,s,a){(0,m.default)(this,e),this.id=t,this.scene=n,this.lastTimestamp=i,this.limit=s,this.teamId=a})),ss=function(){function e(t){(0,m.default)(this,e),this.history=t}return(0,g.default)(e,[{key:"pre",value:function(){this.oldLastMessage=this.history.getMaxMessage(),this.oldUnreadAmount=this.history.unreadAmount(),this.oldLastMessage&&(this.oldLastMessageRecalled=this.oldLastMessage.recalled,this.oldLastMessageRead=this.oldLastMessage.read,this.oldLastMessageStatus=this.oldLastMessage.status)}},{key:"post",value:function(){var e,t,n,i=this.history.unreadAmount(),s=this.history.getMaxMessage();s&&(n=s.status,e=s.read,t=s.recalled);var a=this.history.target;this.oldLastMessage!==s||this.oldLastMessageRead!==e||this.oldLastMessageRecalled!==t||this.oldLastMessageStatus!==n?s?I.fire(Ti.MAX_MESSAGE_CHANGED,s):I.fire(Ti.MAX_MESSAGE_DELETED,a):this.oldUnreadAmount!==i&&I.fire(Ti.UNREAD_AMOUNT_CHANGED,a)}}]),e}(),as=(0,g.default)((function e(t,n,i,s){(0,m.default)(this,e),this.scene=t,this.conversationId=n,this.recaller=i,this.times=s})),rs=function(){function e(t){(0,m.default)(this,e),this.expiredTime=0,this.remoteHistory=ts.instance,this.target=t,this.userOffsets=new ns,this.messageCache=new zi(t)}return(0,g.default)(e,[{key:"initMaxMessageAndOffsets",value:function(e,t){var n=this;this.existsMessage(e)||(this.messageCache.saveMessage(e),t.forEach((function(e){n.markLocalMessagesRead(n.messageCache.all(),e.userId,e.offset,!1)})))}},{key:"existsMessage",value:function(e){return this.messageCache.existsMessage(e.messageId)}},{key:"loadHistory",value:function(e,t){return Se(this,void 0,void 0,(0,h.default)().mark((function n(){return(0,h.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.t0=this.expiredTime>0&&!this.messageCache.isEmpty(),!n.t0){n.next=4;break}return n.next=4,this.updateByServerChange();case 4:return G.isUndef(t)?t=10:t>30&&(t=30),n.next=7,this.loadServerMessages(e,t);case 7:return n.abrupt("return",n.sent);case 8:case"end":return n.stop()}}),n,this)})))}},{key:"loadServerMessages",value:function(e,t){return Se(this,void 0,void 0,(0,h.default)().mark((function n(){var i,s,a,r,o,u,c=this;return(0,h.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=this.messageCache.loadLocalMessages(t,e),!1!==this.messageCache.allLoaded||i.length===t){n.next=10;break}return s=t-i.length,a=i[0]?i[0].timestamp:e,r=new is(this.target.id.toString(),this.target.scene,a,s,this.target.teamId),n.next=7,this.remoteHistory.loadServerMessages(this.target,r);case 7:o=n.sent,u=o.messages,i=u.concat(i),this.messageCache.cacheServerMessages(r,u),o.userOffsets.forEach((function(e){c.userOffsets.updateOffset(e.userId,e.offset)})),this.userOffsets.offsetMap.forEach((function(e,t){c.markLocalMessagesRead(u,t,e,!1)}));case 10:return n.abrupt("return",i);case 11:case"end":return n.stop()}}),n,this)})))}},{key:"deleteMessages",value:function(e){return Se(this,void 0,void 0,(0,h.default)().mark((function t(){var n=this;return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.aopUnreadAmountMaxMessage((function(){return Se(n,void 0,void 0,(0,h.default)().mark((function t(){var n;return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.messages,t.next=3,Ji.deleteServerMessages(n);case 3:this.messageCache.deleteMessages(n),de.onSuccess(e);case 5:case"end":return t.stop()}}),t,this)})))}));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"syncDeletedMessage",value:function(e,t){var n=this;this.aopUnreadAmountMaxMessage((function(){n.doSyncDeletedMessage(e,t)}))}},{key:"doSyncDeletedMessage",value:function(e,t){if(e===D.u()){var n=this.messageCache.findMessagesByTimes(t);this.messageCache.deleteMessages(n),n.length>0&&fa.aec.fire(ri.MESSAGE_DELETED,n)}}},{key:"recallMessages",value:function(e){return Se(this,void 0,void 0,(0,h.default)().mark((function t(){var n=this;return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.aopUnreadAmountMaxMessage((function(){return Se(n,void 0,void 0,(0,h.default)().mark((function t(){return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.doRecall(e);case 1:case"end":return t.stop()}}),t,this)})))}));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"doRecall",value:function(e){var t=this.messageCache.recallMessage(e);t.length>0&&fa.aec.fire(ri.MESSAGE_RECALLED,t)}},{key:"expire",value:function(){this.messageCache.isEmpty()||(this.expiredTime=this.messageCache.maxSuccessMessageTime())}},{key:"updateByServerChange",value:function(){return Se(this,void 0,void 0,(0,h.default)().mark((function e(){var t=this;return(0,h.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.aopUnreadAmountMaxMessage((function(){return Se(t,void 0,void 0,(0,h.default)().mark((function e(){var t,n,i,s=this;return(0,h.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.remoteHistory.sync(this.target.scene,this.target.id,this.expiredTime,this.messageCache.minTime(),this.target.teamId);case 2:t=e.sent,t.userOffsets.forEach((function(e){s.markLocalMessagesRead(s.messageCache.all(),e.userId,e.offset,!0)})),n=t.deletedMessageTimes,n.length>0&&this.doSyncDeletedMessage(D.u(),n),i=t.recalledMessages,i.length>0&&i.forEach((function(e){var t=new as(s.target.scene,s.target.id,e.recaller,e.times);s.doRecall(t)})),this.expiredTime=0;case 8:case"end":return e.stop()}}),e,this)})))}));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"markRead",value:function(){return Se(this,void 0,void 0,(0,h.default)().mark((function e(){var t=this;return(0,h.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.aopUnreadAmountMaxMessage((function(){return Se(t,void 0,void 0,(0,h.default)().mark((function e(){var t;return(0,h.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.messageCache.maxSuccessMessageTime(),e.t0=t>this.userOffsets.myOffset(),!e.t0){e.next=7;break}return this.userOffsets.markingTime=t,e.next=6,this.remoteHistory.updateServerOffsets(t,this.target);case 6:t===this.userOffsets.markingTime&&this.markLocalMessagesRead(this.messageCache.all(),D.u(),t,!0);case 7:case"end":return e.stop()}}),e,this)})))}));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"syncMarkedMessage",value:function(e){var t=this;this.aopUnreadAmountMaxMessage((function(){t.markLocalMessagesRead(t.messageCache.all(),e.markerId,e.time,!0)}))}},{key:"onMessageSending",value:function(e){var t=this;this.aopUnreadAmountMaxMessage((function(){t.messageCache.saveMessage(e)}))}},{key:"onMessageSendSuccess",value:function(e){var t=this;this.aopUnreadAmountMaxMessage((function(){t.messageCache.correctPosition(e),t.markLocalMessagesRead(t.messageCache.all(),D.u(),e.timestamp,!0)}))}},{key:"onMessageSendFailed",value:function(e){this.getMaxMessage()===e&&I.fire(Ti.MAX_MESSAGE_CHANGED,e)}},{key:"onMessageReceived",value:function(e){var t=this;this.aopUnreadAmountMaxMessage((function(){t.messageCache.saveMessage(e),t.markLocalMessagesRead(t.messageCache.all(),e.senderId,e.timestamp,!0)}))}},{key:"aopUnreadAmountMaxMessage",value:function(e,t){return Se(this,void 0,void 0,(0,h.default)().mark((function n(){var i;return(0,h.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,i=new ss(this),i.pre(),n.next=5,e();case 5:i.post(),n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](0),de.onFailed(t,n.t0);case 11:case"end":return n.stop()}}),n,this,[[0,8]])})))}},{key:"markLocalMessagesRead",value:function(e,t,n,i){if(this.userOffsets.updateOffset(t,n),this.isOtherUserId(t)){var s=this.markMySentRead(e,n);i&&s.length>0&&fa.aec.fire(ri.MESSAGE_READ,s)}else t===D.u()&&this.markOthersSentRead(e,n)}},{key:"markOthersSentRead",value:function(e,t){if(this.target.scene===N.PRIVATE)for(var n=e.length-1;n>=0;n--){var i=e[n];if(i.isOtherSent()&&i.timestamp<=t){if(i.read)break;i.read=!0}}}},{key:"markMySentRead",value:function(e,t){var n=new Array;if(this.target.scene===N.PRIVATE)for(var i=e.length-1;i>=0;i--){var s=e[i];if(!s.isOtherSent()&&s.timestamp<=t&&s.status===O.SUCCESS){if(s.read)break;s.read=!0,n.push(s)}}return n}},{key:"isOtherUserId",value:function(e){if(this.target.scene===N.CS){var t=this.target.customerId();return D.u()===t?e!==D.u():e===t}return e!==D.u()}},{key:"unreadAmount",value:function(e){var t,n=0,i=this.userOffsets.myOffset(),s=this.messageCache.all(),a=(0,d.default)(s);try{for(a.s();!(t=a.n()).done;){var r=t.value;r.isOtherSent()&&!1===r.recalled&&r.timestamp>i&&(n+=1)}}catch(o){a.e(o)}finally{a.f()}return n}},{key:"getMaxMessage",value:function(e){return this.messageCache.getMaxMessage()}},{key:"maxTime",value:function(e){var t=this.getMaxMessage();return G.isDef(t)?t.timestamp:0}}]),e}(),os=(0,g.default)((function e(t,n){(0,m.default)(this,e),this.teamId=t,this.customerId=n})),us=(0,g.default)((function e(){(0,m.default)(this,e)})),cs=(0,g.default)((function e(t,n,i){(0,m.default)(this,e),this.teamId=t,this.teamData=JSON.stringify(n),this.agentData=JSON.stringify(i)})),ls=(0,g.default)((function e(t){(0,m.default)(this,e),this.teamId=t})),fs=(0,g.default)((function e(t){(0,m.default)(this,e),this.teamId=t})),ds=function(){function e(){(0,m.default)(this,e),this.synchronized=!0,D.s().addDisconnectedObserver(this.onDisconnected.bind(this)),D.s().addConnectedObserver(this.onConnected.bind(this)),D.s().addMessageObserver(ge.CS_ONLINE_CHANGED,this.onlineChanged.bind(this))}return(0,g.default)(e,[{key:"queryTeams",value:function(){var e=this;return this.queryMyTeamPromise||(this.queryMyTeamPromise=new Promise((function(t,n){var i=new fe({name:oe.CS_MY_TEAMS,params:{},permission:re.READ,singleTimeout:ue.commonQuerySingle,totalTimeout:ue.commonQueryTotal,fail:function(e){n(e)},success:function(n){e.teamIds=new Set(n.content),e.synchronized=!0,t(e.teamIds)}});D.e(i)}))),this.queryMyTeamPromise}},{key:"myTeams",value:function(){if(this.synchronized&&this.queryMyTeamPromise)return this.teamIds;throw"please query team first."}},{key:"isOnline",value:function(e,t){return Se(this,void 0,void 0,(0,h.default)().mark((function n(){return(0,h.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,this.queryTeams();case 2:de.onSuccess(t,this.teamIds.has(e));case 3:case"end":return n.stop()}}),n,this)})))}},{key:"online",value:function(e,t){var n=this;if(!G.isObject(t.agentData)||!G.isObject(t.teamData))throw{code:400,content:"agentData and teamData require an object"};var i=new cs(e,t.teamData,t.agentData),s=new fe({name:oe.CS_ONLINE,params:i,permission:re.WRITE,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,fail:function(e){de.onFailed(t,e)},success:function(i){n.teamIds.add(e),de.onSuccess(t),I.fire(Ti.CS_ONLINE_SUCCESS)}});D.e(s)}},{key:"offline",value:function(e,t){var n=this,i=new ls(e),s=new fe({name:oe.CS_OFFLINE,params:i,permission:re.WRITE,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,fail:function(e){de.onFailed(t,e)},success:function(i){n.teamIds.delete(e),de.onSuccess(t),I.fire(Ti.CS_OFFLINE_SUCCESS)}});D.e(s)}},{key:"agents",value:function(e,t){var n=new fs(e),i=new fe({name:oe.CS_AGENTS,params:n,permission:re.READ,singleTimeout:ue.commonQuerySingle,totalTimeout:ue.commonQueryTotal,fail:function(e){de.onFailed(t,e)},success:function(e){e.content.forEach((function(e){e.data=JSON.parse(e.data)})),de.onSuccess(t,e)}});D.e(i)}},{key:"onlineChanged",value:function(e){e.online?this.teamIds.add(e.teamId):this.teamIds.delete(e.teamId)}},{key:"onDisconnected",value:function(){this.queryMyTeamPromise=null,this.teamIds=null}},{key:"onConnected",value:function(){this.synchronized&&(this.queryMyTeamPromise=this.queryTeams())}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),hs=function(){function e(t){(0,m.default)(this,e),this.teamId=t,I.on(Ti.CS_AGENT_MESSAGE_RECEIVED,this.onMessageReceived),I.on(Ti.CS_ACCEPTED,this.onMessageReceived),I.on(Ti.CS_ENDED,this.onMessageReceived),I.on(Ti.CS_TRANSFER,this.onMessageReceived),I.on(ai.MANUAL_DISCONNECTED,e.destroy)}return(0,g.default)(e,[{key:"customerId",value:function(){return this.liveOptions.customerId}},{key:"onMessageReceived",value:function(t){var n=e.session;if(t.scene()===N.CS&&n.liveOptions){var i=t,s=n.liveOptions.customerId;n.teamId===i.teamId&&i.customerId()===s&&(n.tryUpdateStatus(i),n.liveOptions.onNewMessage(i))}}},{key:"tryUpdateStatus",value:function(e){if(!("FREE"!==this.status.status&&this.status.sessionId>e.sessionId)){var t;switch(e.type){case _i.ACCEPT:t=new us,t.status="ACCEPTED",t.start=e.payload.sessionStart,t.sessionId=e.sessionId,t.agent=new F(e.senderId,e.senderData);break;case _i.END:t=new us,t.status="FREE";break;case _i.TRANSFER:t=new us,t.status="ACCEPTED",t.start=e.payload.sessionStart,t.sessionId=e.sessionId,t.agent=e.payload.transferTo;break;default:"FREE"===this.status.status&&(t=new us,t.status="PENDING",t.start=e.timestamp,t.sessionId=e.sessionId)}t&&(this.status=t,this.liveOptions.onStatusUpdated(t))}}}],[{key:"live",value:function(t,n){return Se(this,void 0,void 0,(0,h.default)().mark((function i(){var s,a,r,o=this;return(0,h.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return s=n.customerId,ve.validateId(s,"customerId"),a=new os(t,s),i.next=5,ds.getInstance().queryTeams();case 5:r=new fe({name:oe.CS_LIVE_SESSION,params:a,permission:re.WRITE,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,fail:function(e){de.onFailed(n,e)},success:function(i){e.destroy(),o.session=new e(t),o.session.liveOptions=n;var s=i.content.customerStatus;"ACCEPTED"===s.status&&(s.agent.data=JSON.parse(s.agent.data)),o.session.status=s,o.session.liveOptions.onStatusUpdated(o.session.status),de.onSuccess(n)}}),D.e(r);case 7:case"end":return i.stop()}}),i)})))}},{key:"isMyCustomer",value:function(t){var n=e.session;if(n&&n.teamId===t.teamId&&n.customerId()===t.customerId()){var i=ds.getInstance().myTeams(),s=n.status.agent;return i.has(t.teamId)&&(!s||s.id===D.u())}return!0}},{key:"isMyMessage",value:function(e){var t=Wi.byIMMessage(e);return e.type===_i.TRANSFER&&e.payload.transferTo.id===D.u()||this.isMyCustomer(t)}},{key:"quit",value:function(t){var n=e.session;if(n){var i=n.liveOptions.customerId;ve.validateId(i,"customerId");var s=new os(n.teamId,i),a=new fe({name:oe.CS_QUIT_LIVE,params:s,permission:re.WRITE,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,fail:function(e){de.onFailed(t,e)},success:function(n){e.destroy(),de.onSuccess(t)}});D.e(a)}}},{key:"destroy",value:function(){var t=e.session;t&&(I.off(Ti.CS_AGENT_MESSAGE_RECEIVED,t.onMessageReceived),I.off(Ti.CS_ACCEPTED,t.onMessageReceived),I.off(Ti.CS_ENDED,t.onMessageReceived),I.off(Ti.CS_TRANSFER,t.onMessageReceived),I.off(ai.MANUAL_DISCONNECTED,e.destroy),e.session=null)}}]),e}(),ps=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(e){var i;return(0,m.default)(this,n),i=t.call(this,e),i.unread=0,i.markingAmount=0,i}return(0,g.default)(n,[{key:"loadHistory",value:function(e,t){return Se(this,void 0,void 0,(0,h.default)().mark((function n(){return(0,h.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return G.isUndef(t)?t=10:t>30&&(t=30),n.next=3,this.loadServerMessages(e,t);case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n,this)})))}},{key:"loadServerMessages",value:function(e,t){return Se(this,void 0,void 0,(0,h.default)().mark((function n(){var i,s,a=this;return(0,h.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=new is(this.target.id.toString(),this.target.scene,e,t,this.target.teamId),n.next=3,this.remoteHistory.loadServerMessages(this.target,i);case 3:return s=n.sent,n.abrupt("return",(s.userOffsets.forEach((function(e){a.userOffsets.updateOffset(e.userId,e.offset)})),s.messages));case 5:case"end":return n.stop()}}),n,this)})))}},{key:"deleteMessages",value:function(e){return Se(this,void 0,void 0,(0,h.default)().mark((function t(){return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:de.onFailed(e,"Delete CS message is not supported yet");case 1:case"end":return t.stop()}}),t)})))}},{key:"initMaxMessageAndOffsets",value:function(e,t){var n=this;t.forEach((function(e){n.userOffsets.updateOffset(e.userId,e.offset)})),(G.isUndef(this.acceptedMaxMessage)||this.acceptedMaxMessage.timestamp<e.timestamp)&&this.increaseUnreadAmount(e),this.saveAcceptedMessage(e)}},{key:"initPendingMaxMessageAndOffsets",value:function(e,t){var n=this;t.forEach((function(e){n.userOffsets.updateOffset(e.userId,e.offset)})),this.savePendingMessage(e)}},{key:"savePendingMessage",value:function(e){this.pendingMaxMessage?this.pendingMaxMessage.timestamp<e.timestamp&&(this.pendingMaxMessage=e):this.pendingMaxMessage=e}},{key:"saveAcceptedMessage",value:function(e){this.acceptedMaxMessage?this.acceptedMaxMessage.timestamp<e.timestamp&&(this.acceptedMaxMessage=e):this.acceptedMaxMessage=e}},{key:"onMessageSending",value:function(e){this.saveAcceptedMessage(e),I.fire(Ti.MAX_MESSAGE_CHANGED,e)}},{key:"onMessageSendSuccess",value:function(e){this.saveAcceptedMessage(e),this.userOffsets.updateOffset(e.senderId,e.timestamp),this.acceptedMaxMessage===e&&I.fire(Ti.MAX_MESSAGE_CHANGED,e)}},{key:"onMessageSendFailed",value:function(e){this.acceptedMaxMessage===e&&I.fire(Ti.MAX_MESSAGE_CHANGED,e)}},{key:"onMessageReceived",value:function(e){hs.isMyMessage(e)&&(!e.accepted||e.senderId!==D.u()&&e.type===_i.ACCEPT?this.savePendingMessage(e):this.saveAcceptedMessage(e),this.userOffsets.updateOffset(e.senderId,e.timestamp),this.increaseUnreadAmount(e),I.fire(Ti.MAX_MESSAGE_CHANGED,e))}},{key:"increaseUnreadAmount",value:function(e){(e.sendByCustomer()||e.type===_i.TRANSFER&&e.senderId!==D.u())&&this.userOffsets.myOffset()<e.timestamp&&e.accepted&&(this.unread+=1)}},{key:"markRead",value:function(){return Se(this,void 0,void 0,(0,h.default)().mark((function e(){var t;return(0,h.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.maxAcceptedMessageTime(),e.t0=hs.isMyCustomer(this.target)&&this.preMark(t),!e.t0){e.next=6;break}return e.next=5,this.remoteHistory.updateServerOffsets(t,this.target);case 5:this.postMark(t);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"preMark",value:function(e){var t=this.userOffsets.myOffset();return e>this.userOffsets.markingTime&&e>t&&(this.userOffsets.markingTime=e,this.markingAmount=this.unread,!0)}},{key:"postMark",value:function(e){e===this.userOffsets.markingTime&&(this.unread-=this.markingAmount,this.markingAmount=0,this.userOffsets.updateOffset(D.u(),e),I.fire(Ti.UNREAD_AMOUNT_CHANGED,this.target))}},{key:"syncMarkedMessage",value:function(e){}},{key:"getMaxMessage",value:function(e){return e?this.acceptedMaxMessage:this.pendingMaxMessage}},{key:"unreadAmount",value:function(e){return e?this.unread:0}},{key:"existsMessage",value:function(e){return this.acceptedMaxMessage&&this.acceptedMaxMessage.messageId===e.messageId||this.pendingMaxMessage&&this.pendingMaxMessage.messageId===e.messageId}},{key:"maxAcceptedMessageTime",value:function(){return this.acceptedMaxMessage?this.acceptedMaxMessage.timestamp:0}},{key:"maxTime",value:function(e){var t=this.getMaxMessage(e);return t?t.timestamp:0}}]),n}(rs),vs=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(e){return(0,m.default)(this,n),t.call(this,e)}return(0,g.default)(n,[{key:"deleteMessages",value:function(e){return Se(this,void 0,void 0,(0,h.default)().mark((function t(){return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:de.onFailed(e,"Delete CS message is not supported yet");case 1:case"end":return t.stop()}}),t)})))}}]),n}(rs),ms=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,null,[{key:"validateMessageArray",value:function(e){if(!G.isArray(e)||G.isEmpty(e))throw{code:400,content:"messages requires non empty array"};if(e.length>20)throw{code:400,content:"The maximum number of messages is 20"};for(var t=Wi.byIMMessage(e[0]),n=0;n<e.length;n++){var i=e[n];if(!(i instanceof ji))throw{code:400,content:"message["+n+"] is not a correct message"};if(n>0){var s=Wi.byIMMessage(i);if(s.scene!==t.scene||s.id!==t.id)throw{code:400,content:"each message must be from the same friend or group"}}}}}]),e}(),gs=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"initialListeners",value:function(){var e=this;I.on(Ti.MESSAGE_SENDING,(function(t){return e.onMessageSending(t)})),I.on(Ti.MESSAGE_SEND_SUCCESS,(function(t){return e.onMessageSendSuccess(t)})),I.on(Ti.MESSAGE_SEND_FAILED,(function(t){return e.onMessageSendFailed(t)})),I.on(Ti.MESSAGE_RECEIVED,(function(t){return e.onMessageReceived(t)})),I.on(Ti.CS_AGENT_MESSAGE_RECEIVED,(function(t){return e.onMessageReceived(t)})),I.on(Ti.CS_ACCEPTED,(function(t){return e.onMessageReceived(t)})),I.on(Ti.CS_ENDED,(function(t){return e.onMessageReceived(t)})),I.on(Ti.CS_TRANSFER,(function(t){return e.onMessageReceived(t)})),I.on(Ti.MESSAGE_RECALLED,(function(t){return e.onMessageRecalled(t)})),D.s().addMessageObserver(ge.IM_MSG_READ,this.onRemoteMarkRead.bind(this)),D.s().addMessageObserver(ge.IM_MSG_DELETED,this.onRemoteMessageDeleted.bind(this)),D.s().addDisconnectedObserver(this.onDisconnected.bind(this))}},{key:"loadHistory",value:function(e,t){return Se(this,void 0,void 0,(0,h.default)().mark((function n(){var i,s,a;return(0,h.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=this.queryToTarget(e,t),s=this.findOrCreateHistory(i),n.next=4,s.loadHistory(e.lastTimestamp,e.limit);case 4:a=n.sent,de.onSuccess(e,{code:200,content:a});case 6:case"end":return n.stop()}}),n,this)})))}},{key:"queryToTarget",value:function(e,t){if(G.isDef(e.userId))return new Wi(N.PRIVATE,e.userId);if(G.isDef(e.groupId))return new Wi(N.GROUP,e.groupId);if(G.isDef(e.type)){if(!Object.values(N).includes(e.type))throw new Error("incorrect type, must be: "+Object.values(N));if(G.isUndef(e.id))throw new Error("If type is not empty, id is required.");return N.CS==e.type&&G.isUndef(t)&&(t=e.id),new Wi(e.type,e.id,t)}throw new Error("incorrect query options.")}},{key:"onMessageSending",value:function(e){var t=Wi.byIMMessage(e);this.findOrCreateHistory(t).onMessageSending(e)}},{key:"onMessageSendSuccess",value:function(e){var t=Wi.byIMMessage(e);this.findHistory(t).onMessageSendSuccess(e)}},{key:"onMessageSendFailed",value:function(e){var t=Wi.byIMMessage(e);this.findHistory(t).onMessageSendFailed(e)}},{key:"onMessageReceived",value:function(e){var t=Wi.byIMMessage(e);this.findOrCreateHistory(t).onMessageReceived(e)}},{key:"privateMarkAsRead",value:function(e){return Se(this,void 0,void 0,(0,h.default)().mark((function t(){var n;return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!G.isUndef(e.userId)){t.next=2;break}throw new Error("userId could not be empty.");case 2:return n=Wi.byScene(N.PRIVATE,e.userId),t.next=5,this.markAsRead(n,e);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"groupMarkAsRead",value:function(e){return Se(this,void 0,void 0,(0,h.default)().mark((function t(){var n;return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!G.isUndef(e.groupId)){t.next=2;break}throw new Error("groupId could not be empty.");case 2:return n=Wi.byScene(N.GROUP,e.groupId),t.next=5,this.markAsRead(n,e);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"markMessageAsRead",value:function(e,t){return Se(this,void 0,void 0,(0,h.default)().mark((function n(){var i;return(0,h.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!G.isUndef(e.id)){n.next=2;break}throw new Error("id could not be empty.");case 2:if(Object.values(N).includes(e.type)){n.next=4;break}throw new Error("incorrect type, must be: "+Object.values(N));case 4:return N.CS==e.type&&G.isUndef(t)&&(t=e.id),i=Wi.byScene(e.type,e.id,t),n.next=8,this.markAsRead(i,e);case 8:case"end":return n.stop()}}),n,this)})))}},{key:"markAsRead",value:function(e,t){return Se(this,void 0,void 0,(0,h.default)().mark((function n(){var i;return(0,h.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=this.findHistory(e),n.t0=i,!n.t0){n.next=5;break}return n.next=5,i.markRead();case 5:de.onSuccess(t);case 6:case"end":return n.stop()}}),n,this)})))}},{key:"onRemoteMarkRead",value:function(e){var t=Wi.byMessageReadRemoteEvent(e),n=this.findHistory(t);n&&n.syncMarkedMessage(e)}},{key:"deleteMessage",value:function(e){return Se(this,void 0,void 0,(0,h.default)().mark((function t(){var n,i,s;return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.validateMessageArray(e.messages),Ji.validate(e),n=e.messages[0],i=Wi.byIMMessage(n),s=this.findHistory(i),s){t.next=4;break}throw{code:400,content:"No message that could be deleted"};case 4:return t.next=6,s.deleteMessages(e);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"onRemoteMessageDeleted",value:function(e){var t=Wi.byIMMessageDeletedEvent(e),n=this.findHistory(t);n&&n.syncDeletedMessage(e.deleterId,e.times)}},{key:"onMessageRecalled",value:function(e){var t=Wi.byConversationId(e.scene,e.conversationId),n=this.findHistory(t);n&&n.recallMessages(e)}},{key:"onDisconnected",value:function(){this.map.forEach((function(e,t){e.expire()}))}},{key:"findOrCreateHistory",value:function(e){var t=this.findHistory(e);return t||(t=e.scene===N.CS?D.u()===e.customerId()?new vs(e):new ps(e):new rs(e),this.map.set(e.toString(),t),t)}},{key:"findHistory",value:function(e){return this.map.get(e.toString())}},{key:"validateMessageArray",value:function(e){ms.validateMessageArray(e)}}],[{key:"init",value:function(){return e.instance||(e.instance=new e),e.instance.map=new Map,e.instance}},{key:"get",value:function(t){return e.instance.findOrCreateHistory(t)}}]),e}(),ys=function(){function e(t){(0,m.default)(this,e),this.top=!1,this.data=null,this.dataLoaded=!1,this.target=t}return(0,g.default)(e,[{key:"toDto",value:function(){var e=this.target.scene,t=this.target.id,n=new L;return e===N.PRIVATE?n.userId=t:e===N.GROUP?n.groupId=t:e===N.CS&&(n.id=this.target.teamId),n.type=e,n.lastMessage=this.getMaxMessage(),n.unread=this.getUnreadAmount(),n.top=this.top,n.data=this.data,n}},{key:"getMaxMessage",value:function(){return gs.get(this.target).getMaxMessage()}},{key:"getUnreadAmount",value:function(){return gs.get(this.target).unreadAmount()}},{key:"maxMessageTime",value:function(){return gs.get(this.target).maxTime()}}]),e}(),bs=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(e){var i;return(0,m.default)(this,n),i=t.call(this,e),i.accepted=!1,i}return(0,g.default)(n,[{key:"toDto",value:function(){var e=new L,t=this.target.scene,n=this.target.id,i=this.target.teamId;return e.id=n,e.teamId=i,e.type=t,e.lastMessage=this.getMaxMessage(),e.unread=this.getUnreadAmount(),e.top=this.top,e.data=this.data,e.ended=this.isEnded(),e}},{key:"isEnded",value:function(){var e=this.getMaxMessage(),t=e.type,n=e.payload;return t===_i.END||t===_i.TRANSFER&&n.transferTo.id!==D.u()}},{key:"getMaxMessage",value:function(){return gs.get(this.target).getMaxMessage(this.accepted)}},{key:"getUnreadAmount",value:function(){return gs.get(this.target).unreadAmount(this.accepted)}},{key:"maxMessageTime",value:function(){return gs.get(this.target).maxTime(this.accepted)}}]),n}(ys),ks=(0,g.default)((function e(t,n,i,s){(0,m.default)(this,e),this.type=t,this.top=n,this.targetId=i,this.teamId=s})),Es=(0,g.default)((function e(t,n,i){(0,m.default)(this,e),this.type=t,this.targetId=n,this.teamId=i})),Ss=(0,g.default)((function e(t,n,i){(0,m.default)(this,e),this.type=t,this.targetId=n,this.teamId=i})),ws=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"top",value:function(e,t){var n=new ks(e.scene,t,e.id,e.teamId);return new Promise((function(e,t){var i=new fe({name:oe.topConversation,params:n,permission:re.WRITE,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,success:function(n){200===n.code?e(n):t(n)},fail:function(e){t(e)}});D.e(i)}))}},{key:"remove",value:function(e){var t=new Es(e.scene,e.id,e.teamId);return new Promise((function(e,n){var i=new fe({name:oe.removeConversation,params:t,permission:re.WRITE,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,success:function(t){200==t.code?e(t):n(t)},fail:function(e){n(e)}});D.e(i)}))}},{key:"query",value:function(e){var t=this;return new Promise((function(n,i){var s=new fe({name:e,params:{},permission:re.READ,singleTimeout:ue.commonQuerySingle,totalTimeout:ue.commonQueryTotal,fail:function(e){i(e)},success:function(e){return Se(t,void 0,void 0,(0,h.default)().mark((function t(){return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:n(e);case 1:case"end":return t.stop()}}),t)})))}});D.e(s)}))}},{key:"loadData",value:function(e){var t=new Ss(e.scene,e.id,e.teamId);return new Promise((function(e,n){var i=new fe({name:oe.imData,params:t,permission:re.READ,singleTimeout:ue.commonQuerySingle,totalTimeout:ue.commonQueryTotal,success:function(t){var n=JSON.parse(t.content);e(n)},fail:function(e){n(e)}});D.e(i)}))}}]),e}();ws.instance=new ws;var Cs=function(){function e(){var t=this;(0,m.default)(this,e),this.list=new Array,this.builder=new es,this.remoteConversations=ws.instance,this.synchronized=!1,I.on(Ti.MAX_MESSAGE_CHANGED,(function(e){return t.onMaxMessageChanged(e)})),I.on(Ti.UNREAD_AMOUNT_CHANGED,(function(e){return t.onUnreadMessageChanged(e)})),I.on(Ti.MAX_MESSAGE_DELETED,(function(e){return t.onMaxMessageDeleted(e)}))}return(0,g.default)(e,[{key:"onUnreadMessageChanged",value:function(e){this.findConversation(e)&&this.fireUpdated()}},{key:"fireUpdated",value:function(){var e=this.loadLocalConversations(),t=this.getUpdatedEventName();fa.aec.fire(t,{unreadTotal:e.content.unreadTotal,conversations:e.content.conversations})}},{key:"getUpdatedEventName",value:function(){return ri.CONVERSATIONS_UPDATED}},{key:"latestConversations",value:function(e){return Se(this,void 0,void 0,(0,h.default)().mark((function t(){var n;return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.t0=this.synchronized,t.t0){t.next=4;break}return t.next=4,this.loadServerConversations();case 4:n=this.loadLocalConversations(),de.onSuccess(e,n);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"loadServerConversations",value:function(){return Se(this,void 0,void 0,(0,h.default)().mark((function e(){var t,n;return(0,h.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.rocketName(),e.next=3,this.remoteConversations.query(t);case 3:n=e.sent,this.convertAbbrConversation(n.content),this.synchronized=!0;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"rocketName",value:function(){return oe.imLastConversations}},{key:"convertAbbrConversation",value:function(e){var t,n=e,i=(0,d.default)(n);try{for(i.s();!(t=i.n()).done;){var s=t.value,a=s.t,r=s.top,o=s.d?JSON.parse(s.d):{},u=s.userOffsets;s.lmsg.t=a;var c=s.lmsg,l=this.builder.build(c),f=Wi.byIMMessage(l),h=this.findConversation(f);G.isUndef(h)?(h=this.buildByAbbr(s,l),this.insertOne(h)):(h.top=r,h.data=o),gs.get(f).initMaxMessageAndOffsets(l,u),this.correctPosition(h)}}catch(p){i.e(p)}finally{i.f()}}},{key:"onMaxMessageDeleted",value:function(e){this.removeConversation(e)}},{key:"onMaxMessageChanged",value:function(e){return Se(this,void 0,void 0,(0,h.default)().mark((function t(){var n;return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.scene()!==N.CS){t.next=4;break}if(n=e,D.u()==n.customerId()||!1!==n.accepted&&(n.type!==_i.ACCEPT||n.senderId==D.u())){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,this.saveOrUpdateConversation(e);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"saveOrUpdateConversation",value:function(e){return Se(this,void 0,void 0,(0,h.default)().mark((function t(){var n,i,s;return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.status,i=Wi.byIMMessage(e),s=this.findConversation(i),t.t0=G.isUndef(s)&&n!==O.FAIL,!t.t0){t.next=11;break}if(s=this.buildByMessage(e),this.insertOne(s),t.t1=n===O.SUCCESS,!t.t1){t.next=11;break}return t.next=9,this.remoteConversations.loadData(i);case 9:s.data=t.sent,s.dataLoaded=!0;case 11:n===O.SENDING&&(s.data=e.getToData(),s.dataLoaded=!0),s&&s.dataLoaded&&(this.correctPosition(s),this.fireUpdated());case 13:case"end":return t.stop()}}),t,this)})))}},{key:"loadLocalConversations",value:function(){var e,t=0,n=new Array,i=(0,d.default)(this.list);try{for(i.s();!(e=i.n()).done;){var s=e.value;if(s.dataLoaded&&s.getMaxMessage()){t+=s.getUnreadAmount();var a=s.toDto();n.push(a)}}}catch(r){i.e(r)}finally{i.f()}return{code:200,content:{unreadTotal:t,conversations:n}}}},{key:"findConversationIndex",value:function(e){return this.list.findIndex((function(t){return e.toString()===t.target.toString()}))}},{key:"findConversation",value:function(e){var t=this.findConversationIndex(e);return this.list[t]}},{key:"removeLocalConversation",value:function(e){var t=this.findConversationIndex(e.target);this.list.splice(t,1)}},{key:"insertOne",value:function(t){e.sortedInserter.insert(this.list,t),this.list.length>e.CONVERSATIONS_MAX_LENGTH&&(this.list=this.list.slice(0,e.CONVERSATIONS_MAX_LENGTH))}},{key:"correctPosition",value:function(e){this.removeLocalConversation(e),this.insertOne(e)}},{key:"removeConversation",value:function(e){var t=this.findConversation(e);t&&(this.removeLocalConversation(t),this.fireUpdated())}},{key:"top",value:function(e,t,n){return Se(this,void 0,void 0,(0,h.default)().mark((function i(){var s;return(0,h.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(G.isBoolean(t)){i.next=2;break}throw new Error("top must be boolean.");case 2:if(s=this.findConversation(e),s){i.next=5;break}throw new Error("conversation does not exist.");case 5:if(i.t0=s.top!=t,!i.t0){i.next=11;break}return i.next=9,this.remoteConversations.top(e,t);case 9:s.top=t,this.correctPosition(s);case 11:this.fireUpdated(),de.onSuccess(n);case 13:case"end":return i.stop()}}),i,this)})))}},{key:"remove",value:function(e,t){return Se(this,void 0,void 0,(0,h.default)().mark((function n(){var i;return(0,h.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=this.findConversation(e),i){n.next=3;break}throw new Error("conversation does not exist.");case 3:if(!(i instanceof bs)||i.isEnded()){n.next=5;break}throw new Error("CS conversation can only be deleted after it ends");case 5:return n.next=7,this.remoteConversations.remove(e);case 7:this.removeLocalConversation(i),this.fireUpdated(),de.onSuccess(t);case 10:case"end":return n.stop()}}),n,this)})))}},{key:"buildByAbbr",value:function(e,t){var n,i=Wi.byIMMessage(t);if(e.t===N.CS){var s=t;D.u()===s.customerId()?n=new ys(i):(n=new bs(i),n.accepted=s.accepted)}else n=new ys(i);return n.dataLoaded=!0,n.top=e.top,n.data=e.d?JSON.parse(e.d):{},n}},{key:"buildByMessage",value:function(e){var t,n=Wi.byIMMessage(e);if(e.scene()===N.CS){var i=e;D.u()===i.customerId()?t=new ys(n):(t=new bs(n),t.accepted=i.accepted)}else t=new ys(n);return t}}]),e}();Cs.CONVERSATIONS_MAX_LENGTH=200,Cs.sortedInserter=new(function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"compare",value:function(e,t){var n;if(e.top==t.top){var i=e.maxMessageTime();n=t.maxMessageTime()-i}else n=e.top?-1:1;return 0===n?0:n>0?1:-1}}]),n}(Vi));var Ms=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){var e;return(0,m.default)(this,n),e=t.call(this),e.expired=!1,I.on(Ti.CS_ONLINE_SUCCESS,(function(){return e.onCSOnlineSuccess()})),I.on(Ti.CS_OFFLINE_SUCCESS,(function(){return e.onCSOfflineSuccess()})),D.s().addDisconnectedObserver(e.onDisconnected.bind((0,r.default)(e))),D.s().addConnectedObserver(e.onConnected.bind((0,r.default)(e))),e}return(0,g.default)(n,[{key:"onMaxMessageChanged",value:function(e){return Se(this,void 0,void 0,(0,h.default)().mark((function t(){var n,i;return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.scene()!==N.CS){t.next=10;break}if(n=e,n.customerId()==D.u()||!1!==n.accepted&&n.type!==_i.ACCEPT){t.next=10;break}if(_i.ACCEPT!==e.type){t.next=8;break}i=Wi.byIMMessage(e),this.removeConversation(i),t.next=10;break;case 8:return t.next=10,this.saveOrUpdateConversation(e);case 10:case"end":return t.stop()}}),t,this)})))}},{key:"latestConversations",value:function(e){var t=this,i=Object.create(null,{latestConversations:{get:function(){return(0,o.default)((0,u.default)(n.prototype),"latestConversations",t)}}});return Se(this,void 0,void 0,(0,h.default)().mark((function t(){var n;return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=this.synchronized,t.next=3,i.latestConversations.call(this,e);case 3:this.list.length>0&&!n&&this.fireUpdated();case 4:case"end":return t.stop()}}),t,this)})))}},{key:"onUnreadMessageChanged",value:function(e){}},{key:"onCSOnlineSuccess",value:function(){return Se(this,void 0,void 0,(0,h.default)().mark((function e(){return(0,h.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadServerConversations();case 2:this.fireUpdated();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"onCSOfflineSuccess",value:function(){this.list=[],this.fireUpdated()}},{key:"getUpdatedEventName",value:function(){return ri.PENDING_CONVERSATIONS_UPDATED}},{key:"rocketName",value:function(){return oe.CS_PENDING_CONVERSATION}},{key:"convertAbbrConversation",value:function(e){return Se(this,void 0,void 0,(0,h.default)().mark((function t(){var n,i,s,a,r,o,u,c,l,f,p;return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=e,i=(0,d.default)(n);try{for(i.s();!(s=i.n()).done;)a=s.value,a.lastMessage.t=N.CS,r=a.customerData,o=a.lastMessage,u=a.userOffsets,c=r?JSON.parse(r):{},l=this.builder.build(o),f=Wi.byIMMessage(l),p=this.findConversation(f),G.isUndef(p)&&(p=new bs(f),p.accepted=l.accepted,p.dataLoaded=!0,this.insertOne(p)),p.top=!1,p.data=c,gs.get(f).initPendingMaxMessageAndOffsets(l,u),this.correctPosition(p)}catch(h){i.e(h)}finally{i.f()}case 3:case"end":return t.stop()}}),t,this)})))}},{key:"onDisconnected",value:function(){this.expired=!0}},{key:"onConnected",value:function(){return Se(this,void 0,void 0,(0,h.default)().mark((function e(){var t;return(0,h.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=D.supportIM(),e.t0=this.expired&&t,!e.t0){e.next=8;break}return this.expired=!1,this.list=[],e.next=7,this.loadServerConversations();case 7:this.fireUpdated();case 8:case"end":return e.stop()}}),e,this)})))}}]),n}(Cs),Is=function(){function e(){(0,m.default)(this,e),this.conversations=new Cs,this.pendingConversations=new Ms}return(0,g.default)(e,[{key:"latestConversations",value:function(e){this.conversations.latestConversations(e)}},{key:"latestPendingConversations",value:function(e){this.pendingConversations.latestConversations(e)}},{key:"topPrivateConversation",value:function(e){var t=Wi.byScene(N.PRIVATE,e.userId);this.conversations.top(t,e.top,e)}},{key:"topGroupConversation",value:function(e){var t=Wi.byScene(N.GROUP,e.groupId);this.conversations.top(t,e.top,e)}},{key:"topConversation",value:function(e){var t=e.conversation;this.validateConversationDTO(t);var n=Wi.byConversationDTO(t);this.conversations.top(n,e.top,e)}},{key:"removePrivateConversation",value:function(e){var t=Wi.byScene(N.PRIVATE,e.userId);this.conversations.remove(t,e)}},{key:"removeGroupConversation",value:function(e){var t=Wi.byScene(N.GROUP,e.groupId);this.conversations.remove(t,e)}},{key:"removeConversation",value:function(e){var t=e.conversation;this.validateConversationDTO(t);var n=Wi.byConversationDTO(t);this.conversations.remove(n,e)}},{key:"validateConversationDTO",value:function(e){if(!(e instanceof L))throw new Error("Incorrect conversation object.");var t=e.lastMessage;if(t instanceof Zi&&t.customerId()!==D.u()&&!1===t.accepted)throw new Error("pending conversation cannot be topped or removed.")}}]),e}(),As=function(){function e(){(0,m.default)(this,e),this.builder=new es,he.instance.addAssembler(new(function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"assemble",value:function(e){var t={messageId:e.id,timestamp:e.tm,type:e.t,senderId:e.sid,toType:e.tt};return e.tt===N.GROUP&&(t.groupId=e.gid),t}},{key:"support",value:function(e){return!!e.sid}}]),e}()))}return(0,g.default)(e,[{key:"initialGoEasySocket",value:function(){D.s().addMessageObserver(ge.imMessage,this.onMessageReceived.bind(this))}},{key:"onMessageReceived",value:function(e){if(e.t!==N.CS){var t=this.builder.build(e);this.sendAck(t);var n=Wi.byIMMessage(t),i=n.scene;gs.get(n).existsMessage(t)||(this.createNotification(e),I.fire(Ti.MESSAGE_RECEIVED,t),i===N.PRIVATE?fa.aec.fire(ri.PRIVATE_MESSAGE_RECEIVED,t):i===N.GROUP&&fa.aec.fire(ri.GROUP_MESSAGE_RECEIVED,t))}}},{key:"sendAck",value:function(e){D.s().sendAck("imAck",{publishGuid:e.messageId})}},{key:"createNotification",value:function(e){var t=he.instance.supportNotification();if(G.isObject(e.nt)&&e.s!==D.u()&&t){var n={id:e.i,tm:e.ts,t:e.mt,sid:e.s,tt:e.t};n.tt===N.GROUP&&(n.gid=e.r),he.instance.createLocalNotification(e.nt.t,e.nt.c,n,e.nt.sound,e.nt.badge)}}}]),e}(),Ts=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"subscribe",value:function(e){ve.validateIdArray(e.groupIds,"groupIds"),e.groupIds=e.groupIds.toString().split(",");var t=new fe({name:oe.subscribeGroups,params:{groupIds:e.groupIds,at:e.accessToken},permission:re.WRITE,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,success:function(){de.onSuccess(e,{code:200,content:"ok"})},fail:function(t){de.onFailed(e,{code:t.resultCode||408,content:t.content||"Failed to subscribe group message"})}});D.e(t)}},{key:"unsubscribe",value:function(e){ve.validateId(e.groupId,"groupId"),e.groupId=e.groupId.toString();var t=new fe({name:oe.unsubscribeGroup,params:{groupId:e.groupId},permission:re.READ,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,success:function(){de.onSuccess(e,{code:200,content:"ok"})},fail:function(t){de.onFailed(e,{code:t.resultCode||408,content:t.content||"Failed to unsubscribe group message"})}});D.e(t)}}]),e}(),_s=function(){function e(){(0,m.default)(this,e),D.s().addMessageObserver(ge.groupPresence,this.newMessageReceived.bind(this))}return(0,g.default)(e,[{key:"presence",value:function(e){ve.validateIdArray(e.groupIds,"groupIds"),e.groupIds.toString().split(",");var t={groupIds:e.groupIds};this.emitRocket(oe.subscribeGroupPresence,t,(function(){de.onSuccess(e,{code:200,content:"ok"})}),(function(t){de.onFailed(e,{code:t.code||408,content:t.content||"Failed to subscribe group message"})}),ue.commonRequestSingle,ue.commonRequestTotal)}},{key:"unPresence",value:function(e){ve.validateId(e.groupId,"groupId"),e.groupId=e.groupId.toString();var t={groupId:e.groupId};this.emitRocket(oe.unsubscribeGroupPresence,t,(function(){de.onSuccess(e,{code:200,content:"ok"})}),(function(t){de.onFailed(e,{code:t.code||408,content:t.content||"Failed to unsubscribe presence"})}),ue.commonRequestSingle,ue.commonRequestTotal)}},{key:"emitRocket",value:function(e,t,n,i,s,a){var r=new fe({name:e,params:t,singleTimeout:s,totalTimeout:a,permission:re.WRITE,success:n,fail:i});D.e(r)}},{key:"newMessageReceived",value:function(e){var t=null;e.c&&(t=JSON.parse(e.c)),t&&t.events&&t.events.map((function(e){var n=e.userData?JSON.parse(e.userData):{},i={time:e.time,action:e.action,groupOnlineCount:t.userAmount,groupId:t.groupId,id:e.userId,data:n};fa.aec.fire(ri.GROUP_PRESENCE,i)}))}}]),e}(),Ns=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"get",value:function(e){ve.validateId(e.groupId,"groupId"),e.groupId=e.groupId.toString();var t=new fe({name:oe.imGroupOnlineCount,params:{groupId:e.groupId},permission:re.READ,singleTimeout:ue.commonQuerySingle,totalTimeout:ue.commonQueryTotal,fail:function(t){de.onFailed(e,t||{code:408,content:"Failed to query online group users"})},success:function(t){200==t.code?de.onSuccess(e,t):de.onFailed(e,t)}});D.e(t)}}]),e}(),Os=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"doHereNow",value:function(e,t,n){var i=new fe({name:e,params:t,permission:re.READ,singleTimeout:ue.commonQuerySingle,totalTimeout:ue.commonQueryTotal,fail:function(e){de.onFailed(n,e)},success:function(e){var t=e.content;e.content=t.map((function(e){var t=e.userData?JSON.parse(e.userData):{};return{id:e.userId,data:t}})),de.onSuccess(n,e)}});D.e(i)}}]),e}(),Rs=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"hereNow",value:function(e){ve.validateId(e.groupId,"groupId"),e.groupId=e.groupId.toString();var t={groupId:e.groupId};this.doHereNow(oe.imGroupHereNow,t,e)}}]),n}(Os),xs=function(){function e(){(0,m.default)(this,e),D.s().addMessageObserver(ge.userPresence,this.newMessageReceived.bind(this))}return(0,g.default)(e,[{key:"presence",value:function(e){ve.validateIdArray(e.userIds,"userIds"),e.userIds.toString().split(",");var t={userIds:e.userIds};this.emitRocket(oe.subscribeUserPresence,t,(function(){de.onSuccess(e,{code:200,content:"ok"})}),(function(t){de.onFailed(e,{code:t.code||408,content:t.content||"Failed to subscribe group message"})}),ue.commonRequestSingle,ue.commonRequestTotal)}},{key:"unPresence",value:function(e){ve.validateId(e.userId,"userId"),e.userId=e.userId.toString();var t={userId:e.userId};this.emitRocket(oe.unsubscribeUserPresence,t,(function(){de.onSuccess(e,{code:200,content:"ok"})}),(function(t){de.onFailed(e,{code:t.code||408,content:t.content||"Failed to unsubscribe presence"})}),ue.commonRequestSingle,ue.commonRequestTotal)}},{key:"emitRocket",value:function(e,t,n,i,s,a){var r=new fe({name:e,params:t,singleTimeout:s,totalTimeout:a,permission:re.WRITE,success:n,fail:i});D.e(r)}},{key:"newMessageReceived",value:function(e){var t=[];e.c&&(t=JSON.parse(e.c).events||[]),t.map((function(e){var t=e.userData?JSON.parse(e.userData):{},n={time:e.time,action:e.action,id:e.userId,data:t};fa.aec.fire(ri.USER_PRESENCE,n)}))}}]),e}(),Ps=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"hereNow",value:function(e){var t=e.userIds;ve.validateIdArray(t,"userIds"),t.toString().split(","),this.doHereNow(oe.imHereNow,e,e)}}]),n}(Os),Ds=new(function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"fileExtension",value:function(e,t){if(G.isString(e))try{var n=e.split(t);return n[n.length-1]}catch(e){throw Error(e)}}}]),e}()),Us=(0,g.default)((function e(){(0,m.default)(this,e)})),Ls=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){var e;return(0,m.default)(this,n),e=t.apply(this,arguments),e.contentType="",e.name="",e.size=0,e.url="",e}return(0,g.default)(n)}(Us),Fs=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){var e;return(0,m.default)(this,n),e=t.apply(this,arguments),e.width=0,e.height=0,e}return(0,g.default)(n)}(Ls),Gs=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"build",value:function(e){this.validate(e.createOptions);var t=this.create();return this.setPayload(e,t),t}}]),e}(),Bs=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"create",value:function(){return new Ls}},{key:"setPayload",value:function(e,t){var n=t,i=e.createOptions.file;n.url=i.path,n.name=i.name,n.size=i.size,n.contentType=i.type,e.complete=Promise.resolve()}},{key:"validate",value:function(e){if(!G.isObject(e))throw Error("it is an empty message.");if(!G.isDef(e.file))throw Error("file is empty.")}}]),n}(Gs),qs=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"create",value:function(){return new Fs}},{key:"setPayload",value:function(e,t){(0,o.default)((0,u.default)(n.prototype),"setPayload",this).call(this,e,t);var i=e.createOptions.file,s=t,a=i.path||i.tempFilePath,r=G.isEmpty(i.name)||void 0===i.name?a:i.name;s.name="wx-image."+Ds.fileExtension(r,"."),s.contentType="image/"+Ds.fileExtension(r,"."),s.url=a,s.size=i.size,e.complete=new Promise((function(e,t){wx.getImageInfo({src:s.url,success:function(t){s.width=t.width,s.height=t.height,e()},fail:function(e){t(e)}})}))}},{key:"validate",value:function(e){(0,o.default)((0,u.default)(n.prototype),"validate",this).call(this,e)}}]),n}(Bs),js=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){var e;return(0,m.default)(this,n),e=t.apply(this,arguments),e.duration=0,e}return(0,g.default)(n)}(Ls),Hs=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"create",value:function(){return new js}},{key:"setPayload",value:function(e,t){(0,o.default)((0,u.default)(n.prototype),"setPayload",this).call(this,e,t);var i=e.createOptions.file,s=t,a=i.tempFilePath,r=G.isEmpty(i.name)||null==i.name?a:i.name,c=i.duration,l=i.fileSize;s.url=a,s.size=l,s.duration=c/1e3,s.name="wx-audio."+Ds.fileExtension(r,"."),s.contentType="audio/"+Ds.fileExtension(r,"."),e.complete=Promise.resolve()}},{key:"validate",value:function(e){(0,o.default)((0,u.default)(n.prototype),"validate",this).call(this,e)}}]),n}(Bs),Vs=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){var e;return(0,m.default)(this,n),e=t.apply(this,arguments),e.text="",e}return(0,g.default)(n)}(Us),zs=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"create",value:function(){return new Vs}},{key:"setPayload",value:function(e,t){var n=t,i=e.createOptions;n.text=i.text,e.complete=Promise.resolve()}},{key:"validate",value:function(e){if(G.isEmpty(e.text))throw{code:400,content:"text is empty"};if(!G.isString(e.text))throw{code:400,content:"TypeError: text requires string."};if(""===e.text.trim())throw{code:400,content:"text is empty"};if(e.text.length>2500)throw{code:400,content:"Message text over max length 2500"}}}]),n}(Gs),Ws=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){var e;return(0,m.default)(this,n),e=t.apply(this,arguments),e.video=new Js,e.thumbnail=new Xs,e}return(0,g.default)(n)}(Us),Xs=function(){function e(){(0,m.default)(this,e),this.name="",this.url="",this.width=0,this.height=0,this.contentType=""}return(0,g.default)(e,[{key:"initURL",value:function(e){var t=A.currentPlatform();[E.APP_IOS,E.APP_ANDROID].includes(t)?this.appUrl(e):[E.APPLET_WX,E.APPLET_WX_GAME].includes(t)?this.wxUrl(e):this.htmlUrl(e)}},{key:"htmlUrl",value:function(e){var t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),this.url=t.toDataURL("image/png")}},{key:"wxUrl",value:function(e){}},{key:"appUrl",value:function(e){}}]),e}(),Js=(0,g.default)((function e(){(0,m.default)(this,e),this.name="",this.url="",this.width=0,this.height=0,this.contentType="",this.size=0,this.duration=0})),Ks=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"create",value:function(){return new Ws}},{key:"setPayload",value:function(e,t){var n=e.createOptions.file,i=t,s=i.video,a=i.thumbnail,r=n.duration,o=n.height,u=n.size,c=n.tempFilePath,l=n.thumbTempFilePath,f=n.width,d=n.name,h=void 0===d?"":d,p=G.isEmpty(h)?c:h;s.contentType="video/"+Ds.fileExtension(p,"."),s.name="wx-video."+Ds.fileExtension(p,"."),s.url=c,s.width=a.width=f,s.height=a.height=o,s.size=u,s.duration=r,a.url=l,a.contentType="image/jpg",a.name="wx-thumbnail.jpg",e.complete=Promise.resolve()}},{key:"validate",value:function(e){if(!G.isObject(e))throw Error("it is an empty message.");if(!G.isDef(e.file))throw Error("file is empty.")}}]),n}(Gs),Ys=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"create",value:function(){return new Ls}},{key:"setPayload",value:function(e,t){var n=t,i=e.createOptions.file;n.url=i.fullPath||i.path,n.name=i.name,n.size=i.size,n.contentType=i.type,i.type,e.complete=Promise.resolve()}},{key:"validate",value:function(e){if(!G.isObject(e))throw Error("it is an empty message.");if(!G.isDef(e.file))throw Error("file is empty.")}}]),n}(Gs),Qs=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"create",value:function(){return new Fs}},{key:"setPayload",value:function(e,t){var n=t,i=e.createOptions.file;n.url=i.path,n.size=i.size;var s=G.isEmpty(i.name)||void 0===i.name?i.path:i.name;n.contentType="image/"+Ds.fileExtension(s,"."),n.name="uni-image."+Ds.fileExtension(s,"."),e.complete=new Promise((function(e,t){uni.getImageInfo({src:i.path,success:function(t){n.width=t.width,n.height=t.height,e()},fail:function(e){t(e)}})}))}},{key:"validate",value:function(e){(0,o.default)((0,u.default)(n.prototype),"validate",this).call(this,e)}}]),n}(Ys),$s=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"create",value:function(){return new js}},{key:"setPayload",value:function(e,t){var n=e.createOptions,i=t,s=n.file,a=s.tempFilePath,r=G.isEmpty(s.name)||null==s.name?a:s.name;i.url=a,i.name="uni-audio."+Ds.fileExtension(r,"."),i.contentType="audio/"+Ds.fileExtension(r,"."),e.complete=new Promise((function(e,t){uni.getFileInfo({filePath:a,success:function(s){var r=s.size;if(i.size=r,0===r)e();else if(G.isDef(n.file.duration))i.duration=n.file.duration/1e3,e();else{var o=uni.createInnerAudioContext();o.src=a,o.onCanplay((function(n){n.errCode?(o.destroy(),t(n)):(i.duration=o.duration,o.destroy(),e())})),o.onError((function(n){o.destroy(),-99===n.errCode?e():t(n)}))}},fail:function(e){t(e)}})}))}},{key:"validate",value:function(e){(0,o.default)((0,u.default)(n.prototype),"validate",this).call(this,e)}}]),n}(Ys),Zs=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"create",value:function(){return new Ws}},{key:"setPayload",value:function(e,t){var n=e.createOptions.file,i=t,s=i.video,a=i.thumbnail,r=n.duration,o=n.height,u=n.size,c=n.tempFilePath,l=n.width,f=n.name,d=void 0===f?"":f,h=G.isEmpty(d)?c:d;s.size=u,s.width=l,s.height=o,s.url=c,s.duration=r,s.contentType="video/"+Ds.fileExtension(h,"."),s.name="uni-video."+Ds.fileExtension(h,"."),a.url=c,a.height=200,a.width=Number((s.width*a.height/s.height).toFixed(0)),a.contentType="image/jpg",a.name="uni-thumbnail.jpg",e.complete=Promise.resolve()}},{key:"validate",value:function(e){if(!G.isObject(e))throw Error("it is an empty message.");if(!G.isDef(e.file))throw Error("file is empty.")}}]),n}(Gs),ea=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"create",value:function(){return new Ls}},{key:"setPayload",value:function(e,t){var n=t,i=e.createOptions.file,s=window.URL||window.webkitURL;n.url=s.createObjectURL(i),n.name=i.name,n.size=i.size,n.contentType=i.type,e.complete=Promise.resolve()}},{key:"validate",value:function(e){if(!G.isObject(e))throw Error("it is an empty message.");if(!(e.file instanceof File))throw Error("wrong file type.");if(0==e.file.size)throw Error("File size is 0.");if(e.file.size>524288e3)throw Error("message-length limit 30mib")}}]),n}(Gs),ta=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"create",value:function(){return new Fs}},{key:"setPayload",value:function(e,t){(0,o.default)((0,u.default)(n.prototype),"setPayload",this).call(this,e,t);var i=e.createOptions.file,s=t,a=window.URL||window.webkitURL,r=new Image;r.src=a.createObjectURL(i),e.complete=new Promise((function(e,t){r.onload=function(){s.width=r.width,s.height=r.height,a.revokeObjectURL(r.src),e()},r.onerror=function(e){a.revokeObjectURL(r.src),t(e)}}))}},{key:"validate",value:function(e){(0,o.default)((0,u.default)(n.prototype),"validate",this).call(this,e);var t=["gif","jpg","png","jpeg"];if(!t.find((function(t){return t===e.file.type.split("/")[1].toLowerCase()})))throw Error("Only "+t.join(",")+" is supported image.")}}]),n}(ea),na=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"create",value:function(){return new js}},{key:"setPayload",value:function(e,t){(0,o.default)((0,u.default)(n.prototype),"setPayload",this).call(this,e,t);var i=e.createOptions.file,s=t,a=window.URL||window.webkitURL,r=document.createElement("audio");r.src=a.createObjectURL(i),e.complete=new Promise((function(e,t){r.onloadedmetadata=function(){s.duration=r.duration,a.revokeObjectURL(r.src),e()},r.onerror=function(e){a.revokeObjectURL(r.src),t(e)}}))}},{key:"validate",value:function(e){(0,o.default)((0,u.default)(n.prototype),"validate",this).call(this,e);var t=["mp3","ogg","wav","wma","ape","acc","mpeg"];if(!t.find((function(t){return t===e.file.type.split("/")[1].toLowerCase()})))throw Error("Only "+t.join(",")+" is supported audio.")}}]),n}(ea),ia=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"create",value:function(){return new Ws}},{key:"setPayload",value:function(e,t){var n=this,i=e.createOptions.file,s=t,a=s.video,r=s.thumbnail,o=window.URL||window.webkitURL,u=document.createElement("video");u.src=o.createObjectURL(i),a.size=i.size,a.name=i.name,a.contentType=i.type,a.url=u.src,r.name=i.name,r.contentType="image/jpg",e.complete=new Promise((function(e,t){u.onloadedmetadata=function(){a.duration=u.duration,a.width=u.videoWidth,a.height=u.videoHeight,r.width=u.videoWidth,r.height=u.videoHeight,r.url=n.getThumbnailUrl(u),o.revokeObjectURL(u.src),e()},u.onerror=function(e){o.revokeObjectURL(u.src),t(e)}}))}},{key:"getThumbnailUrl",value:function(e){var t=document.createElement("canvas");return t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t.toDataURL("image/png")}},{key:"validate",value:function(e){if(!G.isObject(e))throw Error("it is an empty message.");if(!(e.file instanceof File))throw Error("wrong file type.");if(0==e.file.size)throw Error("File size is 0.");if(e.file.size>31457280)throw Error("message-length limit 30mib");var t=["avi","mov","rmvb","rm","flv","mp4","3gp","quicktime"];if(!t.find((function(t){return t===e.file.type.split("/")[1].toLowerCase()})))throw Error("Only "+t.join(",")+" is supported video.")}}]),n}(Gs),sa=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n)}(Us),aa=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"create",value:function(){return new sa}},{key:"setPayload",value:function(e,t){var n=e.createOptions;t.payload=n.payload,e.complete=Promise.resolve()}},{key:"validate",value:function(e){var t=e.type,n=e.payload;if(G.isEmpty(t))throw Error("type is empty.");if(!G.isString(t))throw Error("type require a string");if(G.isEmpty(n))throw Error("payload is empty.");if(!G.isPlainObject(n)&&!G.isStringOrNumber(n))throw Error("payload require object | string | number.")}}]),n}(Gs),ra=(0,g.default)((function e(t,n){(0,m.default)(this,e),this.type=t,this.createOptions=n})),oa=function(){function e(){var t;(0,m.default)(this,e),this.framework=T.currentFramework();var n=A.currentPlatform()===E.APPLET_WX;this.payloadBuilders=(t={},(0,v.default)(t,S.UNIAPP,{image:new Qs,file:new Ys,audio:new $s,video:new Zs,text:new zs}),(0,v.default)(t,S.NATIVE_APPLET_WX,{image:new qs,file:new Bs,audio:new Hs,video:new Ks,text:new zs}),(0,v.default)(t,S.UNKNOWN,{image:new ta,file:new ea,audio:new na,video:new ia,text:new zs}),(0,v.default)(t,S.TARO,{image:n?new qs:new ta,file:n?new Bs:new ea,audio:n?new Hs:new na,video:n?new Ks:new ia,text:new zs}),t)}return(0,g.default)(e,[{key:"buildMessage",value:function(e,t){var n=this.payloadBuilders[this.framework][e],i=new ra(e,t);if(n){var s=n.build(i);i.payload=s}else{var a=(new aa).build(i);i.payload=a.payload}var r=this.build(i);return i.complete.then((function(){de.onSuccess(t,r)})).catch((function(e){de.onFailed(t,e)})),r}},{key:"build",value:function(e){var t,n=e.type,i=e.payload,s=e.createOptions,a=s.to,r=a.type;return this.validate(s),r===N.GROUP?(t=new $i,t.groupId=a.id.toString(),t.senderData=D.ud()):r===N.PRIVATE?(t=new Qi,t.read=!1,t.receiverId=a.id.toString()):r===N.CS&&(t=new Zi,t.to=a.id.toString(),t.teamId=a.id.toString(),t.senderData=D.ud()),t.senderId=D.u(),t.messageId=le.get(),t.payload=i,t.timestamp=Date.now(),t.type=n,t.recalled=!1,t.status=O.NEW,t.buildOptions=e,t}},{key:"validate",value:function(e){var t=e.to;if(!t)throw new Error("message require property to.");if(!G.isObject(t))throw new Error("TypeError: to requires an object.");if(!G.isObject(t.data))throw new Error("TypeError: to.data requires an object.");if(!t.type||t.type!==N.GROUP&&t.type!==N.PRIVATE&&t.type!==N.CS)throw new Error("message require property to.type");if(G.isEmpty(t.id))throw new Error("message require property to.id");if(!G.isStringOrNumber(t.id))throw new Error("to.id should be a string or number.");if(D.u()===t.id)throw new Error("to.id can not be the same as your id.");G.isDef(e.notification)&&ve.validateNotification(e.notification),e.wxmpTemplateMsg&&ve.validateWXMPTemplateMsg(e.wxmpTemplateMsg)}}]),e}(),ua=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(){return(0,m.default)(this,n),t.apply(this,arguments)}return(0,g.default)(n,[{key:"onMessageReceived",value:function(e){var t=this;if(e.t===N.CS){var n=this.builder.build(e);this.sendAck(n);var i=Wi.byIMMessage(n);gs.get(i).existsMessage(n)||(n.customerId()===D.u()?(this.createNotification(e),I.fire(Ti.MESSAGE_RECEIVED,n),fa.aec.fire(ri.CS_MESSAGE_RECEIVED,n)):ds.getInstance().queryTeams().then((function(){hs.isMyMessage(n)&&t.createNotification(e),I.fire(Ti.CS_AGENT_MESSAGE_RECEIVED,n)})))}}}]),n}(As),ca=(0,g.default)((function e(t){var n=this;(0,m.default)(this,e),this.times=new Array;var i=t[0],s=Wi.byIMMessage(i);this.scene=s.scene,this.targetId=s.id,t.forEach((function(e){n.times.push(e.timestamp)})),this.times.sort((function(e,t){return e<t?-1:e==t?0:1}))})),la=function(){function e(){(0,m.default)(this,e),D.s().addMessageObserver(ge.IM_MSG_RECALLED,this.onRemoteRecalled.bind(this))}return(0,g.default)(e,[{key:"recallMessage",value:function(e){return Se(this,void 0,void 0,(0,h.default)().mark((function t(){var n,i,s,a,r,o,u;return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return ms.validateMessageArray(e.messages),this.validate(e),n=e.messages,t.next=4,this.recallServerMessages(n);case 4:i=n[0],s=i.scene(),a=this.toConversationId(s,i.senderId,i.targetId()),r={id:D.u(),data:D.ud()},o=n.map((function(e){return e.timestamp})),u=new as(s,a,r,o),I.fire(Ti.MESSAGE_RECALLED,u),de.onSuccess(e);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"onRemoteRecalled",value:function(e){I.fire(Ti.MESSAGE_RECALLED,e)}},{key:"toConversationId",value:function(e,t,n){if(N.PRIVATE===e)return function(e,t){return e.localeCompare(t)>0?"".concat(e,":").concat(t):"".concat(t,":").concat(e)}(t,n);if(N.GROUP===e)return n;throw{code:400,content:"scene: ".concat(e," not support")}}},{key:"recallServerMessages",value:function(e){var t=new ca(e);return 0===t.times.length?Promise.resolve():new Promise((function(e,n){var i=new fe({name:oe.IM_RECALL_MESSAGE,params:t,permission:re.WRITE,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,fail:function(e){n(e)},success:function(t){200===t.code?e(t):n(t)}});D.e(i)}))}},{key:"validate",value:function(e){for(var t=e.messages,n=0;n<t.length;n++){var i=t[n];if(i.scene()===N.CS)throw{code:400,content:"Recall CS message is not supported yet."};if(i.status!==O.SUCCESS)throw{code:400,content:"message["+n+"] is '"+i.status+"' and cannot be recalled"};if(i.recalled)throw{code:400,content:"message["+n+"] has been recalled"};if(i.senderId!==D.u())throw{code:400,content:"it is not allowed to recall messages sent by others"}}}}]),e}(),fa=function(){function e(t){(0,m.default)(this,e),this._iMReceiver=new As,this.csMessageReceiver=new ua,this.options=t,e.aec=new bi,this._userHereNow=new Ps,this.goEasyUploader=new Di,this._groupHereNow=new Rs,this._groupOnlineCount=new Ns,this.groupMessageSubscriber=new Ts}return(0,g.default)(e,[{key:"afterConnect",value:function(){this._iMReceiver.initialGoEasySocket(),this.csMessageReceiver.initialGoEasySocket(),this.messageBuilder=new oa,this.messageSender=new Hi,this.recaller=new la,this.histories=gs.init(),this.histories.initialListeners(),this.conversations=new Is,this._groupPresenceSubscriber=new _s,this._userPresenceSubscriber=new xs}},{key:"validateModules",value:function(){if(G.isUndef(D.s()))throw Error("Please call connect() first.");if(!this.options.modules||!this.options.modules.includes(R))throw Error("Invalid options: module '".concat(R,"' is not enabled"))}},{key:"catch",value:function(e,t){return Se(this,void 0,void 0,(0,h.default)().mark((function n(){return(0,h.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,this.validateModules(),ve.validateCallbackOptions(t),n.next=5,e();case 5:n.next=10;break;case 7:n.prev=7,n.t0=n["catch"](0),de.onFailed(t,n.t0);case 10:case"end":return n.stop()}}),n,this,[[0,7]])})))}},{key:"on",value:function(t,n){e.aec.on(t,n)}},{key:"off",value:function(t,n){e.aec.off(t,n)}},{key:"createTextMessage",value:function(e){return this.validateModules(),this.messageBuilder.buildMessage(Ai.TEXT,e)}},{key:"createImageMessage",value:function(e){return this.validateModules(),this.messageBuilder.buildMessage(Ai.IMAGE,e)}},{key:"createFileMessage",value:function(e){return this.validateModules(),this.messageBuilder.buildMessage(Ai.FILE,e)}},{key:"createAudioMessage",value:function(e){return this.validateModules(),this.messageBuilder.buildMessage(Ai.AUDIO,e)}},{key:"createVideoMessage",value:function(e){return this.validateModules(),this.messageBuilder.buildMessage(Ai.VIDEO,e)}},{key:"createCustomMessage",value:function(e){return this.validateModules(),this.messageBuilder.buildMessage(e.type,e)}},{key:"sendMessage",value:function(e){var t=this;this.catch((function(){t.messageSender.send(e)}),e)}},{key:"recallMessage",value:function(e){var t=this;this.catch((function(){t.recaller.recallMessage(e)}),e)}},{key:"deleteMessage",value:function(e){var t=this;this.catch((function(){t.histories.deleteMessage(e)}),e)}},{key:"markGroupMessageAsRead",value:function(e){var t=this;this.catch((function(){return Se(t,void 0,void 0,(0,h.default)().mark((function t(){return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.histories.groupMarkAsRead(e);case 2:case"end":return t.stop()}}),t,this)})))}),e)}},{key:"markPrivateMessageAsRead",value:function(e){var t=this;this.catch((function(){return Se(t,void 0,void 0,(0,h.default)().mark((function t(){return(0,h.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.histories.privateMarkAsRead(e);case 2:case"end":return t.stop()}}),t,this)})))}),e)}},{key:"markMessageAsRead",value:function(e,t){var n=this;this.catch((function(){return Se(n,void 0,void 0,(0,h.default)().mark((function n(){return(0,h.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,this.histories.markMessageAsRead(e,t);case 2:case"end":return n.stop()}}),n,this)})))}),e)}},{key:"latestConversations",value:function(e){this.validateModules(),this.conversations.latestConversations(e)}},{key:"removePrivateConversation",value:function(e){var t=this;this.catch((function(){return t.conversations.removePrivateConversation(e)}),e)}},{key:"removeGroupConversation",value:function(e){var t=this;this.catch((function(){return t.conversations.removeGroupConversation(e)}),e)}},{key:"topPrivateConversation",value:function(e){var t=this;this.catch((function(){return t.conversations.topPrivateConversation(e)}),e)}},{key:"topGroupConversation",value:function(e){var t=this;this.catch((function(){return t.conversations.topGroupConversation(e)}),e)}},{key:"history",value:function(e,t){var n=this;this.catch((function(){n.histories.loadHistory(e,t)}),e)}},{key:"subscribeUserPresence",value:function(e){var t=this;this.catch((function(){return t._userPresenceSubscriber.presence(e)}),e)}},{key:"unsubscribeUserPresence",value:function(e){var t=this;this.catch((function(){return t._userPresenceSubscriber.unPresence(e)}),e)}},{key:"hereNow",value:function(e){var t=this;this.catch((function(){return t._userHereNow.hereNow(e)}),e)}},{key:"subscribeGroup",value:function(e){var t=this;this.catch((function(){return t.groupMessageSubscriber.subscribe(e)}),e)}},{key:"unsubscribeGroup",value:function(e){var t=this;this.catch((function(){return t.groupMessageSubscriber.unsubscribe(e)}),e)}},{key:"subscribeGroupPresence",value:function(e){var t=this;this.catch((function(){return t._groupPresenceSubscriber.presence(e)}),e)}},{key:"unsubscribeGroupPresence",value:function(e){var t=this;this.catch((function(){return t._groupPresenceSubscriber.unPresence(e)}),e)}},{key:"groupHereNow",value:function(e){var t=this;this.catch((function(){return t._groupHereNow.hereNow(e)}),e)}},{key:"groupOnlineCount",value:function(e){var t=this;this.catch((function(){return t._groupOnlineCount.get(e)}),e)}},{key:"latestPendingConversations",value:function(e){this.validateModules(),this.conversations.latestPendingConversations(e)}},{key:"topConversation",value:function(e){this.validateModules(),this.conversations.topConversation(e)}},{key:"removeConversation",value:function(e){this.validateModules(),this.conversations.removeConversation(e)}}],[{key:"init",value:function(t){e.instance=new e(t)}}]),e}(),da=(0,g.default)((function e(t,n){(0,m.default)(this,e),this.customerId=t,this.teamId=n})),ha=(0,g.default)((function e(t,n){(0,m.default)(this,e),this.teamId=t;var i=new F(n.id.toString(),JSON.stringify(n.data));this.customer=i})),pa=(0,g.default)((function e(t,n,i){(0,m.default)(this,e),this.customerId=t,this.teamId=n,this.agentId=i})),va=(0,g.default)((function e(t,n){(0,m.default)(this,e),this.customerId=t,this.teamId=n})),ma=function(){function e(t){(0,m.default)(this,e),this.builder=new es,this.teamId=t}return(0,g.default)(e,[{key:"accept",value:function(e,t){var n=this,i=t.customer;if(G.isUndef(i))throw{code:400,content:"customer is required."};ve.validateId(i.id,"customer.id");var s=i.data;if(G.isUndef(s)||!G.isObject(s))throw{code:400,content:"customer data must be non-empty object."};var a=new ha(e,i),r=new fe({name:oe.CS_ACCEPT,params:a,permission:re.WRITE,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,fail:function(e){de.onFailed(t,e)},success:function(e){var i=n.builder.build(e.content.message);I.fire(Ti.CS_ACCEPTED,i),de.onSuccess(t)}});D.e(r)}},{key:"end",value:function(e,t){var n=this;ve.validateId(t.id,"id");var i=t.id.toString(),s=new va(i,e),a=new fe({name:oe.CS_END,params:s,permission:re.WRITE,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,fail:function(e){de.onFailed(t,e)},success:function(e){var i=n.builder.build(e.content.message);I.fire(Ti.CS_ENDED,i),de.onSuccess(t)}});D.e(a)}},{key:"queryCustomerStatus",value:function(e,t){return Se(this,void 0,void 0,(0,h.default)().mark((function n(){var i;return(0,h.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return ve.validateId(t.id,"id"),n.next=3,this.doCustomerStatus(e,t.id);case 3:i=n.sent,this.activeCustomerStatus=i,this.activeCustomerStatusOptions=t,de.onSuccess(t,i);case 5:case"end":return n.stop()}}),n,this)})))}},{key:"doCustomerStatus",value:function(e,t){var n=t.toString(),i=new da(n,e);return new Promise((function(e,t){var n=new fe({name:oe.CS_CUSTOMER_STATUS,params:i,permission:re.READ,singleTimeout:ue.commonQuerySingle,totalTimeout:ue.commonQueryTotal,fail:function(e){t(e)},success:function(t){var n=t.content;n.agent&&(n.agent.data=JSON.parse(n.agent.data)),e(n)}});D.e(n)}))}},{key:"transfer",value:function(e,t){var n=this;ve.validateId(t.customerId,"customerId"),ve.validateId(t.agentId,"agentId");var i=t.customerId.toString(),s=t.agentId.toString(),a=new pa(i,e,s),r=new fe({name:oe.CS_TRANSFER,params:a,permission:re.WRITE,singleTimeout:ue.commonRequestSingle,totalTimeout:ue.commonRequestTotal,fail:function(e){de.onFailed(t,e)},success:function(e){var i=n.builder.build(e.content.message);I.fire(Ti.CS_TRANSFER,i),de.onSuccess(t)}});D.e(r)}}]),e}(),ga=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"createTextMessage",value:function(e,t){var n=fa.instance.createTextMessage(t);this.extendProps(e,n)}},{key:"createImageMessage",value:function(e,t){var n=fa.instance.createImageMessage(t);this.extendProps(e,n)}},{key:"createFileMessage",value:function(e,t){var n=fa.instance.createFileMessage(t);this.extendProps(e,n)}},{key:"createAudioMessage",value:function(e,t){var n=fa.instance.createAudioMessage(t);this.extendProps(e,n)}},{key:"createVideoMessage",value:function(e,t){var n=fa.instance.createVideoMessage(t);this.extendProps(e,n)}},{key:"createCustomMessage",value:function(e,t){var n=fa.instance.createCustomMessage(t);this.extendProps(e,n)}},{key:"extendProps",value:function(e,t){if(t.scene()===N.CS){var n=t;n.teamId=e,n.accepted=!0}}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),ya=function(){function e(t){(0,m.default)(this,e),this.teamId=t,this.agentStatus=ds.getInstance(),this.conversationHandler=new ma(t),this.messageCreator=ga.getInstance()}return(0,g.default)(e,[{key:"catch",value:function(e,t){return Se(this,void 0,void 0,(0,h.default)().mark((function n(){return(0,h.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,ve.validateCallbackOptions(t),n.next=4,e();case 4:n.next=9;break;case 6:n.prev=6,n.t0=n["catch"](0),de.onFailed(t,n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})))}},{key:"isOnline",value:function(e){var t=this;this.catch((function(){t.agentStatus.isOnline(t.teamId,e)}),e)}},{key:"online",value:function(e){var t=this;this.catch((function(){t.agentStatus.online(t.teamId,e)}),e)}},{key:"offline",value:function(e){var t=this;this.catch((function(){t.agentStatus.offline(t.teamId,e)}),e)}},{key:"customerStatus",value:function(e){var t=this;this.catch((function(){t.conversationHandler.queryCustomerStatus(t.teamId,e)}),e)}},{key:"accept",value:function(e){var t=this;this.catch((function(){t.conversationHandler.accept(t.teamId,e)}),e)}},{key:"end",value:function(e){var t=this;this.catch((function(){t.conversationHandler.end(t.teamId,e)}),e)}},{key:"history",value:function(e){fa.instance.history(e,this.teamId)}},{key:"markMessageAsRead",value:function(e){fa.instance.markMessageAsRead(e,this.teamId)}},{key:"createTextMessage",value:function(e){this.messageCreator.createTextMessage(this.teamId,e)}},{key:"createImageMessage",value:function(e){this.messageCreator.createImageMessage(this.teamId,e)}},{key:"createFileMessage",value:function(e){this.messageCreator.createFileMessage(this.teamId,e)}},{key:"createAudioMessage",value:function(e){this.messageCreator.createAudioMessage(this.teamId,e)}},{key:"createVideoMessage",value:function(e){this.messageCreator.createVideoMessage(this.teamId,e)}},{key:"createCustomMessage",value:function(e){this.messageCreator.createCustomMessage(this.teamId,e)}},{key:"transfer",value:function(e){var t=this;this.catch((function(){t.conversationHandler.transfer(t.teamId,e)}),e)}},{key:"agents",value:function(e){var t=this;this.catch((function(){t.agentStatus.agents(t.teamId,e)}),e)}},{key:"liveSession",value:function(e){var t=this;this.catch((function(){hs.live(t.teamId,e)}),e)}},{key:"quitLiveSession",value:function(e){this.catch((function(){hs.quit(e)}),e)}},{key:"listenCustomer",value:function(e){var t=this,n={customerId:e.id,onNewMessage:e.onNewMessage,onStatusUpdated:e.onStatusUpdated,onFailed:e.onFailed,onSuccess:e.onSuccess};this.catch((function(){hs.live(t.teamId,n)}),e)}},{key:"cancelListenCustomer",value:function(e){this.catch((function(){hs.quit(e)}),e)}}]),e}(),ba=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,null,[{key:"team",value:function(e){ve.validateId(e,"teamId");var t=this.teams.get(e);return t||(t=new ya(e.toString()),this.teams.set(e.toString(),t)),t}}]),e}();ba.teams=new Map;var ka=function(){function e(t){(0,m.default)(this,e),fa.init(t)}return(0,g.default)(e,[{key:"afterConnect",value:function(){fa.instance.afterConnect()}},{key:"on",value:function(e,t){fa.instance.on(e,t)}},{key:"off",value:function(e,t){fa.instance.off(e,t)}},{key:"createTextMessage",value:function(e){return fa.instance.createTextMessage(e)}},{key:"createImageMessage",value:function(e){return fa.instance.createImageMessage(e)}},{key:"createFileMessage",value:function(e){return fa.instance.createFileMessage(e)}},{key:"createAudioMessage",value:function(e){return fa.instance.createAudioMessage(e)}},{key:"createVideoMessage",value:function(e){return fa.instance.createVideoMessage(e)}},{key:"createCustomMessage",value:function(e){return fa.instance.createCustomMessage(e)}},{key:"sendMessage",value:function(e){fa.instance.sendMessage(e)}},{key:"recallMessage",value:function(e){fa.instance.recallMessage(e)}},{key:"deleteMessage",value:function(e){fa.instance.deleteMessage(e)}},{key:"markGroupMessageAsRead",value:function(e){fa.instance.markGroupMessageAsRead(e)}},{key:"markPrivateMessageAsRead",value:function(e){fa.instance.markPrivateMessageAsRead(e)}},{key:"latestConversations",value:function(e){fa.instance.latestConversations(e)}},{key:"removePrivateConversation",value:function(e){fa.instance.removePrivateConversation(e)}},{key:"removeGroupConversation",value:function(e){fa.instance.removeGroupConversation(e)}},{key:"topPrivateConversation",value:function(e){fa.instance.topPrivateConversation(e)}},{key:"topGroupConversation",value:function(e){fa.instance.topGroupConversation(e)}},{key:"history",value:function(e){fa.instance.history(e)}},{key:"subscribeUserPresence",value:function(e){fa.instance.subscribeUserPresence(e)}},{key:"unsubscribeUserPresence",value:function(e){fa.instance.unsubscribeUserPresence(e)}},{key:"hereNow",value:function(e){fa.instance.hereNow(e)}},{key:"subscribeGroup",value:function(e){fa.instance.subscribeGroup(e)}},{key:"unsubscribeGroup",value:function(e){fa.instance.unsubscribeGroup(e)}},{key:"subscribeGroupPresence",value:function(e){fa.instance.subscribeGroupPresence(e)}},{key:"unsubscribeGroupPresence",value:function(e){fa.instance.unsubscribeGroupPresence(e)}},{key:"groupHereNow",value:function(e){fa.instance.groupHereNow(e)}},{key:"groupOnlineCount",value:function(e){fa.instance.groupOnlineCount(e)}},{key:"markMessageAsRead",value:function(e){fa.instance.markMessageAsRead(e)}},{key:"csteam",value:function(e){return new Ea(e)}},{key:"pendingConversations",value:function(e){fa.instance.latestPendingConversations(e)}},{key:"topConversation",value:function(e){fa.instance.topConversation(e)}},{key:"removeConversation",value:function(e){fa.instance.removeConversation(e)}}]),e}(),Ea=function(){function e(t){(0,m.default)(this,e),this.id=t}return(0,g.default)(e,[{key:"isOnline",value:function(e){ba.team(this.id).isOnline(e)}},{key:"online",value:function(e){ba.team(this.id).online(e)}},{key:"offline",value:function(e){ba.team(this.id).offline(e)}},{key:"customerStatus",value:function(e){ba.team(this.id).customerStatus(e)}},{key:"accept",value:function(e){ba.team(this.id).accept(e)}},{key:"end",value:function(e){ba.team(this.id).end(e)}},{key:"history",value:function(e){ba.team(this.id).history(e)}},{key:"markMessageAsRead",value:function(e){ba.team(this.id).markMessageAsRead(e)}},{key:"createTextMessage",value:function(e){ba.team(this.id).createTextMessage(e)}},{key:"createImageMessage",value:function(e){ba.team(this.id).createImageMessage(e)}},{key:"createFileMessage",value:function(e){ba.team(this.id).createFileMessage(e)}},{key:"createAudioMessage",value:function(e){ba.team(this.id).createAudioMessage(e)}},{key:"createVideoMessage",value:function(e){ba.team(this.id).createVideoMessage(e)}},{key:"createCustomMessage",value:function(e){ba.team(this.id).createCustomMessage(e)}},{key:"transfer",value:function(e){ba.team(this.id).transfer(e)}},{key:"agents",value:function(e){ba.team(this.id).agents(e)}},{key:"liveSession",value:function(e){ba.team(this.id).liveSession(e)}},{key:"quitLiveSession",value:function(e){ba.team(this.id).quitLiveSession(e)}},{key:"listenCustomer",value:function(e){ba.team(this.id).listenCustomer(e)}},{key:"cancelListenCustomer",value:function(e){ba.team(this.id).cancelListenCustomer(e)}}]),e}(),Sa=function(){function e(t){if((0,m.default)(this,e),G.isDef(e.instance)&&e.instance.getConnectionStatus()!==w.DISCONNECTED)return e.instance;this.validateOptions(t),_.init(t.reactNativeOptions),this.options=t,he.init(t.allowNotification),this.pubsub=new Ae(this.options),this.im=new ka(this.options)}return(0,g.default)(e,[{key:"setBadge",value:function(e){he.instance.setBadge(e)}},{key:"connect",value:function(e){this.getConnectionStatus()!==w.DISCONNECTED&&G.isObject(e)&&G.isFunction(e.onFailed)?e.onFailed({code:408,content:"It is already connected, don't try again until disconnect() is called. "}):(this.confirmUserIdAndData(e),I.initial(),this.pubsub.initialBeforeConnect(),this.goEasySocket=new mi(this.options,e),this.goEasySocket.connect(),D.i(this.goEasySocket),this.im.afterConnect(),this.pubsub.initialGoEasySocket())}},{key:"disconnect",value:function(e){this.goEasySocket.disconnect().then((function(){G.isObject(e)&&G.isFunction(e.onSuccess)&&e.onSuccess()})).catch((function(t){G.isObject(e)&&G.isFunction(e.onFailed)&&e.onFailed(t)}))}},{key:"getConnectionStatus",value:function(){return this.goEasySocket?this.goEasySocket.getStatus():w.DISCONNECTED}},{key:"validateOptions",value:function(e){var t="";if(!G.isObject(e))throw t="options is require an object.",Error(t);if(!G.isPrimitive(e.appkey)||0==e.appkey.length)throw t="Invalid options:'appkey' is empty.",Error(t);if(!G.isPrimitive(e.host)||0==e.host.length)throw t="Invalid options:'host' is empty.",Error(t);if(!G.isArray(e.modules))throw t="Invalid options: 'modules' must be nonempty array",Error(t);var n=[R,x],i=e.modules.map((function(e){var i=e.toUpperCase();if(!n.includes(i))throw t="Invalid options: module '".concat(e,"' is not support"),Error(t);return i}));e.modules=i}},{key:"onClickNotification",value:function(e){he.instance.onClickNotification(e)}},{key:"confirmUserIdAndData",value:function(e){if(this.options.modules.includes(R)){if(!G.isStringOrNumber(e.id))throw{code:400,content:"TypeError: id requires number or string."};if(!G.isObject(e.data))throw{code:400,content:"TypeError: data requires object."}}else if("string"==typeof e.id&&e.id.length>60)throw{code:400,content:"id over max length 60"}}}],[{key:"getInstance",value:function(t){return G.isUndef(e.instance)&&(e.instance=new e(t)),e.instance}}]),e}();t.default=Sa,Sa.version=U,Sa.IM_EVENT=ri,Sa.IM_SCENE=N,Sa.MEDIA_TYPE=oi}).call(this,n("c8ba"),n("4362"),n("b639").Buffer)},"1c0f":function(e,t,n){var i=n("899e");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var s=n("4f06").default;s("2f28b73e",i,!0,{sourceMap:!1,shadowMode:!1})},"2ba2":function(e,t,n){"use strict";n.r(t);var i=n("90c2"),s=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=s.a},"2c4c":function(e,t,n){"use strict";n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},n("d9e2"),n("d401")},"2d07":function(e,t,n){"use strict";var i=n("1c0f"),s=n.n(i);s.a},"33d1":function(e,t,n){"use strict";var i=n("23e7"),s=n("7b0b"),a=n("07fa"),r=n("5926"),o=n("44d2");i({target:"Array",proto:!0},{at:function(e){var t=s(this),n=a(t),i=r(e),o=i>=0?i:n+i;return o<0||o>=n?void 0:t[o]}}),o("at")},4362:function(e,t,n){t.nextTick=function(e){var t=Array.prototype.slice.call(arguments);t.shift(),setTimeout((function(){e.apply(null,t)}),0)},t.platform=t.arch=t.execPath=t.title="browser",t.pid=1,t.browser=!0,t.env={},t.argv=[],t.binding=function(e){throw new Error("No such module. (Possibly not yet loaded)")},function(){var e,i="/";t.cwd=function(){return i},t.chdir=function(t){e||(e=n("df7c9")),i=e.resolve(t,i)}}(),t.exit=t.kill=t.umask=t.dlopen=t.uptime=t.memoryUsage=t.uvCounters=function(){},t.features={}},4693:function(e,t,n){"use strict";n.r(t);var i=n("87f5"),s=n("2ba2");for(var a in s)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(a);n("c70d");var r=n("f0c5"),o=Object(r["a"])(s["default"],i["b"],i["c"],!1,null,"40d88c0a",null,!1,i["a"],void 0);t["default"]=o.exports},5377:function(e,t,n){"use strict";var i=n("da84"),s=n("83ab"),a=n("edd0"),r=n("ad6d"),o=n("d039"),u=i.RegExp,c=u.prototype,l=s&&o((function(){var e=!0;try{u(".","d")}catch(l){e=!1}var t={},n="",i=e?"dgimsy":"gimsy",s=function(e,i){Object.defineProperty(t,e,{get:function(){return n+=i,!0}})},a={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var r in e&&(a.hasIndices="d"),a)s(r,a[r]);var o=Object.getOwnPropertyDescriptor(c,"flags").get.call(t);return o!==i||n!==i}));l&&a(c,"flags",{configurable:!0,get:r})},"54f8":function(e,t,n){"use strict";n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=(0,i.default)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var s=0,a=function(){};return{s:a,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,r=e},f:function(){try{o||null==n["return"]||n["return"]()}finally{if(u)throw r}}}},n("a4d3"),n("e01a"),n("d3b7"),n("d28b"),n("3ca3"),n("ddb0"),n("d9e2"),n("d401");var i=function(e){return e&&e.__esModule?e:{default:e}}(n("dde1"))},"6c579":function(e,t,n){"use strict";var i=n("23e7"),s=n("da84");i({global:!0,forced:s.globalThis!==s},{globalThis:s})},"7ff3":function(e,t,n){"use strict";n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){while(!Object.prototype.hasOwnProperty.call(e,t))if(e=(0,i.default)(e),null===e)break;return e};var i=function(e){return e&&e.__esModule?e:{default:e}}(n("f20d"))},"8151d":function(e,t,n){"use strict";n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},n("d3b7"),n("f8c9"),n("4ae1")},"87f5":function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return i}));var i={tnBadge:n("8eb7").default},s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"tn-avatar-class tn-avatar",class:[e.backgroundColorClass,e.avatarClass],style:[e.avatarStyle],on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.click.apply(void 0,arguments)}}},[e.showImg?n("v-uni-image",{staticClass:"tn-avatar__img",class:[e.imgClass],attrs:{src:e.src,mode:e.imgMode||"aspectFill"},on:{error:function(t){arguments[0]=t=e.$handleEvent(t),e.loadImageError.apply(void 0,arguments)}}}):n("v-uni-view",{staticClass:"tn-avatar__text"},[e.text?n("v-uni-view",[e._v(e._s(e.text))]):n("v-uni-view",{class:["tn-icon-"+e.icon]})],1),e.badge&&(e.badgeIcon||e.badgeText)?n("tn-badge",{attrs:{radius:e.badgeSize,backgroundColor:e.badgeBgColor,fontColor:e.badgeColor,fontSize:e.badgeSize-8,absolute:!0,top:e.badgePosition[0],right:e.badgePosition[1]}},[e.badgeIcon&&""===e.badgeText?n("v-uni-view",[n("v-uni-view",{class:["tn-icon-"+e.badgeIcon]})],1):n("v-uni-view",[e._v(e._s(e.badgeText))])],1):e._e()],1)},a=[]},"899e":function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,'@charset "UTF-8";\n/**\n * 下方引入的为Tuniao UI的集成样式文件，为scss预处理器，其中包含了一些"tn-"开头的自定义变量\n * 使用的时候，请将下面的一行复制到您的uniapp项目根目录的uni.scss中即可\n * Tuniao UI自定义的css类名和scss变量，均以"tn-"开头，不会造成冲突，请放心使用 \n */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */uni-view[data-v-b0d46eaa],\nuni-button[data-v-b0d46eaa],\nuni-text[data-v-b0d46eaa],\nuni-input[data-v-b0d46eaa],\nuni-textarea[data-v-b0d46eaa]{margin:0;padding:0;box-sizing:border-box}.tn-custom-nav-bar__back[data-v-b0d46eaa]{width:60%;height:100%;position:relative;display:flex;justify-content:space-evenly;align-items:center;box-sizing:border-box;background-color:rgba(0,0,0,.15);border-radius:%?1000?%;border:%?1?% solid hsla(0,0%,100%,.5);color:#fff;font-size:18px}.tn-custom-nav-bar__back .icon[data-v-b0d46eaa]{display:block;flex:1;margin:auto;text-align:center}\n/* 顶部渐变*/.tn-navbg[data-v-b0d46eaa]{background:linear-gradient(-120deg,#0976ea,#c471f5,#f956b6,#ea7e0a);background-size:500% 500%;-webkit-animation:gradientBG-data-v-b0d46eaa 15s ease infinite;animation:gradientBG-data-v-b0d46eaa 15s ease infinite;position:fixed;top:0;width:100%;z-index:100}@-webkit-keyframes gradientBG-data-v-b0d46eaa{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}@keyframes gradientBG-data-v-b0d46eaa{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}\n/* 聊天消息 */.chat[data-v-b0d46eaa]{\n  /* 底部聊天发送栏 */}.chat .scroll-view[data-v-b0d46eaa]{background-color:#f6f6f6}.chat .scroll-view[data-v-b0d46eaa] ::-webkit-scrollbar{display:none;width:0!important;height:0!important;-webkit-appearance:none;background:transparent;color:transparent}.chat .scroll-view .chat-body[data-v-b0d46eaa]{display:flex;flex-direction:column;padding-top:%?23?%}.chat .scroll-view .chat-body .self[data-v-b0d46eaa]{justify-content:flex-end}.chat .scroll-view .chat-body .item[data-v-b0d46eaa]{display:flex;padding:%?23?% %?30?%}.chat .scroll-view .chat-body .item .right[data-v-b0d46eaa]{background-color:#00ff7f}.chat .scroll-view .chat-body .item .left[data-v-b0d46eaa]{background-color:#fff}.chat .scroll-view .chat-body .item .right[data-v-b0d46eaa]::after{position:absolute;display:inline-block;content:"";width:0;height:0;left:100%;top:10px;border:%?12?% solid transparent;border-left:%?12?% solid #00ff7f}.chat .scroll-view .chat-body .item .left[data-v-b0d46eaa]::after{position:absolute;display:inline-block;content:"";width:0;height:0;top:10px;right:100%;border:%?12?% solid transparent;border-right:%?12?% solid #fff}.chat .scroll-view .chat-body .item .content[data-v-b0d46eaa]{position:relative;max-width:%?486?%;border-radius:%?8?%;word-wrap:break-word;padding:%?24?% %?24?%;margin:0 %?24?%;border-radius:5px;font-size:%?32?%;font-family:PingFang SC;font-weight:500;color:#333;line-height:%?42?%}.chat .scroll-view .chat-body .item .avatar[data-v-b0d46eaa]{display:flex;justify-content:center;width:%?78?%;height:%?78?%;overflow:hidden}.chat .scroll-view .chat-body .item .avatar uni-image[data-v-b0d46eaa]{align-self:center}.chat .chat-bottom[data-v-b0d46eaa]{width:100%;height:%?177?%;background:#f4f5f7;transition:all .1s ease}.chat .chat-bottom .send-msg[data-v-b0d46eaa]{display:flex;align-items:flex-end;padding:%?16?% %?30?%;width:100%;min-height:%?177?%;position:fixed;bottom:0;background:#ededed;transition:all .1s ease;z-index:999}.chat .chat-bottom .uni-textarea[data-v-b0d46eaa]{padding-bottom:%?70?%}.chat .chat-bottom .uni-textarea uni-textarea[data-v-b0d46eaa]{width:%?537?%;min-height:%?75?%;max-height:%?500?%;background:#fff;border-radius:%?8?%;font-size:%?32?%;font-family:PingFang SC;color:#333;line-height:%?43?%;padding:%?5?% %?8?%}.chat .chat-bottom .send-btn[data-v-b0d46eaa]{display:flex;align-items:center;justify-content:center;margin-bottom:%?70?%;margin-left:%?25?%;width:%?128?%;height:%?75?%;background:#4f7df5;border-radius:%?8?%;font-size:%?28?%;font-family:PingFang SC;font-weight:500;color:#fff;line-height:%?28?%}',""]),e.exports=t},"89df":function(e,t,n){"use strict";n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("ac1f"),n("5319"),n("d401"),n("d3b7"),n("25f0"),n("e25e"),n("00b4"),n("4d63"),n("c607"),n("2c3e");var i={getHoroscope:function(e){e=new Date(e);var t=e.getMonth()+1,n=e.getDate(),i=t-(n-14<"865778999988".charAt(t));return["摩羯","水瓶","双鱼","白羊","金牛","双子","巨蟹","狮子","处女","天秤","天蝎","射手","摩羯"][i]+"座"},sumAge:function(e){var t=new Date(e.replace(/-/g,"/")),n=new Date,i=n.getTime()-t.getTime(),s=Math.floor(i/864e5),a=i%864e5,r=Math.floor(a/36e5),o=a%36e5,u=(Math.floor(o/6e4),o%6e4);Math.round(u/1e3);return s+"天 "+r+"小时 "},getChatTime:function(e,t){if(e=e.toString().length<13?1e3*e:e,t=t.toString().length<13?1e3*t:t,(parseInt(e)-parseInt(t))/1e3>300)return this.gettime(e)},gettime:function(e){e=e.toString().length<13?1e3*e:e;var t=(new Date).getTime(),n=(t-parseInt(e))/1e3;return n<43200?this.dateFormat(new Date(e),"{A} {t}:{ii}"):n<518400?this.dateFormat(new Date(e),"{Mon}月{DD}日 {A} {t}:{ii}"):this.dateFormat(new Date(e),"{Y}-{MM}-{DD} {A} {t}:{ii}")},parseNumber:function(e){return e<10?"0"+e:e},dateFormat:function(e,t){var n={},i=/\{([^}]+)\}/;n["Y"]=e.getFullYear(),n["M"]=e.getMonth()+1,n["MM"]=this.parseNumber(n["M"]),n["Mon"]=["1","2","3","4","5","6","7","8","9","10","11","12"][n["M"]-1],n["D"]=e.getDate(),n["DD"]=this.parseNumber(n["D"]),n["h"]=e.getHours(),n["hh"]=this.parseNumber(n["h"]),n["t"]=n["h"]>12?n["h"]-12:n["h"],n["tt"]=this.parseNumber(n["t"]),n["A"]=n["h"]>12?"下午":"上午",n["i"]=e.getMinutes(),n["ii"]=this.parseNumber(n["i"]),n["s"]=e.getSeconds(),n["ss"]=this.parseNumber(n["s"]);while(i.test(t))t=t.replace(i,n[RegExp.$1]);return t},getAgeByBirthday:function(e){var t=new Date(e.replace(/-/g,"/")),n=new Date;return n.getFullYear()-t.getFullYear()-(n.getMonth()<t.getMonth()||n.getMonth()==t.getMonth()&&n.getDate()<t.getDate()?1:0)}};t.default=i},"8ba4":function(e,t,n){"use strict";var i=n("23e7"),s=n("eac5");i({target:"Number",stat:!0},{isInteger:s})},"90c2":function(e,t,n){"use strict";n("7a82");var i=n("ee27").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("a9e3"),n("99af"),n("ac1f"),n("00b4");var s=i(n("9edb")),a={mixins:[s.default],name:"tn-avatar",props:{index:{type:[Number,String],default:0},shape:{type:String,default:"circle"},size:{type:[Number,String],default:""},shadow:{type:Boolean,default:!1},border:{type:Boolean,default:!1},borderColor:{type:String,default:"rgba(0, 0, 0, 0.1)"},borderSize:{type:Number,default:2},src:{type:String,default:""},text:{type:String,default:""},icon:{type:String,default:""},imgMode:{type:String,default:"aspectFill"},badge:{type:Boolean,default:!1},badgeSize:{type:Number,default:0},badgeBgColor:{type:String,default:"#AAAAAA"},badgeColor:{type:String,default:"#FFFFFF"},badgeIcon:{type:String,default:""},badgeText:{type:String,default:""},badgePosition:{type:Array,default:function(){return[0,0]}}},data:function(){return{imgLoadError:!1}},computed:{showImg:function(){return""===this.text&&""===this.icon},avatarClass:function(){var e="";return e+=" tn-avatar--".concat(this.shape),this._checkSizeIsInline()&&(e+=" tn-avatar--".concat(this.size)),this.shadow&&(e+=" tn-avatar--shadow"),e},avatarStyle:function(){var e={};return this.backgroundColorStyle?e.background=this.backgroundColorStyle:this.shadow&&this.showImg&&(e.backgroundImage="url(".concat(this.src,")")),this.border&&(e.border="".concat(this.borderSize,"rpx solid ").concat(this.borderColor)),this._checkSizeIsInline()||(e.width=this.size,e.height=this.size),e},imgClass:function(){var e="";return e+=" tn-avatar__img--".concat(this.shape),e}},methods:{loadImageError:function(){this.imgLoadError=!0},click:function(){this.$emit("click",this.index)},_checkSizeIsInline:function(){return!!/^(xs|sm|md|lg|xl|xxl)$/.test(this.size)}}};t.default=a},"920b":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&(0,i.default)(e,t)},n("d9e2"),n("d401"),n("7a82");var i=function(e){return e&&e.__esModule?e:{default:e}}(n("0de3"))},"92a6":function(e,t,n){"use strict";n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=(0,s.default)();return function(){var n,s=(0,i.default)(e);if(t){var r=(0,i.default)(this).constructor;n=Reflect.construct(s,arguments,r)}else n=s.apply(this,arguments);return(0,a.default)(this,n)}},n("4ae1"),n("d3b7"),n("f8c9");var i=r(n("f20d")),s=r(n("8151d")),a=r(n("e1a7"));function r(e){return e&&e.__esModule?e:{default:e}}},a8ca:function(e,t,n){"use strict";n.r(t);var i=n("b5f0"),s=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=s.a},b207:function(e,t,n){var i=n("e667");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var s=n("4f06").default;s("17f01f3a",i,!0,{sourceMap:!1,shadowMode:!1})},b5f0:function(e,t,n){"use strict";n("7a82");var i=n("ee27").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("d3b7"),n("159b"),n("a9e3"),n("ac1f"),n("00b4");var s=i(n("f07e")),a=i(n("c964")),r=i(n("89df")),o=i(n("1696")),u={data:function(){return{keyboardHeight:0,bottomHeight:0,username:uni.getStorageSync("username"),targetUsername:"",avatar:"",targetUserAvatar:"",scrollTop:0,userId:uni.getStorageSync("userId"),toUserId:"",chatMsg:"",msgList:[]}},updated:function(){this.scrollToBottom()},computed:{windowHeight:function(){return this.rpxTopx(uni.getSystemInfoSync().windowHeight)},inputHeight:function(){return this.bottomHeight+this.keyboardHeight}},created:function(){this.concatGoEasy()},onLoad:function(e){var t=this;this.targetUsername=e.username,this.targetUserAvatar=e.avatar,this.toUserId=e.toUserId,this.$nextTick((function(){t.getMessageList()})),uni.onKeyboardHeightChange((function(e){t.keyboardHeight=t.rpxTopx(e.height-30),t.keyboardHeight<0&&(t.keyboardHeight=0)}))},onUnload:function(){uni.offKeyboardHeightChange()},methods:{concatGoEasy:function(){var e=o.default.getInstance({host:"hangzhou.goeasy.io",appkey:"BC-e6007929793d4dd588eca98b9f07cd6c",modules:["pubsub"]});e.connect({onSuccess:function(){console.log("GoEasy connect successfully.")},onFailed:function(e){console.log("Failed to connect GoEasy, code:"+e.code+",error:"+e.content)}});var t=this;e.pubsub.subscribe({channel:"im-channel",onMessage:function(e){JSON.parse(e.content).from===t.targetUsername&&(wx.vibrateLong(),t.getMessageList()),JSON.parse(e.content).to===t.targetUsername&&t.getMessageList()},onSuccess:function(){console.log("Channel订阅成功。")},onFailed:function(e){console.log("Channel订阅失败, 错误编码："+e.code+" 错误信息："+e.content)}})},getMessageList:function(){var e=this;return(0,a.default)((0,s.default)().mark((function t(){var n,i;return(0,s.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,uni.$http.get("/message/getMessageList/"+uni.getStorageSync("userId")+"/"+e.toUserId);case 2:n=t.sent,i=n.data,e.msgList=i.data,e.msgList.forEach((function(t){t.createTime=e.formatTime(t.createTime)}));case 6:case"end":return t.stop()}}),t)})))()},formatTime:function(e){return r.default.getChatTime(new Date(e).getTime())},cancle:function(){uni.navigateBack()},focus:function(){this.scrollToBottom()},blur:function(){this.scrollToBottom()},rpxTopx:function(e){var t=wx.getSystemInfoSync().windowWidth,n=750/t*Number(e);return Math.floor(n)},sendHeight:function(){var e=this;setTimeout((function(){var t=uni.createSelectorQuery();t.select(".send-msg").boundingClientRect(),t.exec((function(t){e.bottomHeight=e.rpxTopx(t[0].height)}))}),5)},scrollToBottom:function(e){var t=this;setTimeout((function(){var e=uni.createSelectorQuery().in(t);e.select("#scrollview").boundingClientRect(),e.select("#msglistview").boundingClientRect(),e.exec((function(e){e[1].height>e[0].height&&(t.scrollTop=t.rpxTopx(e[1].height-e[0].height))}))}),5)},handleSend:function(){""!==this.chatMsg?this.chatMsg&&/^\s+$/.test(this.chatMsg)||(uni.$http.get("/imserver/send?from="+this.username+"&to="+this.targetUsername+"&content="+this.chatMsg),this.chatMsg="",this.scrollToBottom()):uni.$showMsg("不能发送空白消息")}}};t.default=u},bf19:function(e,t,n){"use strict";var i=n("23e7"),s=n("c65b");i({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return s(URL.prototype.toString,this)}})},c1ea:function(e,t,n){"use strict";n.r(t);var i=n("ff67"),s=n("a8ca");for(var a in s)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(a);n("2d07");var r=n("f0c5"),o=Object(r["a"])(s["default"],i["b"],i["c"],!1,null,"b0d46eaa",null,!1,i["a"],void 0);t["default"]=o.exports},c70d:function(e,t,n){"use strict";var i=n("b207"),s=n.n(i);s.a},dca8:function(e,t,n){"use strict";var i=n("23e7"),s=n("bb2f"),a=n("d039"),r=n("861d"),o=n("f183").onFreeze,u=Object.freeze,c=a((function(){u(1)}));i({target:"Object",stat:!0,forced:c,sham:!s},{freeze:function(e){return u&&r(e)?u(o(e)):e}})},df7c9:function(e,t,n){(function(e){function n(e,t){for(var n=0,i=e.length-1;i>=0;i--){var s=e[i];"."===s?e.splice(i,1):".."===s?(e.splice(i,1),n++):n&&(e.splice(i,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function i(e,t){if(e.filter)return e.filter(t);for(var n=[],i=0;i<e.length;i++)t(e[i],i,e)&&n.push(e[i]);return n}t.resolve=function(){for(var t="",s=!1,a=arguments.length-1;a>=-1&&!s;a--){var r=a>=0?arguments[a]:e.cwd();if("string"!==typeof r)throw new TypeError("Arguments to path.resolve must be strings");r&&(t=r+"/"+t,s="/"===r.charAt(0))}return t=n(i(t.split("/"),(function(e){return!!e})),!s).join("/"),(s?"/":"")+t||"."},t.normalize=function(e){var a=t.isAbsolute(e),r="/"===s(e,-1);return e=n(i(e.split("/"),(function(e){return!!e})),!a).join("/"),e||a||(e="."),e&&r&&(e+="/"),(a?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(i(e,(function(e,t){if("string"!==typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,n){function i(e){for(var t=0;t<e.length;t++)if(""!==e[t])break;for(var n=e.length-1;n>=0;n--)if(""!==e[n])break;return t>n?[]:e.slice(t,n-t+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var s=i(e.split("/")),a=i(n.split("/")),r=Math.min(s.length,a.length),o=r,u=0;u<r;u++)if(s[u]!==a[u]){o=u;break}var c=[];for(u=o;u<s.length;u++)c.push("..");return c=c.concat(a.slice(o)),c.join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!==typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,i=-1,s=!0,a=e.length-1;a>=1;--a)if(t=e.charCodeAt(a),47===t){if(!s){i=a;break}}else s=!1;return-1===i?n?"/":".":n&&1===i?"/":e.slice(0,i)},t.basename=function(e,t){var n=function(e){"string"!==typeof e&&(e+="");var t,n=0,i=-1,s=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!s){n=t+1;break}}else-1===i&&(s=!1,i=t+1);return-1===i?"":e.slice(n,i)}(e);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){"string"!==typeof e&&(e+="");for(var t=-1,n=0,i=-1,s=!0,a=0,r=e.length-1;r>=0;--r){var o=e.charCodeAt(r);if(47!==o)-1===i&&(s=!1,i=r+1),46===o?-1===t?t=r:1!==a&&(a=1):-1!==t&&(a=-1);else if(!s){n=r+1;break}}return-1===t||-1===i||0===a||1===a&&t===i-1&&t===n+1?"":e.slice(t,i)};var s="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,n("4362"))},e1a7:function(e,t,n){"use strict";n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(t&&("object"===(0,i.default)(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return(0,s.default)(e)},n("d9e2"),n("d401");var i=a(n("0122")),s=a(n("2c4c"));function a(e){return e&&e.__esModule?e:{default:e}}},e667:function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,'@charset "UTF-8";\n/**\n * 下方引入的为Tuniao UI的集成样式文件，为scss预处理器，其中包含了一些"tn-"开头的自定义变量\n * 使用的时候，请将下面的一行复制到您的uniapp项目根目录的uni.scss中即可\n * Tuniao UI自定义的css类名和scss变量，均以"tn-"开头，不会造成冲突，请放心使用 \n */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.tn-avatar[data-v-40d88c0a]{display:inline-flex;margin:0;padding:0;text-align:center;align-items:center;justify-content:center;background-color:#e6e6e6;white-space:nowrap;position:relative;width:%?64?%;height:%?64?%;z-index:1}.tn-avatar--sm[data-v-40d88c0a]{width:%?48?%;height:%?48?%}.tn-avatar--lg[data-v-40d88c0a]{width:%?96?%;height:%?96?%}.tn-avatar--xl[data-v-40d88c0a]{width:%?128?%;height:%?128?%}.tn-avatar--square[data-v-40d88c0a]{border-radius:%?10?%}.tn-avatar--circle[data-v-40d88c0a]{border-radius:%?5000?%}.tn-avatar--shadow[data-v-40d88c0a]{position:relative}.tn-avatar--shadow[data-v-40d88c0a]::after{content:" ";display:block;background:inherit;-webkit-filter:blur(%?10?%);filter:blur(%?10?%);position:absolute;width:100%;height:100%;top:%?10?%;left:%?10?%;z-index:-1;opacity:.4;-webkit-transform-origin:0 0;transform-origin:0 0;border-radius:inherit;-webkit-transform:scale(1);transform:scale(1)}.tn-avatar__img[data-v-40d88c0a]{width:100%;height:100%}.tn-avatar__img--square[data-v-40d88c0a]{border-radius:%?10?%}.tn-avatar__img--circle[data-v-40d88c0a]{border-radius:%?5000?%}.tn-avatar__text[data-v-40d88c0a]{display:flex;flex-direction:row;align-items:center;justify-content:center}',""]),e.exports=t},ea98:function(e,t,n){"use strict";var i=n("23e7"),s=n("e330"),a=n("1d80"),r=n("5926"),o=n("577e"),u=n("d039"),c=s("".charAt),l=u((function(){return"\ud842"!=="𠮷".at(-2)}));i({target:"String",proto:!0,forced:l},{at:function(e){var t=o(a(this)),n=t.length,i=r(e),s=i>=0?i:n+i;return s<0||s>=n?void 0:c(t,s)}})},f20d:function(e,t,n){"use strict";function i(e){return t.default=i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=i,n("131a"),n("3410")},f4b3:function(e,t,n){"use strict";var i=n("23e7"),s=n("d039"),a=n("7b0b"),r=n("c04e"),o=s((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}));i({target:"Date",proto:!0,arity:1,forced:o},{toJSON:function(e){var t=a(this),n=r(t,"number");return"number"!=typeof n||isFinite(n)?t.toISOString():null}})},fbf1:function(e,t,n){"use strict";n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=s,n("d3b7"),n("f8c9"),n("5d41"),n("e439");var i=function(e){return e&&e.__esModule?e:{default:e}}(n("7ff3"));function s(){return"undefined"!==typeof Reflect&&Reflect.get?t.default=s=Reflect.get.bind():t.default=s=function(e,t,n){var s=(0,i.default)(e,t);if(s){var a=Object.getOwnPropertyDescriptor(s,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},s.apply(this,arguments)}},ff67:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return i}));var i={tnNavBar:n("aa86").default,tnAvatar:n("4693").default},s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("v-uni-view",{staticClass:"tn-navbg",style:{height:e.vuex_custom_bar_height+"px"}},[n("tn-nav-bar",{attrs:{fixed:!0,alpha:!0,customBack:!0}},[n("v-uni-view",{staticClass:"tn-custom-nav-bar__back",attrs:{slot:"back"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.cancle.apply(void 0,arguments)}},slot:"back"},[n("v-uni-text",{staticClass:"icon tn-icon-left-arrow"})],1),n("v-uni-text",{staticStyle:{"font-weight":"600"}},[e._v(e._s(e.targetUsername))])],1)],1),n("v-uni-view",{staticClass:"chat",style:{marginTop:e.vuex_custom_bar_height+"px"}},[n("v-uni-scroll-view",{staticClass:"scroll-view",style:{height:e.windowHeight-e.inputHeight+"rpx"},attrs:{id:"scrollview","scroll-y":"true","scroll-top":e.scrollTop}},[n("v-uni-view",{staticClass:"chat-body",attrs:{id:"msglistview"}},e._l(e.msgList,(function(t,i){return n("v-uni-view",{key:t.id},[t.from===e.userId?n("v-uni-view",{staticClass:"item self"},[n("v-uni-view",{staticClass:"content right"},[e._v(e._s(t.content))]),n("v-uni-view",{staticClass:"avatar"},[n("tn-avatar",{attrs:{src:t.avatar,shape:"square",size:"lg"}})],1)],1):e._e(),t.from!=e.userId?n("v-uni-view",{staticClass:"item Ai"},[n("v-uni-view",{staticClass:"avatar"},[n("tn-avatar",{attrs:{src:t.avatar,shape:"square",size:"lg"}})],1),n("v-uni-view",{staticClass:"content left"},[e._v(e._s(t.content))])],1):e._e()],1)})),1)],1),n("v-uni-view",{staticClass:"chat-bottom",style:{height:e.inputHeight+"rpx"}},[n("v-uni-view",{staticClass:"send-msg",style:{bottom:e.keyboardHeight+"rpx"}},[n("v-uni-view",{staticClass:"uni-textarea"},[n("v-uni-textarea",{attrs:{maxlength:"300","confirm-type":"send","show-confirm-bar":!1,"adjust-position":!1,"auto-height":!0},on:{confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.handleSend.apply(void 0,arguments)},linechange:function(t){arguments[0]=t=e.$handleEvent(t),e.sendHeight.apply(void 0,arguments)},focus:function(t){arguments[0]=t=e.$handleEvent(t),e.focus.apply(void 0,arguments)},blur:function(t){arguments[0]=t=e.$handleEvent(t),e.blur.apply(void 0,arguments)}},model:{value:e.chatMsg,callback:function(t){e.chatMsg=t},expression:"chatMsg"}})],1),n("v-uni-button",{staticClass:"send-btn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handleSend.apply(void 0,arguments)}}},[e._v("发送")])],1)],1)],1)],1)},a=[]}}]);