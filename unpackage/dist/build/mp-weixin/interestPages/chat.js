(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["interestPages/chat"],{"0db7":function(t,e,n){"use strict";(function(t,o){var a=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(n("2eee")),r=a(n("c973")),c=a(n("89df")),s=a(n("1696")),u={data:function(){return{keyboardHeight:0,bottomHeight:0,username:t.getStorageSync("username"),targetUsername:"",avatar:"",targetUserAvatar:"",scrollTop:0,userId:t.getStorageSync("userId"),toUserId:"",chatMsg:"",msgList:[]}},updated:function(){this.scrollToBottom()},computed:{windowHeight:function(){return this.rpxTopx(t.getSystemInfoSync().windowHeight)},inputHeight:function(){return this.bottomHeight+this.keyboardHeight}},created:function(){this.concatGoEasy()},onLoad:function(e){var n=this;this.targetUsername=e.username,this.targetUserAvatar=e.avatar,this.toUserId=e.toUserId,this.$nextTick((function(){n.getMessageList()})),t.onKeyboardHeightChange((function(t){n.keyboardHeight=n.rpxTopx(t.height-30),n.keyboardHeight<0&&(n.keyboardHeight=0)}))},onUnload:function(){t.offKeyboardHeightChange()},methods:{concatGoEasy:function(){var t=s.default.getInstance({host:"hangzhou.goeasy.io",appkey:"BC-e6007929793d4dd588eca98b9f07cd6c",modules:["pubsub"]});t.connect({onSuccess:function(){console.log("GoEasy connect successfully.")},onFailed:function(t){console.log("Failed to connect GoEasy, code:"+t.code+",error:"+t.content)}});var e=this;t.pubsub.subscribe({channel:"im-channel",onMessage:function(t){JSON.parse(t.content).from===e.targetUsername&&(o.vibrateLong(),e.getMessageList()),JSON.parse(t.content).to===e.targetUsername&&e.getMessageList()},onSuccess:function(){console.log("Channel订阅成功。")},onFailed:function(t){console.log("Channel订阅失败, 错误编码："+t.code+" 错误信息："+t.content)}})},getMessageList:function(){var e=this;return(0,r.default)(i.default.mark((function n(){var o,a;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$http.get("/message/getMessageList/"+t.getStorageSync("userId")+"/"+e.toUserId);case 2:o=n.sent,a=o.data,e.msgList=a.data,e.msgList.forEach((function(t){t.createTime=e.formatTime(t.createTime)}));case 6:case"end":return n.stop()}}),n)})))()},formatTime:function(t){return c.default.getChatTime(new Date(t).getTime())},cancle:function(){t.navigateBack()},focus:function(){this.scrollToBottom()},blur:function(){this.scrollToBottom()},rpxTopx:function(t){var e=o.getSystemInfoSync().windowWidth,n=750/e*Number(t);return Math.floor(n)},sendHeight:function(){var e=this;setTimeout((function(){var n=t.createSelectorQuery();n.select(".send-msg").boundingClientRect(),n.exec((function(t){e.bottomHeight=e.rpxTopx(t[0].height)}))}),5)},scrollToBottom:function(e){var n=this;setTimeout((function(){var e=t.createSelectorQuery().in(n);e.select("#scrollview").boundingClientRect(),e.select("#msglistview").boundingClientRect(),e.exec((function(t){t[1].height>t[0].height&&(n.scrollTop=n.rpxTopx(t[1].height-t[0].height))}))}),5)},handleSend:function(){""!==this.chatMsg?this.chatMsg&&/^\s+$/.test(this.chatMsg)||(t.$http.get("/imserver/send?from="+this.username+"&to="+this.targetUsername+"&content="+this.chatMsg),this.chatMsg="",this.scrollToBottom()):t.$showMsg("不能发送空白消息")}}};e.default=u}).call(this,n("543d")["default"],n("bc2e")["default"])},"30e4":function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}));var o={tnNavBar:function(){return Promise.all([n.e("common/vendor"),n.e("tuniao-ui/components/tn-nav-bar/tn-nav-bar")]).then(n.bind(null,"aa86"))},tnAvatar:function(){return Promise.all([n.e("common/vendor"),n.e("tuniao-ui/components/tn-avatar/tn-avatar")]).then(n.bind(null,"4693"))}},a=function(){var t=this.$createElement;this._self._c},i=[]},6339:function(t,e,n){"use strict";var o=n("dc58"),a=n.n(o);a.a},7454:function(t,e,n){"use strict";(function(t,e){var o=n("4ea4");n("1827");o(n("66fd"));var a=o(n("7fc7"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(a.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},"7fc7":function(t,e,n){"use strict";n.r(e);var o=n("30e4"),a=n("989b");for(var i in a)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(i);n("6339");var r=n("f0c5"),c=Object(r["a"])(a["default"],o["b"],o["c"],!1,null,"f8957212",null,!1,o["a"],void 0);e["default"]=c.exports},"989b":function(t,e,n){"use strict";n.r(e);var o=n("0db7"),a=n.n(o);for(var i in o)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(i);e["default"]=a.a},dc58:function(t,e,n){}},[["7454","common/runtime","common/vendor"]]]);