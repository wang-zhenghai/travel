(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["minePages/blog/blog"],{"2a06":function(e,t,n){"use strict";var o=n("ae27"),r=n.n(o);r.a},5441:function(e,t,n){"use strict";n.r(t);var o=n("68ff"),r=n("8a6a");for(var u in r)["default"].indexOf(u)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(u);n("2a06");var i=n("f0c5"),a=Object(i["a"])(r["default"],o["b"],o["c"],!1,null,"e9dc4a82",null,!1,o["a"],void 0);t["default"]=a.exports},"68ff":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return o}));var o={tnNavBar:function(){return Promise.all([n.e("common/vendor"),n.e("tuniao-ui/components/tn-nav-bar/tn-nav-bar")]).then(n.bind(null,"aa86"))},uSwiper:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-swiper/u-swiper")]).then(n.bind(null,"a0e3"))},uButton:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-button/u-button")]).then(n.bind(null,"6545"))},uTag:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-tag/u-tag")]).then(n.bind(null,"287f"))},uReadMore:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-read-more/u-read-more")]).then(n.bind(null,"e970"))},uParse:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-parse/u-parse")]).then(n.bind(null,"03f4"))},uDivider:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-divider/u-divider")]).then(n.bind(null,"a923"))},tnEmpty:function(){return n.e("tuniao-ui/components/tn-empty/tn-empty").then(n.bind(null,"c9e6"))},tnTag:function(){return Promise.all([n.e("common/vendor"),n.e("tuniao-ui/components/tn-tag/tn-tag")]).then(n.bind(null,"5b3c"))},tnAvatar:function(){return Promise.all([n.e("common/vendor"),n.e("tuniao-ui/components/tn-avatar/tn-avatar")]).then(n.bind(null,"4693"))},uModal:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-modal/u-modal")]).then(n.bind(null,"8d90"))},uOverlay:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-overlay/u-overlay")]).then(n.bind(null,"a0b9"))},"u-Textarea":function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u--textarea/u--textarea")]).then(n.bind(null,"42d9"))},tnPopup:function(){return Promise.all([n.e("common/vendor"),n.e("tuniao-ui/components/tn-popup/tn-popup")]).then(n.bind(null,"3a3d"))},uLine:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-line/u-line")]).then(n.bind(null,"41d2"))},tnButton:function(){return Promise.all([n.e("common/vendor"),n.e("tuniao-ui/components/tn-button/tn-button")]).then(n.bind(null,"e6e0"))},uTabbar:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-tabbar/u-tabbar")]).then(n.bind(null,"2e24"))},"u-Input":function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u--input/u--input")]).then(n.bind(null,"9231"))},uTabbarItem:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-tabbar-item/u-tabbar-item")]).then(n.bind(null,"9cbd"))}},r=function(){var e=this,t=e.$createElement,n=(e._self._c,e.commentsList.length),o=e.__map(e.commentsList,(function(t,n){var o=e.__get_orig(t),r=e.handlePublishTimeDesc(t.createTime),u=e.__map(t.children,(function(t,n){var o=e.__get_orig(t),r=e.handlePublishTimeDesc(t.createTime);return{$orig:o,m1:r}}));return{$orig:o,m0:r,l0:u}}));e._isMounted||(e.e0=function(t){e.delShow=!1}),e.$mp.data=Object.assign({},{$root:{g0:n,l1:o}})},u=[]},"6e50":function(e,t,n){"use strict";(function(e){var o=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n("2eee")),u=o(n("c973")),i={name:"Blog",components:{NavIndexButton:function(){n.e("libs/components/nav-index-button").then(function(){return resolve(n("1cf3"))}.bind(null,n)).catch(n.oe)}},data:function(){return{showChildrenComment:!1,blogData:"",backgroundColor:"#90d7ec",placeholder:"亲,请输入你想说的吧...",delShow:!1,showReport:!1,swiperList:[],reportList:[{id:1,backgroundColor:"#fffef9",title:"谩骂攻击"},{id:2,backgroundColor:"#fffef9",title:"色情低俗"},{id:3,backgroundColor:"#fffef9",title:"网络暴力"},{id:4,backgroundColor:"#fffef9",title:"违法违规"},{id:5,backgroundColor:"#fffef9",title:"政治敏感"},{id:6,backgroundColor:"#fffef9",title:"垃圾广告"},{id:7,backgroundColor:"#fffef9",title:"危害人身安全"},{id:8,backgroundColor:"#fffef9",title:"未成年相关"},{id:9,backgroundColor:"#fffef9",title:"其他"}],loginUserId:"",tagList:"",commentsList:"",blogUserId:"",uId:"",commentCount:0,liked:!1,isFollow:!1,show:!1,userId:"",browse:0,comment:"",commentsForm:{},selected:0,publishTimeDesc:"",delId:0,bId:"",longitude:"",latitude:"",id:""}},onShow:function(){this.queryBlogById(),this.getComments(),this.getBlogUserId()},methods:{load:function(){this.$refs.uReadMore.init()},openChildrenComment:function(){!1===this.showChildrenComment?this.showChildrenComment=!0:this.showChildrenComment=!1},rightClick:function(){e.navigateBack()},closeshowReport:function(){for(var e=0;e<this.reportList.length;e++)this.reportList[e].backgroundColor="#fffef9"},selectReports:function(e){"#fffef9"===this.reportList[e].backgroundColor?this.reportList[e].backgroundColor="#fe3157":this.reportList[e].backgroundColor="#fffef9"},goUserHome:function(t){e.navigateTo({url:"/searchPages/userHome?userId="+t})},submitReport:function(){var t=this;if(!e.getStorageSync("token"))return e.navigateTo({url:"/pages/login/login?index=1"}),void e.$showMsg("亲，先登录才能举报哦~");this.reportList.map((function(e){return e.backgroundColor})).includes("#fe3157")?(e.showToast({title:"感谢您的举报~",icon:"success"}),setTimeout((function(){t.showReport=!1}),1e3)):e.$showMsg("亲，请选择举报原因！")},report:function(){this.showReport=!0},closeShow:function(){this.placeholder="亲,请输入你想说的吧...",this.show=!1,this.comment=""},likeComment:function(t,n){var o=this;return(0,u.default)(r.default.mark((function n(){var u,i;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$http.put("/comments/likeComment/"+t);case 2:u=n.sent,i=u.data,1===i.code?o.getComments():(e.navigateTo({url:"/pages/login/login?index=1"}),e.$showMsg("请先登录后在操作哦！~"));case 5:case"end":return n.stop()}}),n)})))()},handlePublishTimeDesc:function(e){var t=new Date,n=new Date(e),o=t.getTime()-n.getTime(),r=Math.floor(o/6048e5),u=Math.floor(o/864e5),i=Math.floor(o/36e5),a=Math.floor(o/6e4);return r>0?e:u<7&&u>0?u+"天前":i<24&&i>0?i+"小时前":a+"分钟前"},openDelShow:function(e){this.delId=e,this.delShow=!0},delComment:function(){var t=this;return(0,u.default)(r.default.mark((function n(){var o,u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$http.delete("/comments/delComment?commentId="+t.delId);case 2:o=n.sent,u=o.data,1===u.code?(t.getComments(),e.showToast({title:"删除评论成功",icon:"success"}),t.delShow=!1):e.showToast({title:"删除评论失败",icon:"error"});case 5:case"end":return n.stop()}}),n)})))()},queryBlogById:function(){var t=this;return(0,u.default)(r.default.mark((function n(){var o,u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$http.get("/blog/queryBlogById?id="+t.bId);case 2:if(o=n.sent,u=o.data,1!==u.code){n.next=14;break}u.data.isLike?t.selected=0:t.selected=3,t.swiperList=u.data.images.split(","),t.tagList=u.data.tag.split(","),t.liked=u.data.isLike,t.blogUserId=u.data.userId,t.isFollowed(),t.blogData=u.data,n.next=15;break;case 14:return n.abrupt("return",e.$showMsg());case 15:case"end":return n.stop()}}),n)})))()},queryBrowse:function(){var t=this;return(0,u.default)(r.default.mark((function n(){var o,u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.getStorageSync("userId")?t.id=e.getStorageSync("userId"):t.id=0,n.next=3,e.$http.get("/blog/queryBrowse?blogId="+t.bId+"&id="+t.id);case 3:o=n.sent,u=o.data,t.browse=u.data.browse.toString();case 6:case"end":return n.stop()}}),n)})))()},getComments:function(){var t=this;return(0,u.default)(r.default.mark((function n(){var o,u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$http.get("/comments/getComments?foreignId="+t.bId);case 2:if(o=n.sent,u=o.data,1!==u.code){n.next=10;break}t.commentCount=u.data.count.toString(),t.commentsList=u.data.comments,t.commentsList.createTime=t.handlePublishTimeDesc(u.data.comments.createTime),n.next=11;break;case 10:return n.abrupt("return",e.$showMsg());case 11:case"end":return n.stop()}}),n)})))()},goSee:function(t){e.navigateTo({url:"/searchPages/userHome?userId="+t})},goFollow:function(){var t=this;return(0,u.default)(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.getStorageSync("token")){n.next=4;break}return e.navigateTo({url:"/pages/login/login?index=1"}),e.$showMsg("亲，先登录哦~"),n.abrupt("return");case 4:e.$http.put("/follow/"+t.blogUserId+"/"+!t.isFollow).then((function(){e.showToast({title:t.isFollow?"已取消关注":"关注成功"}),t.isFollow=!t.isFollow,t.queryBlogById()}));case 5:case"end":return n.stop()}}),n)})))()},isFollowed:function(){var t=this;return(0,u.default)(r.default.mark((function n(){var o,u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$http.get("/follow/or/not?followUserId="+t.blogUserId);case 2:if(o=n.sent,u=o.data,1!==u.code){n.next=8;break}t.isFollow=u.data,n.next=9;break;case 8:return n.abrupt("return",e.$showMsg());case 9:case"end":return n.stop()}}),n)})))()},goLiked:function(){var t=this;return(0,u.default)(r.default.mark((function n(){var o,u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.getStorageSync("token")){n.next=4;break}return e.navigateTo({url:"/pages/login/login?index=1"}),e.$showMsg("亲，先登录哦~"),n.abrupt("return");case 4:return n.next=6,e.$http.put("/blog/like?id="+t.bId);case 6:o=n.sent,u=o.data,1===u.code?(t.queryBlogById(),e.showToast({title:t.liked?"取消点赞成功~":"点赞成功~",icon:"success",duration:1500})):e.showToast({title:"点赞失败~",icon:"error"});case 9:case"end":return n.stop()}}),n)})))()},reply:function(t,n){if(!e.getStorageSync("token"))return e.navigateTo({url:"/pages/login/login?index=1"}),void e.$showMsg("亲，先登录哦~");this.placeholder="回复 @"+t,this.commentsForm={content:this.comment,foreignId:this.bId,target:t,parentId:n,longitude:this.longitude,latitude:this.latitude},this.show=!0},publishComment:function(){var t=this;return(0,u.default)(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.getStorageSync("token")){n.next=4;break}return e.navigateTo({url:"/pages/login/login?index=1"}),e.$showMsg("亲，先登录哦~"),n.abrupt("return");case 4:t.commentsForm={content:t.comment,foreignId:t.bId,longitude:t.longitude,latitude:t.latitude},t.show=!0;case 6:case"end":return n.stop()}}),n)})))()},saveReply:function(){var t=this;return(0,u.default)(r.default.mark((function n(){var o,u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(""!==t.comment){n.next=3;break}return e.showToast({title:"亲，请输入评论内容~",icon:"error"}),n.abrupt("return");case 3:return t.commentsForm.content=t.comment,n.next=6,e.$http.post("/comments/save",t.commentsForm);case 6:o=n.sent,u=o.data,1===u.code?(e.showToast({title:"回复成功~",icon:"success"}),t.show=!1,t.comment="",t.getComments()):e.$showMsg(u.msg);case 9:case"end":return n.stop()}}),n)})))()},getBlogUserId:function(){var t=this;return(0,u.default)(r.default.mark((function n(){var o,u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$http.get("/blog/getBlogUserId?blogId="+t.bId);case 2:o=n.sent,u=o.data,1===u.code&&(t.uId=u.data.userId);case 5:case"end":return n.stop()}}),n)})))()}},created:function(){var t=this;e.getLocation({type:"wgs84",altitude:!0,success:function(e){t.longitude=e.longitude,t.latitude=e.latitude}})},onLoad:function(t){this.bId=t.blogId,e.startPullDownRefresh(),this.queryBlogById(),this.getComments(),this.getBlogUserId(),this.queryBrowse(),this.loginUserId=e.getStorageSync("userId")},onPullDownRefresh:function(){var t=this;setTimeout((function(){t.queryBlogById(),t.getComments(),t.getBlogUserId(),e.stopPullDownRefresh()}),1200)}};t.default=i}).call(this,n("543d")["default"])},"818a":function(e,t,n){"use strict";(function(e,t){var o=n("4ea4");n("1827");o(n("66fd"));var r=o(n("5441"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(r.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},"8a6a":function(e,t,n){"use strict";n.r(t);var o=n("6e50"),r=n.n(o);for(var u in o)["default"].indexOf(u)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(u);t["default"]=r.a},ae27:function(e,t,n){}},[["818a","common/runtime","common/vendor"]]]);