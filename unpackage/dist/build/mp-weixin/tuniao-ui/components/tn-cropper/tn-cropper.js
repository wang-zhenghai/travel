(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["tuniao-ui/components/tn-cropper/tn-cropper"],{"1c54":function(t,e,i){"use strict";(function(t){var n=i("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=n(i("2eee")),o=n(i("9523")),s=n(i("c973"));function c(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function r(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?c(Object(i),!0).forEach((function(e){(0,o.default)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var h={name:"tn-cropper",props:{imageUrl:{type:String,default:""},height:{type:Number,default:280},width:{type:Number,default:280},isRound:{type:Boolean,default:!1},borderStyle:{type:String,default:"1rpx solid #FFF"},scaleRatio:{type:Number,default:1},quality:{type:Number,default:.8},returnBase64:{type:Boolean,default:!1},rotateAngle:{type:Number,default:0},minScale:{type:Number,default:.5},maxScale:{type:Number,default:2},custom:{type:Boolean,default:!1},startCutting:{type:Boolean,default:!1},loading:{type:Boolean,default:!0},rotateIcon:{type:String,default:"circle-arrow"}},data:function(){return{CANVAS_ID:"tn-cropper-canvas",TIME_CUT_CENTER:null,ctx:null,cutX:0,cutY:0,imgWidth:0,imgHeight:0,imgTop:0,imgLeft:0,scale:1,angle:0,animation:!1,animationTime:null,systemInfo:{},props:"",sizeChange:0,angleChange:0,resetChange:0,centerChange:0}},watch:{imageUrl:function(e){var i=this;this.imageReset(),this.showLoading(),t.getImageInfo({src:e,success:function(t){i.imgComputeSize(t.width,t.height),i.angleChange++,i.props="3,".concat(i.angleChange)},fail:function(t){console.log(t),i.imgComputeSize(),i.angleChange++,i.props="3,".concat(i.angleChange)}})},rotateAngle:function(t){this.animation=!0,this.angle=t,this.angleChanged(t)},animation:function(t){var e=this;clearTimeout(this.animationTime),t&&(this.animationTime=setTimeout((function(){e.animation=!1}),200))},startCutting:function(t){this.custom&&t&&this.getCutImage()}},mounted:function(){var e=this;this.systemInfo=t.getSystemInfoSync(),this.imgTop=this.systemInfo.windowHeight/2,this.imgLeft=this.systemInfo.windowWidth/2,this.ctx=t.createCanvasContext(this.CANVAS_ID,this),this.$nextTick((function(){e.props="1,1"})),setTimeout((function(){e.$emit("ready",{})}),200)},methods:{getLocalImage:function(e){return(0,s.default)(a.default.mark((function i(){return a.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,new Promise((function(i,n){t.downloadFile({url:e,success:function(t){i(t.tempFilePath)},fail:function(t){n(!1)}})}));case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}}),i)})))()},getCutImage:function(){var e=this;if(this.imageUrl){this.loading&&this.showLoading();var i=function(){var i=(0,s.default)(a.default.mark((function i(){var n,o,s,c,h,u,l,g;return a.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=e.imgWidth*e.scale*e.scaleRatio,o=e.imgHeight*e.scale*e.scaleRatio,s=e.imgLeft-e.cutX,c=e.imgTop-e.cutY,h=e.imageUrl,!~e.imageUrl.indexOf("https:")){i.next=9;break}return i.next=8,e.getLocalImage(e.imageUrl);case 8:h=i.sent;case 9:e.ctx.translate(s*e.scaleRatio,c*e.scaleRatio),e.isRound&&(u=e.width>e.height?Math.floor(e.height/2):Math.floor(e.width/2),l=Math.floor(e.width/2),g=Math.floor(e.height/2),e.ctx.beginPath(),e.ctx.arc(l-s*e.scaleRatio,g-c*e.scaleRatio,u,0,360*Math.PI/180),e.ctx.closePath(),e.ctx.stroke(),e.ctx.clip()),e.ctx.rotate(e.angle*Math.PI/180),e.ctx.drawImage(h,-n/2,-o/2,n,o),e.ctx.draw(!1,(function(){var i={width:e.width*e.scaleRatio,height:Math.round(e.height*e.scaleRatio),destWidth:e.width*e.scaleRatio,destHeight:Math.round(e.height)*e.scaleRatio,fileType:"png",quality:e.quality},n={url:"",base64:"",width:e.width*e.scaleRatio,height:e.height*e.scaleRatio},a=e.returnBase64;a?t.canvasGetImageData({canvasId:e.CANVAS_ID,x:0,y:0,width:e.width*e.scaleRatio,height:Math.round(e.height*e.scaleRatio),success:function(i){var a=new Uint8Array(i.data),o=t.arrayBufferToBase64(a);n.base64=o,e.loading&&t.hideLoading(),e.$emit("cropper",n)}},e):t.canvasToTempFilePath(r(r({},i),{},{canvasId:e.CANVAS_ID,success:function(i){n.url=i.tempFilePath,e.loading&&t.hideLoading(),e.$emit("cropper",n)}}),e)}));case 14:case"end":return i.stop()}}),i)})));return function(){return i.apply(this,arguments)}}();i()}else t.showToast({title:"请选择图片",icon:"none"})},change:function(t){this.cutX=t.cutX||0,this.cutY=t.cutY||0,this.imgWidth=t.imgWidth||this.imgWidth,this.imgHeight=t.imgHeight||this.imgHeight,this.scale=t.scale||1,this.angle=t.angle||0,this.imgTop=t.imgTop||0,this.imgLeft=t.imgLeft||0},imageReset:function(){this.scale=1,this.angle=0;var e=this.systemInfo.windowHeight?this.systemInfo:t.getSystemInfoSync();this.imgTop=e.windowHeight/2,this.imgLeft=e.windowWidth/2,this.resetChange++,this.props="4,".concat(this.resetChange),this.$emit("initAngle",{})},imgComputeSize:function(e,i){var n=e,a=i;if(n&&a)n/a>this.width/this.height?(a=this.height,n=e/i*a):(n=this.width,a=i/e*n);else{var o=this.systemInfo.windowHeight?this.systemInfo:t.getSystemInfoSync();n=o.windowWidth,a=0}this.imgWidth=n,this.imgHeight=a,this.sizeChange++,this.props="2,".concat(this.sizeChange)},imageLoad:function(e){this.imageReset(),t.hideLoading(),this.$emit("imageLoad",{})},moveStop:function(){var t=this;clearTimeout(this.TIME_CUT_CENTER),this.TIME_CUT_CENTER=setTimeout((function(){t.centerChange++,t.props="5,".concat(t.centerChange)}),688)},moveDuring:function(){clearTimeout(this.TIME_CUT_CENTER)},showLoading:function(){t.showLoading({title:"请稍等......",mask:!0})},stop:function(){},back:function(){t.navigateBack()},angleChanged:function(t){this.moveStop(),t%90&&(this.angle=90*Math.round(t/90)),this.angleChange++,this.props="3,".concat(this.angleChange)},setAngle:function(){this.animation=!0,this.angle=this.angle+90,this.angleChanged(this.angle)}}};e.default=h}).call(this,i("543d")["default"])},"79f4":function(t,e,i){},"82c8c":function(t,e,i){"use strict";var n=i("79f4"),a=i.n(n);a.a},a393:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){}));var n=function(){var t=this.$createElement;this._self._c},a=[]},c181:function(t,e,i){"use strict";i.r(e);var n=i("1c54"),a=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(o);e["default"]=a.a},caf3:function(t,e,i){"use strict";i.r(e);var n=i("a393"),a=i("c181");for(var o in a)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(o);i("82c8c");var s=i("f0c5"),c=i("e9d6"),r=Object(s["a"])(a["default"],n["b"],n["c"],!1,null,"cf1e90c2",null,!1,n["a"],void 0);"function"===typeof c["a"]&&Object(c["a"])(r),e["default"]=r.exports},e9d6:function(t,e,i){"use strict";e["a"]=function(t){t.options.wxsCallMethods||(t.options.wxsCallMethods=[]),t.options.wxsCallMethods.push("moveDuring"),t.options.wxsCallMethods.push("moveStop"),t.options.wxsCallMethods.push("change")}}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'tuniao-ui/components/tn-cropper/tn-cropper-create-component',
    {
        'tuniao-ui/components/tn-cropper/tn-cropper-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("caf3"))
        })
    },
    [['tuniao-ui/components/tn-cropper/tn-cropper-create-component']]
]);
