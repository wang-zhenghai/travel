(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/message/message"],{2978:function(n,e,t){},"63ef":function(n,e,t){"use strict";t.r(e);var o=t("e623"),r=t.n(o);for(var a in o)["default"].indexOf(a)<0&&function(n){t.d(e,n,(function(){return o[n]}))}(a);e["default"]=r.a},8893:function(n,e,t){"use strict";t.r(e);var o=t("cddf"),r=t("63ef");for(var a in r)["default"].indexOf(a)<0&&function(n){t.d(e,n,(function(){return r[n]}))}(a);t("a849");var i=t("f0c5"),s=Object(i["a"])(r["default"],o["b"],o["c"],!1,null,"4412a61f",null,!1,o["a"],void 0);e["default"]=s.exports},"8be2":function(n,e,t){"use strict";(function(n,e){var o=t("4ea4");t("1827");o(t("66fd"));var r=o(t("8893"));n.__webpack_require_UNI_MP_PLUGIN__=t,e(r.default)}).call(this,t("bc2e")["default"],t("543d")["createPage"])},a849:function(n,e,t){"use strict";var o=t("2978"),r=t.n(o);r.a},cddf:function(n,e,t){"use strict";t.d(e,"b",(function(){return r})),t.d(e,"c",(function(){return a})),t.d(e,"a",(function(){return o}));var o={tnNavBar:function(){return Promise.all([t.e("common/vendor"),t.e("tuniao-ui/components/tn-nav-bar/tn-nav-bar")]).then(t.bind(null,"aa86"))},tnBadge:function(){return Promise.all([t.e("common/vendor"),t.e("tuniao-ui/components/tn-badge/tn-badge")]).then(t.bind(null,"8eb7"))},tnModal:function(){return Promise.all([t.e("common/vendor"),t.e("tuniao-ui/components/tn-modal/tn-modal")]).then(t.bind(null,"ca15"))},tnButton:function(){return Promise.all([t.e("common/vendor"),t.e("tuniao-ui/components/tn-button/tn-button")]).then(t.bind(null,"e6e0"))}},r=function(){var n=this,e=n.$createElement,t=(n._self._c,n.conversations.length),o=t>0?n.__map(n.conversations,(function(e,t){var o=n.__get_orig(e),r=n.formatDate(e.lastMessage.timestamp),a=e.lastMessage.recalled?null:!1===e.lastMessage.read&&e.lastMessage.senderId===n.currentUser.userId.toString(),i=e.lastMessage.recalled?null:n.currentUser.userId.toString(),s=e.lastMessage.recalled?n.currentUser.userId.toString():null;return{$orig:o,m0:r,g1:a,g2:i,g3:s}})):null;n._isMounted||(n.e0=function(e){n.show1=!1},n.e1=function(e){n.actionPopup.visible=!1}),n.$mp.data=Object.assign({},{$root:{g0:t,l0:o}})},a=[]},e623:function(n,e,t){"use strict";(function(n){var o=t("4ea4"),r=t("7037");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(t("9523")),i=function(n,e){if(!e&&n&&n.__esModule)return n;if(null===n||"object"!==r(n)&&"function"!==typeof n)return{default:n};var t=u(e);if(t&&t.has(n))return t.get(n);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in n)if("default"!==i&&Object.prototype.hasOwnProperty.call(n,i)){var s=a?Object.getOwnPropertyDescriptor(n,i):null;s&&(s.get||s.set)?Object.defineProperty(o,i,s):o[i]=n[i]}o.default=n,t&&t.set(n,o);return o}(t("88ff")),s=t("5e97"),c=o(t("1e5d"));function u(n){if("function"!==typeof WeakMap)return null;var e=new WeakMap,t=new WeakMap;return(u=function(n){return n?t:e})(n)}var l=n.$GoEasy,d=n.$GRTC,f={name:"TemplateMessage",mixins:[i.default],data:function(){var e;return e={show1:!1,liked:35,comment:52,system:99,conversations:[],actionPopup:{conversation:null,visible:!1},currentUser:null,username:n.getStorageSync("username"),friendsList:[]},(0,a.default)(e,"conversations",[]),(0,a.default)(e,"toUserList",[]),(0,a.default)(e,"options",[{icon:"star",style:{backgroundColor:"#FFA726",width:"80rpx",height:"80rpx",margin:"0 12rpx",borderRadius:"100rpx"}},{icon:"delete",style:{backgroundColor:"#E83A30",width:"80rpx",height:"80rpx",margin:"0 12rpx",borderRadius:"100rpx"}}]),e},created:function(){n.$currentUser=n.getStorageSync("currentUser"),this.currentUser=n.$currentUser,this.currentUser?("disconnected"===l.getConnectionStatus()&&this.connectGoEasy(),this.loadConversations(),this.initGoEasyListeners()):n.navigateTo({url:"/pages/login/login"})},beforeDestroy:function(){l.im.off(l.IM_EVENT.CONVERSATIONS_UPDATED,this.renderConversations)},methods:{formatDate:s.formatDate,connectGoEasy:function(){l.connect({id:this.currentUser.userId.toString(),data:{name:this.currentUser.username,avatar:this.currentUser.avatar},onSuccess:function(){console.log("GoEasy connect successfully.")},onFailed:function(n){console.log("Failed to connect GoEasy, code:"+n.code+",error:"+n.content)},onProgress:function(n){console.log("GoEasy is connecting",n)}})},initGoEasyListeners:function(){l.im.on(l.IM_EVENT.CONVERSATIONS_UPDATED,this.renderConversations),l.im.on(l.IM_EVENT.CONVERSATIONS_UPDATED,this.setUnreadAmount)},onRing:function(){var e=d.currentCall();e.groupId?n.navigateTo({url:"./rtc/group/ring"}):n.navigateTo({url:"./rtc/private/ring"})},loadConversations:function(){var e=this;l.im.latestConversations({onSuccess:function(t){n.hideLoading();var o=t.content;e.renderConversations(o),e.setUnreadAmount(o)},onFailed:function(e){n.hideLoading(),console.log("获取最新会话列表失败, error:",e)}})},renderConversations:function(n){this.conversations=n.conversations},setUnreadAmount:function(e){var t=e.unreadTotal;t>0?n.setTabBarBadge({index:0,text:t.toString()}):n.removeTabBarBadge({index:0})},subscribeGroup:function(){var n=c.default.findGroups(this.currentUser),e=n.map((function(n){return n.id}));l.im.subscribeGroup({groupIds:e,onSuccess:function(){console.log("订阅群消息成功")},onFailed:function(n){console.log("订阅群消息失败:",n)}})},topConversation:function(){this.actionPopup.visible=!1;var e=this.actionPopup.conversation,t=e.top?"取消置顶":"置顶";l.im.topConversation({conversation:e,top:!e.top,onSuccess:function(){n.showToast({title:t+"成功",icon:"none"})},onFailed:function(n){console.log(t,"失败：",n)}})},deleteConversation:function(){var e=this;n.showModal({content:"确认删除这条会话吗？",success:function(n){if(n.confirm){var t=e.actionPopup.conversation;e.actionPopup.visible=!1,l.im.removeConversation({conversation:t,onSuccess:function(){console.log("删除会话成功")},onFailed:function(n){console.log(n)}})}else e.actionPopup.visible=!1}})},chat:function(e){var t=e.type===l.IM_SCENE.PRIVATE?"/messagePages/privateChat?to="+e.userId+"&username="+e.data.name+"&avatar="+e.data.avatar:"/messagePages/groupChat?to="+e.groupId;n.navigateTo({url:t})},showAction:function(n){this.actionPopup.conversation=n,this.actionPopup.visible=!0}}};e.default=f}).call(this,t("543d")["default"])}},[["8be2","common/runtime","common/vendor"]]]);