(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index"],{"0672":function(n,e,t){"use strict";t.r(e);var o=t("cc8c"),a=t("bf07");for(var r in a)["default"].indexOf(r)<0&&function(n){t.d(e,n,(function(){return a[n]}))}(r);var i=t("f0c5"),c=Object(i["a"])(a["default"],o["b"],o["c"],!1,null,"1a6fb23d",null,!1,o["a"],void 0);e["default"]=c.exports},"13e8":function(n,e,t){},2264:function(n,e,t){"use strict";t.r(e);var o=t("7fab"),a=t.n(o);for(var r in o)["default"].indexOf(r)<0&&function(n){t.d(e,n,(function(){return o[n]}))}(r);e["default"]=a.a},"289c":function(n,e,t){"use strict";var o=t("13e8"),a=t.n(o);a.a},2978:function(n,e,t){},"40fc":function(n,e,t){"use strict";(function(n,e){var o=t("4ea4");t("1827");o(t("66fd"));var a=o(t("0672"));n.__webpack_require_UNI_MP_PLUGIN__=t,e(a.default)}).call(this,t("bc2e")["default"],t("543d")["createPage"])},"56d8":function(n,e,t){"use strict";(function(n){var o=t("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(t("8893")),r=o(t("5f03")),i={components:{Home:function(){Promise.all([t.e("common/vendor"),t.e("pages/home/home")]).then(function(){return resolve(t("c0e6"))}.bind(null,t)).catch(t.oe)},CirclePage:function(){t.e("pages/circle/circle").then(function(){return resolve(t("a044"))}.bind(null,t)).catch(t.oe)},Message:a.default,Mine:function(){t.e("pages/mine/mine").then(function(){return resolve(t("6fbe"))}.bind(null,t)).catch(t.oe)},Preferred:r.default},data:function(){return{hiddenTabbarStatus:!0,tabbarList:[{title:"首页",activeIcon:"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/eee705da-cfa4-46e9-99fd-196735f49752.png",inactiveIcon:"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/d4fd713a-1a7b-45c3-b457-a9e2f6e7c0bb.png"},{title:"圈子",activeIcon:"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/a7c61afa-78f8-47d4-8dc5-cbc7bf2225ab.png",inactiveIcon:"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/7baa0814-e60c-4111-9068-7eb55996bc1d.png"},{title:"消息",activeIcon:"menu-circle",inactiveIcon:"message",activeIconColor:"#FFFFFF",inactiveIconColor:"#FFFFFF",iconSize:50,out:!0},{title:"周边",activeIcon:"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/d93f1343-aa6a-4571-9c00-185af2c285b3.png",inactiveIcon:"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/22c5e20b-f176-4963-989a-10bf2537eb3a.png"},{title:"我的",activeIcon:"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/891bd57c-b3bc-4bd1-b434-24af869dbaee.png",inactiveIcon:"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/df820914-cd79-426e-aca6-ecf9d0209c71.png"}],currentIndex:0,tabberPageLoadFlag:[],index:""}},onLoad:function(n){var e=Number(n.index||0);this.tabberPageLoadFlag=this.tabbarList.map((function(n,t){return e===t})),this.switchTabbar(e)},methods:{hiddenTabbar:function(){this.hiddenTabbarStatus=!1},showTabbar:function(){this.hiddenTabbarStatus=!0},switchTabbar:function(e){var t,o,a=this;(this._switchTabbarPage(e),2!==e)&&(null===(t=this.$refs)||void 0===t||null===(o=t.circleRef)||void 0===o||o.stopAllVideo());if(2===e&&this.$refs.message.connectGoEasy(),1===e&&this.$nextTick((function(){a.$refs.circleRef.getBlogList()&&a.$refs.circleRef.getHotCity()})),3===e&&this.$nextTick((function(){a.$refs.preferredRef.getGoodsList()})),0===e&&this.$nextTick((function(){a.$refs.home.getBlogList()&&a.$refs.home.getRecommendUp()})),4===e){if(!n.getStorageSync("token"))return void n.redirectTo({url:"/pages/login/login"});this.$nextTick((function(){a.$refs.mine.queryUserById()&&a.$refs.mine.getUserInfoById()}))}},tabbarPageScrollLower:function(n){this.currentIndex},_switchTabbarPage:function(n){var e=this.tabberPageLoadFlag[n];void 0!==e&&(!1===e&&(this.tabberPageLoadFlag[n]=!0),this.currentIndex=n)}}};e.default=i}).call(this,t("543d")["default"])},"5f03":function(n,e,t){"use strict";t.r(e);var o=t("9ece"),a=t("2264");for(var r in a)["default"].indexOf(r)<0&&function(n){t.d(e,n,(function(){return a[n]}))}(r);t("289c");var i=t("f0c5"),c=Object(i["a"])(a["default"],o["b"],o["c"],!1,null,"341ff1b2",null,!1,o["a"],void 0);e["default"]=c.exports},"63ef":function(n,e,t){"use strict";t.r(e);var o=t("e623"),a=t.n(o);for(var r in o)["default"].indexOf(r)<0&&function(n){t.d(e,n,(function(){return o[n]}))}(r);e["default"]=a.a},"7fab":function(n,e,t){"use strict";(function(n){var o=t("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(t("2eee")),r=o(t("c973")),i={name:"Preferred",data:function(){return{content:[]}},created:function(){this.getGoodsList()},methods:{tn:function(e){n.navigateTo({url:e})},getGoodsList:function(){var e=this;return(0,r.default)(a.default.mark((function t(){var o,r;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.$http.get("/goods/getGoodsList");case 2:o=t.sent,r=o.data,1===r.code&&(e.content=r.data);case 5:case"end":return t.stop()}}),t)})))()}}};e.default=i}).call(this,t("543d")["default"])},8893:function(n,e,t){"use strict";t.r(e);var o=t("cddf"),a=t("63ef");for(var r in a)["default"].indexOf(r)<0&&function(n){t.d(e,n,(function(){return a[n]}))}(r);t("a849");var i=t("f0c5"),c=Object(i["a"])(a["default"],o["b"],o["c"],!1,null,"4412a61f",null,!1,o["a"],void 0);e["default"]=c.exports},"9ece":function(n,e,t){"use strict";t.d(e,"b",(function(){return a})),t.d(e,"c",(function(){return r})),t.d(e,"a",(function(){return o}));var o={tnNavBar:function(){return Promise.all([t.e("common/vendor"),t.e("tuniao-ui/components/tn-nav-bar/tn-nav-bar")]).then(t.bind(null,"aa86"))}},a=function(){var n=this.$createElement;this._self._c},r=[]},a849:function(n,e,t){"use strict";var o=t("2978"),a=t.n(o);a.a},bf07:function(n,e,t){"use strict";t.r(e);var o=t("56d8"),a=t.n(o);for(var r in o)["default"].indexOf(r)<0&&function(n){t.d(e,n,(function(){return o[n]}))}(r);e["default"]=a.a},cc8c:function(n,e,t){"use strict";t.d(e,"b",(function(){return a})),t.d(e,"c",(function(){return r})),t.d(e,"a",(function(){return o}));var o={tnTabbar:function(){return t.e("tuniao-ui/components/tn-tabbar/tn-tabbar").then(t.bind(null,"06c9"))}},a=function(){var n=this.$createElement;this._self._c},r=[]},cddf:function(n,e,t){"use strict";t.d(e,"b",(function(){return a})),t.d(e,"c",(function(){return r})),t.d(e,"a",(function(){return o}));var o={tnNavBar:function(){return Promise.all([t.e("common/vendor"),t.e("tuniao-ui/components/tn-nav-bar/tn-nav-bar")]).then(t.bind(null,"aa86"))},tnBadge:function(){return Promise.all([t.e("common/vendor"),t.e("tuniao-ui/components/tn-badge/tn-badge")]).then(t.bind(null,"8eb7"))},tnModal:function(){return Promise.all([t.e("common/vendor"),t.e("tuniao-ui/components/tn-modal/tn-modal")]).then(t.bind(null,"ca15"))},tnButton:function(){return Promise.all([t.e("common/vendor"),t.e("tuniao-ui/components/tn-button/tn-button")]).then(t.bind(null,"e6e0"))}},a=function(){var n=this,e=n.$createElement,t=(n._self._c,n.conversations.length),o=t>0?n.__map(n.conversations,(function(e,t){var o=n.__get_orig(e),a=n.formatDate(e.lastMessage.timestamp),r=e.lastMessage.recalled?null:!1===e.lastMessage.read&&e.lastMessage.senderId===n.currentUser.userId.toString(),i=e.lastMessage.recalled?null:n.currentUser.userId.toString(),c=e.lastMessage.recalled?n.currentUser.userId.toString():null;return{$orig:o,m0:a,g1:r,g2:i,g3:c}})):null;n._isMounted||(n.e0=function(e){n.show1=!1},n.e1=function(e){n.actionPopup.visible=!1}),n.$mp.data=Object.assign({},{$root:{g0:t,l0:o}})},r=[]},e623:function(n,e,t){"use strict";(function(n){var o=t("4ea4"),a=t("7037");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=o(t("9523")),i=function(n,e){if(!e&&n&&n.__esModule)return n;if(null===n||"object"!==a(n)&&"function"!==typeof n)return{default:n};var t=u(e);if(t&&t.has(n))return t.get(n);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in n)if("default"!==i&&Object.prototype.hasOwnProperty.call(n,i)){var c=r?Object.getOwnPropertyDescriptor(n,i):null;c&&(c.get||c.set)?Object.defineProperty(o,i,c):o[i]=n[i]}o.default=n,t&&t.set(n,o);return o}(t("88ff")),c=t("5e97"),s=o(t("1e5d"));function u(n){if("function"!==typeof WeakMap)return null;var e=new WeakMap,t=new WeakMap;return(u=function(n){return n?t:e})(n)}var f=n.$GoEasy,l=n.$GRTC,d={name:"TemplateMessage",mixins:[i.default],data:function(){var e;return e={show1:!1,liked:35,comment:52,system:99,conversations:[],actionPopup:{conversation:null,visible:!1},currentUser:null,username:n.getStorageSync("username"),friendsList:[]},(0,r.default)(e,"conversations",[]),(0,r.default)(e,"toUserList",[]),(0,r.default)(e,"options",[{icon:"star",style:{backgroundColor:"#FFA726",width:"80rpx",height:"80rpx",margin:"0 12rpx",borderRadius:"100rpx"}},{icon:"delete",style:{backgroundColor:"#E83A30",width:"80rpx",height:"80rpx",margin:"0 12rpx",borderRadius:"100rpx"}}]),e},created:function(){n.$currentUser=n.getStorageSync("currentUser"),this.currentUser=n.$currentUser,this.currentUser?("disconnected"===f.getConnectionStatus()&&this.connectGoEasy(),this.loadConversations(),this.initGoEasyListeners()):n.navigateTo({url:"/pages/login/login"})},beforeDestroy:function(){f.im.off(f.IM_EVENT.CONVERSATIONS_UPDATED,this.renderConversations)},methods:{formatDate:c.formatDate,connectGoEasy:function(){f.connect({id:this.currentUser.userId.toString(),data:{name:this.currentUser.username,avatar:this.currentUser.avatar},onSuccess:function(){console.log("GoEasy connect successfully.")},onFailed:function(n){console.log("Failed to connect GoEasy, code:"+n.code+",error:"+n.content)},onProgress:function(n){console.log("GoEasy is connecting",n)}})},initGoEasyListeners:function(){f.im.on(f.IM_EVENT.CONVERSATIONS_UPDATED,this.renderConversations),f.im.on(f.IM_EVENT.CONVERSATIONS_UPDATED,this.setUnreadAmount)},onRing:function(){var e=l.currentCall();e.groupId?n.navigateTo({url:"./rtc/group/ring"}):n.navigateTo({url:"./rtc/private/ring"})},loadConversations:function(){var e=this;f.im.latestConversations({onSuccess:function(t){n.hideLoading();var o=t.content;e.renderConversations(o),e.setUnreadAmount(o)},onFailed:function(e){n.hideLoading(),console.log("获取最新会话列表失败, error:",e)}})},renderConversations:function(n){this.conversations=n.conversations},setUnreadAmount:function(e){var t=e.unreadTotal;t>0?n.setTabBarBadge({index:0,text:t.toString()}):n.removeTabBarBadge({index:0})},subscribeGroup:function(){var n=s.default.findGroups(this.currentUser),e=n.map((function(n){return n.id}));f.im.subscribeGroup({groupIds:e,onSuccess:function(){console.log("订阅群消息成功")},onFailed:function(n){console.log("订阅群消息失败:",n)}})},topConversation:function(){this.actionPopup.visible=!1;var e=this.actionPopup.conversation,t=e.top?"取消置顶":"置顶";f.im.topConversation({conversation:e,top:!e.top,onSuccess:function(){n.showToast({title:t+"成功",icon:"none"})},onFailed:function(n){console.log(t,"失败：",n)}})},deleteConversation:function(){var e=this;n.showModal({content:"确认删除这条会话吗？",success:function(n){if(n.confirm){var t=e.actionPopup.conversation;e.actionPopup.visible=!1,f.im.removeConversation({conversation:t,onSuccess:function(){console.log("删除会话成功")},onFailed:function(n){console.log(n)}})}else e.actionPopup.visible=!1}})},chat:function(e){var t=e.type===f.IM_SCENE.PRIVATE?"/messagePages/privateChat?to="+e.userId+"&username="+e.data.name+"&avatar="+e.data.avatar:"/messagePages/groupChat?to="+e.groupId;n.navigateTo({url:t})},showAction:function(n){this.actionPopup.conversation=n,this.actionPopup.visible=!0}}};e.default=d}).call(this,t("543d")["default"])}},[["40fc","common/runtime","common/vendor"]]]);