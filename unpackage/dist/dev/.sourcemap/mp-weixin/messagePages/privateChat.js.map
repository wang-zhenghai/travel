{"version":3,"sources":["uni-app:///main.js","webpack:///E:/uniapp项目/travel-demo/messagePages/privateChat.vue?84f7","webpack:///E:/uniapp项目/travel-demo/messagePages/privateChat.vue?a0d5","webpack:///E:/uniapp项目/travel-demo/messagePages/privateChat.vue?a5a7","webpack:///E:/uniapp项目/travel-demo/messagePages/privateChat.vue?d4bf","uni-app:///messagePages/privateChat.vue","webpack:///E:/uniapp项目/travel-demo/messagePages/privateChat.vue?ed42","webpack:///E:/uniapp项目/travel-demo/messagePages/privateChat.vue?e633"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","name","data","text","friend","id","avatar","to","currentUser","emoji","url","map","visible","decoder","otherTypesMessagePanelVisible","orderList","orders","history","messages","allLoaded","loading","recorderManager","audio","audioPlayer","innerAudioContext","playingMessage","videoPlayer","context","actionPopup","message","recallable","messageSelector","onLoad","type","onShow","onReady","uni","title","onPullDownRefresh","onUnload","GoEasy","methods","cancle","renderTextMessage","renderMessageDate","initGoEasyListeners","onMessageReceived","onMessageDeleted","deletedMessages","initialAudioPlayer","initRecorderListeners","icon","duration","file","notification","body","sound","badge","onProgress","console","onSuccess","onFailed","getImageHeight","sendMessage","sendTextMessage","sendVideoMessage","success","sendImageMessage","count","res","showActionPopup","hideActionPopup","deleteSingleMessage","content","deleteMultipleMessages","deleteMessage","recallMessage","editRecalledMessage","showCheckBox","selectMessages","selectedMessages","loadHistoryMessage","lastMessageTimeStamp","lastTimestamp","limit","switchAudioKeyboard","onRecordStart","onRecordEnd","showImageFullScreen","urls","playVideo","direction","playAudio","onVideoFullScreenChange","messageInputFocusin","switchEmojiKeyboard","showOtherTypesMessagePanel","chooseEmoji","privateCall","scrollToBottom","scrollTop","markPrivateMessageAsRead"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,oBAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAwH;AACxH;AAC+D;AACL;AACa;;;AAGvE;AACsK;AACtK,gBAAgB,6KAAU;AAC1B,EAAE,iFAAM;AACR,EAAE,sFAAM;AACR,EAAE,+FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,0FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,iSAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AChHA;AAAA;AAAA;AAAA;AAAunB,CAAgB,qnBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;ACkL3oB;AACA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;AACA;AACA;AACA;AAAA,eACA;EACAC;EACAC;IACA;IACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IACA;MACA;MACAC;MACAC;QACAC;QACAJ;QACAK;MACA;MACAC;MAAA;MACAC;MAEA;MACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACA;MACAC;MACAC;QACAC;QACAJ;MACA;MACAK;QACAC;QACAC;QACAC;MACA;MACAC;MACAC;QACA;QACAV;MACA;MACAW;QACAC;QACAC;MACA;MACAC;QACAd;QACAF;QACAiB;MACA;MACA;MACAC;QACAhB;QACAiB;QACAC;MACA;MACA;MACAC;QACAnB;QACAM;MACA;IACA;EACA;EACAc;IACA;IACA;IACA;IACA;IACA;IACA;MACA3B;MACA4B;MACA/B;QACAD;QACAK;MACA;IACA;IACA;IACA;IACA;IACA;IACA;EACA;EACA4B;IACA;IACA;EACA;EACAC;IACA;IACA;IACAC;MACAC;IACA;EACA;EACAC;IACA;EACA;EACAC;IACA;IACAC;IACAA;EACA;EACAC;IACAC;MACAN;IACA;IACA;IACAO;MACA;IACA;IACA;IACAC;MACA;QACA;MACA;QACA;UACA;QACA;MACA;MACA;IACA;IACAC;MACA;MACAL;MACA;MACAA;IACA;IACAM;MACA;MACA;MACA;MACA;QACA;QACA;QACA;QACA;QACA;QACAV;MACA;IACA;IACAW;MAAA;MACAC;QACA;QACA;QACA;QACA;UACA;UACA;YACA;UACA;QACA;MACA;IACA;IACAC;MAAA;MACA;MACA;QACA;MACA;MACA;QACA;MACA;IACA;IACAC;MAAA;MACA7B;QACA;UACAe;YACAe;YACAd;YACAe;UACA;UACA;QACA;QACAZ;UACAjC;UACA8C;UACAC;YACAjB;YACAkB;YAAA;YACAC;YACAC;UACA;UACAC;YACAC;UACA;UACAC;YACA;UACA;UACAC;YACAF;UACA;QACA;MACA;IACA;IACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACAG;MACA;QACA;MACA;QACA;MACA;QACA;MACA;IACA;IACAC;MACA;MACA;MACAvB;QACAX;QACA+B;UACAD;QACA;QACAE;UACA;YACAF,YACA,oFACA;UACA;YACAA;UACA;QACA;MACA;IACA;IACAK;MAAA;MACA;QACA;QACA;UACAT;QACA;QACAf;UACArC;UACAI;UACA+C;YACAjB;YACAkB;YACAC;YACAC;UACA;UACAG;YACA;UACA;UACAC;YACAF;UACA;QACA;MACA;MACA;IACA;IACAM;MAAA;MACA7B;QACA8B;UACA1B;YACAjC;YACA8C;YACAC;cACAjB;cACAkB;cAAA;cACAC;cACAC;YACA;YACAC;cACAC;YACA;YACAC;cACA;cACA;YACA;YACAC;cACAF;YACA;UACA;QACA;MACA;IACA;IACAQ;MAAA;MACA/B;QACAgC;QACAF;UACAG;YACA7B;cACAjC;cACA8C;cACAC;gBACAjB;gBACAkB;gBAAA;gBACAC;gBACAC;cACA;cACAC;gBACAC;cACA;cACAC;gBACA;gBACA;cACA;cACAC;gBACAF;cACA;YACA;UACA;QACA;MACA;IACA;IACAW;MACA;MACA;MACA,kGACAjE,MACAwB;QACA;MACA;QACA;MACA;MACA;IACA;IACA0C;MACA;MACA;IACA;IACAC;MAAA;MACApC;QACAqC;QACAP;UACA;UACA;YACA;UACA;QACA;MACA;IACA;IACAQ;MAAA;MACA;QACAtC;UACAqC;UACAP;YACA;YACA;cACA;YACA;UACA;QACA;MACA;IACA;IACAS;MAAA;MACAnC;QACAtB;QACA0C;UACA;YACA;YACA;cACA;YACA;UACA;UACA;QACA;QACAC;UACAF;QACA;MACA;IACA;IACAiB;MACA;MACApC;QACAtB;QACA0C;UACAD;QACA;QACAE;UACAF;QACA;MACA;IACA;IACAkB;MACA;QACA;MACA;MACA;IACA;IACAC;MACA;MACA;MACA;IACA;IACAC;MACA;MACA;MACA;QACA;UACAC;QACA;MACA;MACA;IACA;IACAC;MAAA;MAAA;MACA;MACA;MACA;MACA;QACAC;MACA;MACA1C;QACAnC;QACA8E;QACAC;QACAxB;UACAxB;UACA;UACA;UACA;YACA;UACA;YACA;cACA;YACA;cACA;YACA;YACA;cACA;YACA;YACA;cACA;cACA;cACA;YACA;UACA;QACA;QACAyB;UACA;UACAF;UACAvB;UACA;QACA;MACA;IACA;IACA;IACAiD;MACA;MACA;QACAhE;UACAsC;QACA;UACAA;UACAvB;YACAC;YACAoC;UACA;QACA;MACA;IACA;IACAa;MACAjE;IACA;IACAkE;MACAlE;IACA;IACAmE;MACA;MACApD;QACAqD;MACA;IACA;IACAC;MAAA;MACA;MACA;MACA;QACA;UACAC;QACA;QACA;MACA;IACA;IACAC;MACA;MAEA;QACA;QACA;QACA;UACA;QACA;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;MACA;QACA;QACA;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA9D;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IACA+D;MACA;QACA/D;UACAgE;UACAhD;QACA;MACA;IACA;IACAiD;MACA7D;QACAnC;QACA4B;QACA2B;UACAD;QACA;QACAE;UACAF;QACA;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;ACr4BA;AAAA;AAAA;AAAA;AAAg5B,CAAgB,02BAAG,EAAC,C;;;;;;;;;;;ACAp6B;AACA,OAAO,KAAU,EAAE,kBAKd","file":"messagePages/privateChat.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './messagePages/privateChat.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./privateChat.vue?vue&type=template&id=2032dd77&\"\nvar renderjs\nimport script from \"./privateChat.vue?vue&type=script&lang=js&\"\nexport * from \"./privateChat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./privateChat.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"messagePages/privateChat.vue\"\nexport default component.exports","export * from \"-!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./privateChat.vue?vue&type=template&id=2032dd77&\"","var components\ntry {\n  components = {\n    \"u-Image\": function () {\n      return import(\n        /* webpackChunkName: \"node-modules/uview-ui/components/u--image/u--image\" */ \"uview-ui/components/u--image/u--image.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.history.messages, function (message, index) {\n    var $orig = _vm.__get_orig(message)\n    var m0 = _vm.renderMessageDate(message, index)\n    var g0 = message.recalled ? _vm.currentUser.userId.toString() : null\n    var g1 =\n      message.recalled && message.recaller.id === g0\n        ? message.type === \"text\" && Date.now() - message.timestamp < 60 * 1000\n        : null\n    var g2 = !message.recalled\n      ? _vm.messageSelector.messages.includes(message)\n      : null\n    var g3 = !message.recalled ? _vm.currentUser.userId.toString() : null\n    var g4 = !message.recalled ? _vm.currentUser.userId.toString() : null\n    var g5 =\n      !message.recalled && message.type === \"text\"\n        ? _vm.currentUser.userId.toString()\n        : null\n    var m1 =\n      !message.recalled && message.type === \"text\"\n        ? _vm.renderTextMessage(message)\n        : null\n    var m2 =\n      !message.recalled && message.type === \"video\"\n        ? _vm.getImageHeight(\n            message.payload.thumbnail.width,\n            message.payload.thumbnail.height\n          )\n        : null\n    var g6 =\n      !message.recalled && message.type === \"file\"\n        ? (message.payload.size / 1024).toFixed(2)\n        : null\n    var g7 =\n      !message.recalled && message.type === \"audio\"\n        ? Math.ceil(message.payload.duration)\n        : null\n    var g8 =\n      !message.recalled && message.type === \"audio\"\n        ? Math.ceil(message.payload.duration) || 1\n        : null\n    var g9 = !message.recalled ? _vm.currentUser.userId.toString() : null\n    return {\n      $orig: $orig,\n      m0: m0,\n      g0: g0,\n      g1: g1,\n      g2: g2,\n      g3: g3,\n      g4: g4,\n      g5: g5,\n      m1: m1,\n      m2: m2,\n      g6: g6,\n      g7: g7,\n      g8: g8,\n      g9: g9,\n    }\n  })\n  var l1 =\n    !_vm.videoPlayer.visible &&\n    !_vm.messageSelector.visible &&\n    _vm.emoji.visible\n      ? _vm.__map(_vm.emoji.map, function (emojiItem, emojiKey, index) {\n          var $orig = _vm.__get_orig(emojiItem)\n          return {\n            $orig: $orig,\n            $index: index,\n          }\n        })\n      : null\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0,\n        l1: l1,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./privateChat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./privateChat.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<view class=\"chatInterface\" @contextmenu.prevent=\"\">\r\n\t\t\t<scroll-view scroll-y>\r\n\t\t\t\t<view class=\"scroll-view\">\r\n\t\t\t\t\t<image v-if=\"history.loading\" class=\"history-loaded\"\r\n\t\t\t\t\t\tsrc=\"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/a20764d7-3552-44f9-b046-b4edefa689a5.svg\" />\r\n\t\t\t\t\t<view v-else :class=\"history.allLoaded ? 'history-loaded':'load'\"\r\n\t\t\t\t\t\t@click=\"loadHistoryMessage(false)\">\r\n\t\t\t\t\t\t<view>{{ history.allLoaded ? '' : '点击获取历史消息' }}</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<checkbox-group @change=\"selectMessages\">\r\n\t\t\t\t\t\t<!--消息记录-->\r\n\t\t\t\t\t\t<view v-for=\"(message,index) in history.messages\" :key=\"message.messageId\">\r\n\t\t\t\t\t\t\t<!--时间显示，类似于微信，隔5分钟不发言，才显示时间-->\r\n\t\t\t\t\t\t\t<view class=\"time-lag\">\r\n\t\t\t\t\t\t\t\t{{ renderMessageDate(message, index) }}\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"message-recalled\" v-if=\"message.recalled\">\r\n\t\t\t\t\t\t\t\t<view v-if=\"message.recaller.id === currentUser.userId.toString()\"\r\n\t\t\t\t\t\t\t\t\tclass=\"message-recalled-self\">\r\n\t\t\t\t\t\t\t\t\t<view>你撤回了一条消息</view>\r\n\t\t\t\t\t\t\t\t\t<span v-if=\"message.type === 'text' && Date.now()-message.timestamp< 60 * 1000 \"\r\n\t\t\t\t\t\t\t\t\t\t@click=\"editRecalledMessage(message.payload.text)\">重新编辑</span>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<view v-else>{{ message.recaller.data.name }}撤回了一条消息</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"message-item\" v-else>\r\n\t\t\t\t\t\t\t\t<view class=\"message-item-checkbox\">\r\n\t\t\t\t\t\t\t\t\t<checkbox v-show=\"messageSelector.visible && message.status !== 'sending'\"\r\n\t\t\t\t\t\t\t\t\t\t:value=\"message.messageId\"\r\n\t\t\t\t\t\t\t\t\t\t:checked=\"messageSelector.messages.includes(message)\" />\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<view class=\"message-item-content\"\r\n\t\t\t\t\t\t\t\t\t:class=\"{'self' : message.senderId ===  currentUser.userId.toString()}\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"avatar\">\r\n\t\t\t\t\t\t\t\t\t\t<image\r\n\t\t\t\t\t\t\t\t\t\t\t:src=\"message.senderId === currentUser.userId.toString()? currentUser.avatar : friend.avatar\">\r\n\t\t\t\t\t\t\t\t\t\t</image>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"content\" @click.right=\"showActionPopup(message)\"\r\n\t\t\t\t\t\t\t\t\t\t@longpress=\"showActionPopup(message)\">\r\n\t\t\t\t\t\t\t\t\t\t<view class=\"message-payload\">\r\n\t\t\t\t\t\t\t\t\t\t\t<b class=\"pending\" v-if=\"message.status === 'sending'\"></b>\r\n\t\t\t\t\t\t\t\t\t\t\t<b class=\"send-fail\" v-if=\"message.status === 'fail'\"></b>\r\n\t\t\t\t\t\t\t\t\t\t\t<view v-if=\"message.type === 'text'\" class=\"text-content\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tv-html=\"renderTextMessage(message)\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t:style=\"{background:message.senderId ===  currentUser.userId.toString()?'#b2d235':'#fff'}\">\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t<image v-if=\"message.type === 'image'\" :data-url=\"message.payload.url\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t:src=\"message.payload.thumbnail\" class=\"image-content\" mode=\"heightFix\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t@click=\"showImageFullScreen\"></image>\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"video-snapshot\" v-if=\"message.type === 'video'\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t:data-url=\"message.payload.video.url\" @click=\"playVideo\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<image :src=\"message.payload.thumbnail.url\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t:style=\"{height: getImageHeight(message.payload.thumbnail.width,message.payload.thumbnail.height)+'rpx' }\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tmode=\"heightFix\"></image>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<view class=\"video-play-icon\"></view>\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"file-content\" v-if=\"message.type === 'file'\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<view class=\"file-info\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"file-name\">{{ message.payload.name }}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"file-size\">{{ (message.payload.size / 1024).toFixed(2) }}KB</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<image class=\"file-img\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsrc=\"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/3bc4d574-ee5a-4b5f-adce-e517600884f6.png\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t</image>\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t<view v-if=\"message.type ==='audio'\" class=\"audio-content\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t@click=\"playAudio(message)\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<view class=\"audio-facade\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t:style=\"{width:Math.ceil(message.payload.duration)*7 + 50 + 'px'}\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<view class=\"audio-facade-bg\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t:class=\"{'play-icon':audioPlayer.playingMessage && audioPlayer.playingMessage.messageId === message.messageId}\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<view>{{Math.ceil(message.payload.duration) || 1}}<span>\"</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t<view v-if=\"message.senderId === currentUser.userId.toString()\"\r\n\t\t\t\t\t\t\t\t\t\t\t:class=\"message.read ?'message-read':'message-unread'\">\r\n\t\t\t\t\t\t\t\t\t\t\t<view v-if=\"message.status === 'success'\" style=\"font-size: 24rpx;\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t{{ message.read ? '已读' : '未读' }}\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</checkbox-group>\r\n\t\t\t\t</view>\r\n\t\t\t</scroll-view>\r\n\t\t\t<view class=\"action-box\" v-if=\"!videoPlayer.visible && !messageSelector.visible\">\r\n\t\t\t\t<view class=\"action-top\">\r\n\t\t\t\t\t<view @click=\"switchAudioKeyboard\">\r\n\t\t\t\t\t\t<image class=\"more\" v-if=\"audio.visible\"\r\n\t\t\t\t\t\t\tsrc=\"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/0a3d0722-0088-4183-963f-d67c1e854ea0.png\">\r\n\t\t\t\t\t\t</image>\r\n\t\t\t\t\t\t<image class=\"more\" v-else\r\n\t\t\t\t\t\t\tsrc=\"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/0e6e759e-58ea-4f55-9af8-361b71febefd.png\">\r\n\t\t\t\t\t\t</image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view v-if=\"audio.visible\" class=\"record-input\" @touchend.stop=\"onRecordEnd\"\r\n\t\t\t\t\t\t@touchstart.stop=\"onRecordStart\">\r\n\t\t\t\t\t\t{{ recorderManager.recording ? '松开发送' : '按住录音' }}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<input v-else v-model=\"text\" @confirm=\"sendTextMessage\" class=\"consult-input\" maxlength=\"700\"\r\n\t\t\t\t\t\tplaceholder=\"发送消息\" type=\"text\" />\r\n\t\t\t\t\t<view @click=\"switchEmojiKeyboard\">\r\n\t\t\t\t\t\t<image class=\"more\" v-if=\"emoji.visible\"\r\n\t\t\t\t\t\t\tsrc=\"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/0a3d0722-0088-4183-963f-d67c1e854ea0.png\">\r\n\t\t\t\t\t\t</image>\r\n\t\t\t\t\t\t<image class=\"more\" v-else\r\n\t\t\t\t\t\t\tsrc=\"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/29da9893-822a-4c2c-9c61-d584f46a76d0.png\">\r\n\t\t\t\t\t\t</image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view>\r\n\t\t\t\t\t\t<image @click=\"showOtherTypesMessagePanel()\" class=\"more\"\r\n\t\t\t\t\t\t\tsrc=\"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/37c2a7b6-d727-4127-9653-dffc77091d70.png\" />\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view v-if=\"text\" class=\"send-btn-box\">\r\n\t\t\t\t\t\t<text class=\"btn\" @click=\"sendTextMessage()\">发送</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<!--展示表情列表-->\r\n\t\t\t\t<scroll-view scroll-y>\r\n\t\t\t\t\t<view class=\"action-bottom action-bottom-emoji\" v-if=\"emoji.visible\">\r\n\t\t\t\t\t\t<image class=\"emoji-item\" v-for=\"(emojiItem, emojiKey, index) in emoji.map\" :key=\"index\"\r\n\t\t\t\t\t\t\t:src=\"emoji.url + emojiItem\" @click=\"chooseEmoji(emojiKey)\"></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view style=\"margin-bottom: 30rpx;\"></view>\r\n\t\t\t\t</scroll-view>\r\n\t\t\t\t<!--其他类型消息面板-->\r\n\t\t\t\t<view v-if=\"otherTypesMessagePanelVisible\" class=\"action-bottom\">\r\n\t\t\t\t\t<view class=\"more-icon\" @click=\"sendImageMessage()\">\r\n\t\t\t\t\t\t<u--image\r\n\t\t\t\t\t\t\tsrc=\"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/4917825a-1aba-452d-ba41-b6e4104d39a0.png\"\r\n\t\t\t\t\t\t\twidth=\"70rpx\" height=\"70rpx\"></u--image>\r\n\t\t\t\t\t\t<view class=\"operation-title\" @click=\"sendImageMessage()\">图片</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"more-icon\" @click=\"sendVideoMessage()\">\r\n\t\t\t\t\t\t<u--image\r\n\t\t\t\t\t\t\tsrc=\"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/f6d1b8dc-68e4-4076-a2a7-b4dc7e73227d.png\"\r\n\t\t\t\t\t\t\twidth=\"70rpx\" height=\"70rpx\"></u--image>\r\n\t\t\t\t\t\t<view class=\"operation-title\" @click=\"sendVideoMessage()\">视频</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"more-icon\" @click=\"privateCall()\">\r\n\t\t\t\t\t\t<u--image\r\n\t\t\t\t\t\t\tsrc=\"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/d095f46a-cf09-4f94-b778-9013b158dc50.png\"\r\n\t\t\t\t\t\t\twidth=\"70rpx\" height=\"70rpx\"></u--image>\r\n\t\t\t\t\t\t<view class=\"operation-title\">视频通话</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"action-popup\" @touchmove.stop.prevent v-if=\"actionPopup.visible\">\r\n\t\t\t\t<view class=\"layer\"></view>\r\n\t\t\t\t<view class=\"action-list\">\r\n\t\t\t\t\t<view class=\"action-item\" @click=\"deleteSingleMessage\">删除</view>\r\n\t\t\t\t\t<view class=\"action-item\" v-if=\"actionPopup.recallable\" @click=\"recallMessage\">撤回</view>\r\n\t\t\t\t\t<view class=\"action-item\" @click=\"showCheckBox\">多选</view>\r\n\t\t\t\t\t<view class=\"action-item\" @click=\"hideActionPopup\">取消</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"messageSelector-box\" v-if=\"messageSelector.visible\">\r\n\t\t\t\t<image class=\"messageSelector-btn\" @click=\"deleteMultipleMessages\"\r\n\t\t\t\t\tsrc=\"https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/4afc537d-a916-4788-ab2f-81e4877001b4.png\">\r\n\t\t\t\t</image>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"record-loading\" v-if=\"recorderManager.recording\"></view>\r\n\t\t\t<video v-if=\"videoPlayer.visible\" :src=\"videoPlayer.url\" id=\"videoPlayer\"\r\n\t\t\t\t@fullscreenchange=\"onVideoFullScreenChange\"></video>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport EmojiDecoder from '@/lib/EmojiDecoder';\r\n\timport {\r\n\t\tformatDate\r\n\t} from '@/lib/utils';\r\n\timport RecorderManager from '@/lib/RecorderManager';\r\n\tconst IMAGE_MAX_WIDTH = 200;\r\n\tconst IMAGE_MAX_HEIGHT = 150;\r\n\tconst recorderManager = new RecorderManager();\r\n\tconst GoEasy = uni.$GoEasy;\r\n\texport default {\r\n\t\tname: 'privateChat',\r\n\t\tdata() {\r\n\t\t\tconst emojiUrl = 'https://imgcache.qq.com/open/qcloud/tim/assets/emoji/';\r\n\t\t\tconst emojiMap = {\r\n\t\t\t\t'[NO]': 'emoji_0@2x.png',\r\n\t\t\t\t'[OK]': 'emoji_1@2x.png',\r\n\t\t\t\t'[下雨]': 'emoji_2@2x.png',\r\n\t\t\t\t'[么么哒]': 'emoji_3@2x.png',\r\n\t\t\t\t'[乒乓]': 'emoji_4@2x.png',\r\n\t\t\t\t'[便便]': 'emoji_5@2x.png',\r\n\t\t\t\t'[信封]': 'emoji_6@2x.png',\r\n\t\t\t\t'[偷笑]': 'emoji_7@2x.png',\r\n\t\t\t\t'[傲慢]': 'emoji_8@2x.png',\r\n\t\t\t\t'[再见]': 'emoji_9@2x.png',\r\n\t\t\t\t'[冷汗]': 'emoji_10@2x.png',\r\n\t\t\t\t'[凋谢]': 'emoji_11@2x.png',\r\n\t\t\t\t'[刀]': 'emoji_12@2x.png',\r\n\t\t\t\t'[删除]': 'emoji_13@2x.png',\r\n\t\t\t\t'[勾引]': 'emoji_14@2x.png',\r\n\t\t\t\t'[发呆]': 'emoji_15@2x.png',\r\n\t\t\t\t'[发抖]': 'emoji_16@2x.png',\r\n\t\t\t\t'[可怜]': 'emoji_17@2x.png',\r\n\t\t\t\t'[可爱]': 'emoji_18@2x.png',\r\n\t\t\t\t'[右哼哼]': 'emoji_19@2x.png',\r\n\t\t\t\t'[右太极]': 'emoji_20@2x.png',\r\n\t\t\t\t'[右车头]': 'emoji_21@2x.png',\r\n\t\t\t\t'[吐]': 'emoji_22@2x.png',\r\n\t\t\t\t'[吓]': 'emoji_23@2x.png',\r\n\t\t\t\t'[咒骂]': 'emoji_24@2x.png',\r\n\t\t\t\t'[咖啡]': 'emoji_25@2x.png',\r\n\t\t\t\t'[啤酒]': 'emoji_26@2x.png',\r\n\t\t\t\t'[嘘]': 'emoji_27@2x.png',\r\n\t\t\t\t'[回头]': 'emoji_28@2x.png',\r\n\t\t\t\t'[困]': 'emoji_29@2x.png',\r\n\t\t\t\t'[坏笑]': 'emoji_30@2x.png',\r\n\t\t\t\t'[多云]': 'emoji_31@2x.png',\r\n\t\t\t\t'[大兵]': 'emoji_32@2x.png',\r\n\t\t\t\t'[大哭]': 'emoji_33@2x.png',\r\n\t\t\t\t'[太阳]': 'emoji_34@2x.png',\r\n\t\t\t\t'[奋斗]': 'emoji_35@2x.png',\r\n\t\t\t\t'[奶瓶]': 'emoji_36@2x.png',\r\n\t\t\t\t'[委屈]': 'emoji_37@2x.png',\r\n\t\t\t\t'[害羞]': 'emoji_38@2x.png',\r\n\t\t\t\t'[尴尬]': 'emoji_39@2x.png',\r\n\t\t\t\t'[左哼哼]': 'emoji_40@2x.png',\r\n\t\t\t\t'[左太极]': 'emoji_41@2x.png',\r\n\t\t\t\t'[左车头]': 'emoji_42@2x.png',\r\n\t\t\t\t'[差劲]': 'emoji_43@2x.png',\r\n\t\t\t\t'[弱]': 'emoji_44@2x.png',\r\n\t\t\t\t'[强]': 'emoji_45@2x.png',\r\n\t\t\t\t'[彩带]': 'emoji_46@2x.png',\r\n\t\t\t\t'[彩球]': 'emoji_47@2x.png',\r\n\t\t\t\t'[得意]': 'emoji_48@2x.png',\r\n\t\t\t\t'[微笑]': 'emoji_49@2x.png',\r\n\t\t\t\t'[心碎了]': 'emoji_50@2x.png',\r\n\t\t\t\t'[快哭了]': 'emoji_51@2x.png',\r\n\t\t\t\t'[怄火]': 'emoji_52@2x.png',\r\n\t\t\t\t'[怒]': 'emoji_53@2x.png',\r\n\t\t\t\t'[惊恐]': 'emoji_54@2x.png',\r\n\t\t\t\t'[惊讶]': 'emoji_55@2x.png',\r\n\t\t\t\t'[憨笑]': 'emoji_56@2x.png',\r\n\t\t\t\t'[手枪]': 'emoji_57@2x.png',\r\n\t\t\t\t'[打哈欠]': 'emoji_58@2x.png',\r\n\t\t\t\t'[抓狂]': 'emoji_59@2x.png',\r\n\t\t\t\t'[折磨]': 'emoji_60@2x.png',\r\n\t\t\t\t'[抠鼻]': 'emoji_61@2x.png',\r\n\t\t\t\t'[抱抱]': 'emoji_62@2x.png',\r\n\t\t\t\t'[抱拳]': 'emoji_63@2x.png',\r\n\t\t\t\t'[拳头]': 'emoji_64@2x.png',\r\n\t\t\t\t'[挥手]': 'emoji_65@2x.png',\r\n\t\t\t\t'[握手]': 'emoji_66@2x.png',\r\n\t\t\t\t'[撇嘴]': 'emoji_67@2x.png',\r\n\t\t\t\t'[擦汗]': 'emoji_68@2x.png',\r\n\t\t\t\t'[敲打]': 'emoji_69@2x.png',\r\n\t\t\t\t'[晕]': 'emoji_70@2x.png',\r\n\t\t\t\t'[月亮]': 'emoji_71@2x.png',\r\n\t\t\t\t'[棒棒糖]': 'emoji_72@2x.png',\r\n\t\t\t\t'[汽车]': 'emoji_73@2x.png',\r\n\t\t\t\t'[沙发]': 'emoji_74@2x.png',\r\n\t\t\t\t'[流汗]': 'emoji_75@2x.png',\r\n\t\t\t\t'[流泪]': 'emoji_76@2x.png',\r\n\t\t\t\t'[激动]': 'emoji_77@2x.png',\r\n\t\t\t\t'[灯泡]': 'emoji_78@2x.png',\r\n\t\t\t\t'[炸弹]': 'emoji_79@2x.png',\r\n\t\t\t\t'[熊猫]': 'emoji_80@2x.png',\r\n\t\t\t\t'[爆筋]': 'emoji_81@2x.png',\r\n\t\t\t\t'[爱你]': 'emoji_82@2x.png',\r\n\t\t\t\t'[爱心]': 'emoji_83@2x.png',\r\n\t\t\t\t'[爱情]': 'emoji_84@2x.png',\r\n\t\t\t\t'[猪头]': 'emoji_85@2x.png',\r\n\t\t\t\t'[猫咪]': 'emoji_86@2x.png',\r\n\t\t\t\t'[献吻]': 'emoji_87@2x.png',\r\n\t\t\t\t'[玫瑰]': 'emoji_88@2x.png',\r\n\t\t\t\t'[瓢虫]': 'emoji_89@2x.png',\r\n\t\t\t\t'[疑问]': 'emoji_90@2x.png',\r\n\t\t\t\t'[白眼]': 'emoji_91@2x.png',\r\n\t\t\t\t'[皮球]': 'emoji_92@2x.png',\r\n\t\t\t\t'[睡觉]': 'emoji_93@2x.png',\r\n\t\t\t\t'[磕头]': 'emoji_94@2x.png',\r\n\t\t\t\t'[示爱]': 'emoji_95@2x.png',\r\n\t\t\t\t'[礼品袋]': 'emoji_96@2x.png',\r\n\t\t\t\t'[礼物]': 'emoji_97@2x.png',\r\n\t\t\t\t'[篮球]': 'emoji_98@2x.png',\r\n\t\t\t\t'[米饭]': 'emoji_99@2x.png',\r\n\t\t\t\t'[糗大了]': 'emoji_100@2x.png',\r\n\t\t\t\t'[红双喜]': 'emoji_101@2x.png',\r\n\t\t\t\t'[红灯笼]': 'emoji_102@2x.png',\r\n\t\t\t\t'[纸巾]': 'emoji_103@2x.png',\r\n\t\t\t\t'[胜利]': 'emoji_104@2x.png',\r\n\t\t\t\t'[色]': 'emoji_105@2x.png',\r\n\t\t\t\t'[药]': 'emoji_106@2x.png',\r\n\t\t\t\t'[菜刀]': 'emoji_107@2x.png',\r\n\t\t\t\t'[蛋糕]': 'emoji_108@2x.png',\r\n\t\t\t\t'[蜡烛]': 'emoji_109@2x.png',\r\n\t\t\t\t'[街舞]': 'emoji_110@2x.png',\r\n\t\t\t\t'[衰]': 'emoji_111@2x.png',\r\n\t\t\t\t'[西瓜]': 'emoji_112@2x.png',\r\n\t\t\t\t'[调皮]': 'emoji_113@2x.png',\r\n\t\t\t\t'[象棋]': 'emoji_114@2x.png',\r\n\t\t\t\t'[跳绳]': 'emoji_115@2x.png',\r\n\t\t\t\t'[跳跳]': 'emoji_116@2x.png',\r\n\t\t\t\t'[车厢]': 'emoji_117@2x.png',\r\n\t\t\t\t'[转圈]': 'emoji_118@2x.png',\r\n\t\t\t\t'[鄙视]': 'emoji_119@2x.png',\r\n\t\t\t\t'[酷]': 'emoji_120@2x.png',\r\n\t\t\t\t'[钞票]': 'emoji_121@2x.png',\r\n\t\t\t\t'[钻戒]': 'emoji_122@2x.png',\r\n\t\t\t\t'[闪电]': 'emoji_123@2x.png',\r\n\t\t\t\t'[闭嘴]': 'emoji_124@2x.png',\r\n\t\t\t\t'[闹钟]': 'emoji_125@2x.png',\r\n\t\t\t\t'[阴险]': 'emoji_126@2x.png',\r\n\t\t\t\t'[难过]': 'emoji_127@2x.png',\r\n\t\t\t\t'[雨伞]': 'emoji_128@2x.png',\r\n\t\t\t\t'[青蛙]': 'emoji_129@2x.png',\r\n\t\t\t\t'[面条]': 'emoji_130@2x.png',\r\n\t\t\t\t'[鞭炮]': 'emoji_131@2x.png',\r\n\t\t\t\t'[风车]': 'emoji_132@2x.png',\r\n\t\t\t\t'[飞吻]': 'emoji_133@2x.png',\r\n\t\t\t\t'[飞机]': 'emoji_134@2x.png',\r\n\t\t\t\t'[饥饿]': 'emoji_135@2x.png',\r\n\t\t\t\t'[香蕉]': 'emoji_136@2x.png',\r\n\t\t\t\t'[骷髅]': 'emoji_137@2x.png',\r\n\t\t\t\t'[麦克风]': 'emoji_138@2x.png',\r\n\t\t\t\t'[麻将]': 'emoji_139@2x.png',\r\n\t\t\t\t'[鼓掌]': 'emoji_140@2x.png',\r\n\t\t\t\t'[龇牙]': 'emoji_141@2x.png'\r\n\t\t\t};\r\n\t\t\treturn {\r\n\t\t\t\t//聊天文本框\r\n\t\t\t\ttext: '',\r\n\t\t\t\tfriend: {\r\n\t\t\t\t\tid: '',\r\n\t\t\t\t\tname: '',\r\n\t\t\t\t\tavatar: ''\r\n\t\t\t\t},\r\n\t\t\t\tto: {}, // 作为createMessage的参数\r\n\t\t\t\tcurrentUser: null,\r\n\r\n\t\t\t\t//定义表情列表\r\n\t\t\t\temoji: {\r\n\t\t\t\t\turl: emojiUrl,\r\n\t\t\t\t\tmap: emojiMap,\r\n\t\t\t\t\tvisible: false,\r\n\t\t\t\t\tdecoder: new EmojiDecoder(emojiUrl, emojiMap),\r\n\t\t\t\t},\r\n\t\t\t\t//是否展示‘其他消息类型面板’\r\n\t\t\t\totherTypesMessagePanelVisible: false,\r\n\t\t\t\torderList: {\r\n\t\t\t\t\torders: [],\r\n\t\t\t\t\tvisible: false\r\n\t\t\t\t},\r\n\t\t\t\thistory: {\r\n\t\t\t\t\tmessages: [],\r\n\t\t\t\t\tallLoaded: false,\r\n\t\t\t\t\tloading: false\r\n\t\t\t\t},\r\n\t\t\t\trecorderManager: recorderManager,\r\n\t\t\t\taudio: {\r\n\t\t\t\t\t//录音按钮展示\r\n\t\t\t\t\tvisible: false\r\n\t\t\t\t},\r\n\t\t\t\taudioPlayer: {\r\n\t\t\t\t\tinnerAudioContext: null,\r\n\t\t\t\t\tplayingMessage: null,\r\n\t\t\t\t},\r\n\t\t\t\tvideoPlayer: {\r\n\t\t\t\t\tvisible: false,\r\n\t\t\t\t\turl: '',\r\n\t\t\t\t\tcontext: null\r\n\t\t\t\t},\r\n\t\t\t\t// 展示消息删除弹出框\r\n\t\t\t\tactionPopup: {\r\n\t\t\t\t\tvisible: false,\r\n\t\t\t\t\tmessage: null,\r\n\t\t\t\t\trecallable: false,\r\n\t\t\t\t},\r\n\t\t\t\t// 消息选择\r\n\t\t\t\tmessageSelector: {\r\n\t\t\t\t\tvisible: false,\r\n\t\t\t\t\tmessages: []\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(options) {\r\n\t\t\t//聊天对象\r\n\t\t\tthis.friend.id = options.to\r\n\t\t\tthis.friend.name = options.username\r\n\t\t\tthis.friend.avatar = options.avatar\r\n\t\t\tthis.currentUser = uni.getStorageSync('currentUser');\r\n\t\t\tthis.to = {\r\n\t\t\t\tid: this.friend.id,\r\n\t\t\t\ttype: GoEasy.IM_SCENE.PRIVATE,\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tname: this.friend.name,\r\n\t\t\t\t\tavatar: this.friend.avatar\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tthis.initGoEasyListeners();\r\n\t\t\t// 语音播放器\r\n\t\t\tthis.initialAudioPlayer();\r\n\t\t\t// 录音监听器\r\n\t\t\tthis.initRecorderListeners();\r\n\t\t},\r\n\t\tonShow() {\r\n\t\t\tthis.otherTypesMessagePanelVisible = false;\r\n\t\t\tthis.emoji.visible = false;\r\n\t\t},\r\n\t\tonReady() {\r\n\t\t\tthis.loadHistoryMessage(true);\r\n\t\t\tthis.videoPlayer.context = uni.createVideoContext('videoPlayer', this);\r\n\t\t\tuni.setNavigationBarTitle({\r\n\t\t\t\ttitle: this.friend.name\r\n\t\t\t});\r\n\t\t},\r\n\t\tonPullDownRefresh(e) {\r\n\t\t\tthis.loadHistoryMessage(false);\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\t//退出聊天页面之前，清空监听器\r\n\t\t\tGoEasy.im.off(GoEasy.IM_EVENT.PRIVATE_MESSAGE_RECEIVED, this.onMessageReceived);\r\n\t\t\tGoEasy.im.off(GoEasy.IM_EVENT.MESSAGE_DELETED, this.onMessageDeleted);\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tcancle() {\r\n\t\t\t\tuni.navigateBack()\r\n\t\t\t},\r\n\t\t\t//渲染文本消息，如果包含表情，替换为图片\r\n\t\t\trenderTextMessage(message) {\r\n\t\t\t\treturn '<span>' + this.emoji.decoder.decode(message.payload.text) + '</span>'\r\n\t\t\t},\r\n\t\t\t//像微信那样显示时间，如果有几分钟没发消息了，才显示时间\r\n\t\t\trenderMessageDate(message, index) {\r\n\t\t\t\tif (index === 0) {\r\n\t\t\t\t\treturn formatDate(message.timestamp)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (message.timestamp - this.history.messages[index - 1].timestamp > 5 * 60 * 1000) {\r\n\t\t\t\t\t\treturn formatDate(message.timestamp)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn '';\r\n\t\t\t},\r\n\t\t\tinitGoEasyListeners() {\r\n\t\t\t\t// 监听私聊消息\r\n\t\t\t\tGoEasy.im.on(GoEasy.IM_EVENT.PRIVATE_MESSAGE_RECEIVED, this.onMessageReceived);\r\n\t\t\t\t//监听消息删除\r\n\t\t\t\tGoEasy.im.on(GoEasy.IM_EVENT.MESSAGE_DELETED, this.onMessageDeleted);\r\n\t\t\t},\r\n\t\t\tonMessageReceived(message) {\r\n\t\t\t\tlet senderId = message.senderId;\r\n\t\t\t\tlet receiverId = message.receiverId;\r\n\t\t\t\tlet friendId = this.currentUser.userId.toString() === senderId ? receiverId : senderId;\r\n\t\t\t\tif (friendId === this.friend.id) {\r\n\t\t\t\t\tthis.history.messages.push(message);\r\n\t\t\t\t\t//聊天时，收到消息标记为已读\r\n\t\t\t\t\tthis.markPrivateMessageAsRead();\r\n\t\t\t\t\t//收到新消息，是滚动到最底部\r\n\t\t\t\t\tthis.scrollToBottom();\r\n\t\t\t\t\tuni.vibrateLong()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonMessageDeleted(deletedMessages) {\r\n\t\t\t\tdeletedMessages.forEach(message => {\r\n\t\t\t\t\tlet senderId = message.senderId;\r\n\t\t\t\t\tlet receiverId = message.receiverId;\r\n\t\t\t\t\tlet friendId = this.currentUser.userId.toString() === senderId ? receiverId : senderId;\r\n\t\t\t\t\tif (friendId === this.friend.id) {\r\n\t\t\t\t\t\tlet index = this.history.messages.indexOf(message);\r\n\t\t\t\t\t\tif (index > -1) {\r\n\t\t\t\t\t\t\tthis.history.messages.splice(index, 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tinitialAudioPlayer() {\r\n\t\t\t\tthis.audioPlayer.innerAudioContext = uni.createInnerAudioContext();\r\n\t\t\t\tthis.audioPlayer.innerAudioContext.onEnded(() => {\r\n\t\t\t\t\tthis.audioPlayer.playingMessage = null;\r\n\t\t\t\t});\r\n\t\t\t\tthis.audioPlayer.innerAudioContext.onStop(() => {\r\n\t\t\t\t\tthis.audioPlayer.playingMessage = null;\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tinitRecorderListeners() {\r\n\t\t\t\trecorderManager.onRecordComplete((file, duration) => {\r\n\t\t\t\t\tif (duration < 1000) {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\ttitle: '录音时间太短',\r\n\t\t\t\t\t\t\tduration: 500\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tGoEasy.im.createAudioMessage({\r\n\t\t\t\t\t\tto: this.to,\r\n\t\t\t\t\t\tfile: file,\r\n\t\t\t\t\t\tnotification: {\r\n\t\t\t\t\t\t\ttitle: this.currentUser.username + '发来一段语音',\r\n\t\t\t\t\t\t\tbody: '[语音消息]', // 字段最长 50 字符\r\n\t\t\t\t\t\t\tsound: 'message',\r\n\t\t\t\t\t\t\tbadge: '+1'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tonProgress: function(progress) {\r\n\t\t\t\t\t\t\tconsole.log(progress)\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tonSuccess: (message) => {\r\n\t\t\t\t\t\t\tthis.sendMessage(message);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tonFailed: (e) => {\r\n\t\t\t\t\t\t\tconsole.log('error :', e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 核心就是设置高度，产生明确占位\r\n\t\t\t *\r\n\t\t\t * 小  (宽度和高度都小于预设尺寸)\r\n\t\t\t *    设高=原始高度\r\n\t\t\t * 宽 (宽度>高度)\r\n\t\t\t *    高度= 根据宽度等比缩放\r\n\t\t\t * 窄  (宽度<高度)或方(宽度=高度)\r\n\t\t\t *    设高=MAX height\r\n\t\t\t *\r\n\t\t\t * @param width,height\r\n\t\t\t * @returns number\r\n\t\t\t */\r\n\t\t\tgetImageHeight(width, height) {\r\n\t\t\t\tif (width < IMAGE_MAX_WIDTH && height < IMAGE_MAX_HEIGHT) {\r\n\t\t\t\t\treturn height * 2;\r\n\t\t\t\t} else if (width > height) {\r\n\t\t\t\t\treturn (IMAGE_MAX_WIDTH / width * height) * 2;\r\n\t\t\t\t} else if (width === height || width < height) {\r\n\t\t\t\t\treturn IMAGE_MAX_HEIGHT * 2;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsendMessage(message) {\r\n\t\t\t\tthis.history.messages.push(message);\r\n\t\t\t\tthis.scrollToBottom();\r\n\t\t\t\tGoEasy.im.sendMessage({\r\n\t\t\t\t\tmessage: message,\r\n\t\t\t\t\tonSuccess: function(message) {\r\n\t\t\t\t\t\tconsole.log('发送成功.', message);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonFailed: function(error) {\r\n\t\t\t\t\t\tif (error.code === 507) {\r\n\t\t\t\t\t\t\tconsole.log(\r\n\t\t\t\t\t\t\t\t'发送语音/图片/视频/文件失败，没有配置OSS存储，详情参考：https://docs.goeasy.io/2.x/im/message/media/alioss'\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconsole.log('发送失败:', error);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tsendTextMessage() {\r\n\t\t\t\tif (this.text.trim() !== '') {\r\n\t\t\t\t\tlet body = this.text;\r\n\t\t\t\t\tif (this.text.length >= 200) {\r\n\t\t\t\t\t\tbody = this.text.substring(0, 190) + '...';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tGoEasy.im.createTextMessage({\r\n\t\t\t\t\t\ttext: this.text,\r\n\t\t\t\t\t\tto: this.to,\r\n\t\t\t\t\t\tnotification: {\r\n\t\t\t\t\t\t\ttitle: this.currentUser.username + '发来一段文字',\r\n\t\t\t\t\t\t\tbody: body,\r\n\t\t\t\t\t\t\tsound: 'message',\r\n\t\t\t\t\t\t\tbadge: '+1'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tonSuccess: (message) => {\r\n\t\t\t\t\t\t\tthis.sendMessage(message);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tonFailed: (e) => {\r\n\t\t\t\t\t\t\tconsole.log('error :', e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tthis.text = '';\r\n\t\t\t},\r\n\t\t\tsendVideoMessage() {\r\n\t\t\t\tuni.chooseVideo({\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tGoEasy.im.createVideoMessage({\r\n\t\t\t\t\t\t\tto: this.to,\r\n\t\t\t\t\t\t\tfile: res,\r\n\t\t\t\t\t\t\tnotification: {\r\n\t\t\t\t\t\t\t\ttitle: this.currentUser.username + '发来一个视频',\r\n\t\t\t\t\t\t\t\tbody: '[视频消息]', // 字段最长 50 字符\r\n\t\t\t\t\t\t\t\tsound: 'message',\r\n\t\t\t\t\t\t\t\tbadge: '+1'\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tonProgress: function(progress) {\r\n\t\t\t\t\t\t\t\tconsole.log(progress)\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tonSuccess: (message) => {\r\n\t\t\t\t\t\t\t\tthis.otherTypesMessagePanelVisible = false;\r\n\t\t\t\t\t\t\t\tthis.sendMessage(message);\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tonFailed: (e) => {\r\n\t\t\t\t\t\t\t\tconsole.log('error :', e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tsendImageMessage() {\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tcount: 9,\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tres.tempFiles.forEach(file => {\r\n\t\t\t\t\t\t\tGoEasy.im.createImageMessage({\r\n\t\t\t\t\t\t\t\tto: this.to,\r\n\t\t\t\t\t\t\t\tfile: file,\r\n\t\t\t\t\t\t\t\tnotification: {\r\n\t\t\t\t\t\t\t\t\ttitle: this.currentUser.username + '发来一张图片',\r\n\t\t\t\t\t\t\t\t\tbody: '[图片消息]', // 字段最长 50 字符\r\n\t\t\t\t\t\t\t\t\tsound: 'message',\r\n\t\t\t\t\t\t\t\t\tbadge: '+1'\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tonProgress: function(progress) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(progress)\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tonSuccess: (message) => {\r\n\t\t\t\t\t\t\t\t\tthis.otherTypesMessagePanelVisible = false;\r\n\t\t\t\t\t\t\t\t\tthis.sendMessage(message);\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tonFailed: (e) => {\r\n\t\t\t\t\t\t\t\t\tconsole.log('error :', e);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tshowActionPopup(message) {\r\n\t\t\t\tconst MAX_RECALLABLE_TIME = 3 * 60 * 1000; //3分钟以内的消息才可以撤回\r\n\t\t\t\tthis.messageSelector.messages = [message];\r\n\t\t\t\tif ((Date.now() - message.timestamp) < MAX_RECALLABLE_TIME && message.senderId === this.currentUser\r\n\t\t\t\t\t.id &&\r\n\t\t\t\t\tmessage.status === 'success') {\r\n\t\t\t\t\tthis.actionPopup.recallable = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.actionPopup.recallable = false;\r\n\t\t\t\t}\r\n\t\t\t\tthis.actionPopup.visible = true;\r\n\t\t\t},\r\n\t\t\thideActionPopup() {\r\n\t\t\t\tthis.actionPopup.visible = false;\r\n\t\t\t\tthis.actionPopup.message = null;\r\n\t\t\t},\r\n\t\t\tdeleteSingleMessage() {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\tcontent: '确认删除？',\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tthis.actionPopup.visible = false;\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\tthis.deleteMessage();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tdeleteMultipleMessages() {\r\n\t\t\t\tif (this.messageSelector.messages.length > 0) {\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\tcontent: '确认删除？',\r\n\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\tthis.messageSelector.visible = false;\r\n\t\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t\tthis.deleteMessage();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdeleteMessage() {\r\n\t\t\t\tGoEasy.im.deleteMessage({\r\n\t\t\t\t\tmessages: this.messageSelector.messages,\r\n\t\t\t\t\tonSuccess: (result) => {\r\n\t\t\t\t\t\tthis.messageSelector.messages.forEach(message => {\r\n\t\t\t\t\t\t\tlet index = this.history.messages.indexOf(message);\r\n\t\t\t\t\t\t\tif (index > -1) {\r\n\t\t\t\t\t\t\t\tthis.history.messages.splice(index, 1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tthis.messageSelector.messages = [];\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonFailed: (error) => {\r\n\t\t\t\t\t\tconsole.log('error:', error);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\trecallMessage() {\r\n\t\t\t\tthis.actionPopup.visible = false;\r\n\t\t\t\tGoEasy.im.recallMessage({\r\n\t\t\t\t\tmessages: this.messageSelector.messages,\r\n\t\t\t\t\tonSuccess: () => {\r\n\t\t\t\t\t\tconsole.log('撤回成功');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonFailed: (error) => {\r\n\t\t\t\t\t\tconsole.log('撤回失败,error:', error);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\teditRecalledMessage(text) {\r\n\t\t\t\tif (this.audio.visible) {\r\n\t\t\t\t\tthis.audio.visible = false;\r\n\t\t\t\t}\r\n\t\t\t\tthis.text = text;\r\n\t\t\t},\r\n\t\t\tshowCheckBox() {\r\n\t\t\t\tthis.messageSelector.messages = [];\r\n\t\t\t\tthis.messageSelector.visible = true;\r\n\t\t\t\tthis.actionPopup.visible = false;\r\n\t\t\t},\r\n\t\t\tselectMessages(e) {\r\n\t\t\t\tconst selectedMessageIds = e.detail.value;\r\n\t\t\t\tlet selectedMessages = [];\r\n\t\t\t\tthis.history.messages.forEach(message => {\r\n\t\t\t\t\tif (selectedMessageIds.includes(message.messageId)) {\r\n\t\t\t\t\t\tselectedMessages.push(message);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tthis.messageSelector.messages = selectedMessages;\r\n\t\t\t},\r\n\t\t\tloadHistoryMessage(scrollToBottom) { //历史消息\r\n\t\t\t\tthis.history.loading = true;\r\n\t\t\t\tlet lastMessageTimeStamp = null;\r\n\t\t\t\tlet lastMessage = this.history.messages[0];\r\n\t\t\t\tif (lastMessage) {\r\n\t\t\t\t\tlastMessageTimeStamp = lastMessage.timestamp;\r\n\t\t\t\t}\r\n\t\t\t\tGoEasy.im.history({\r\n\t\t\t\t\tid: this.friend.id,\r\n\t\t\t\t\tlastTimestamp: lastMessageTimeStamp,\r\n\t\t\t\t\tlimit: 10,\r\n\t\t\t\t\tonSuccess: (result) => {\r\n\t\t\t\t\t\tuni.stopPullDownRefresh();\r\n\t\t\t\t\t\tthis.history.loading = false;\r\n\t\t\t\t\t\tlet messages = result.content;\r\n\t\t\t\t\t\tif (messages.length === 0) {\r\n\t\t\t\t\t\t\tthis.history.allLoaded = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (lastMessageTimeStamp) {\r\n\t\t\t\t\t\t\t\tthis.history.messages = messages.concat(this.history.messages);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.history.messages = messages;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (messages.length < 10) {\r\n\t\t\t\t\t\t\t\tthis.history.allLoaded = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (scrollToBottom) {\r\n\t\t\t\t\t\t\t\tthis.scrollToBottom();\r\n\t\t\t\t\t\t\t\t//收到的消息设置为已读\r\n\t\t\t\t\t\t\t\tthis.markPrivateMessageAsRead();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonFailed: (error) => {\r\n\t\t\t\t\t\t//获取失败\r\n\t\t\t\t\t\tconsole.log('获取历史消息失败:', error);\r\n\t\t\t\t\t\tuni.stopPullDownRefresh();\r\n\t\t\t\t\t\tthis.history.loading = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t//语音录制按钮和键盘输入的切换\r\n\t\t\tswitchAudioKeyboard() {\r\n\t\t\t\tthis.audio.visible = !this.audio.visible;\r\n\t\t\t\tif (this.audio.visible) {\r\n\t\t\t\t\trecorderManager.authorize().then(() => {\r\n\t\t\t\t\t\tconsole.log('录音权限获取成功');\r\n\t\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\t\tconsole.log('err:', err)\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\ttitle: '获取录音权限失败',\r\n\t\t\t\t\t\t\tcontent: err\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonRecordStart() {\r\n\t\t\t\trecorderManager.start();\r\n\t\t\t},\r\n\t\t\tonRecordEnd() {\r\n\t\t\t\trecorderManager.stop();\r\n\t\t\t},\r\n\t\t\tshowImageFullScreen(e) {\r\n\t\t\t\tlet imagesUrl = [e.currentTarget.dataset.url];\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\turls: imagesUrl\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tplayVideo(e) {\r\n\t\t\t\tthis.videoPlayer.visible = true;\r\n\t\t\t\tthis.videoPlayer.url = e.currentTarget.dataset.url;\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tthis.videoPlayer.context.requestFullScreen({\r\n\t\t\t\t\t\tdirection: 0\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.videoPlayer.context.play();\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tplayAudio(audioMessage) {\r\n\t\t\t\tlet playingMessage = this.audioPlayer.playingMessage;\r\n\r\n\t\t\t\tif (playingMessage) {\r\n\t\t\t\t\tthis.audioPlayer.innerAudioContext.stop();\r\n\t\t\t\t\t// 如果点击的消息正在播放，就认为是停止播放操作\r\n\t\t\t\t\tif (playingMessage === audioMessage) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.audioPlayer.playingMessage = audioMessage;\r\n\t\t\t\tthis.audioPlayer.innerAudioContext.src = audioMessage.payload.url;\r\n\t\t\t\tthis.audioPlayer.innerAudioContext.play();\r\n\t\t\t},\r\n\t\t\tonVideoFullScreenChange(e) {\r\n\t\t\t\t//当退出全屏播放时，隐藏播放器\r\n\t\t\t\tif (this.videoPlayer.visible && !e.detail.fullScreen) {\r\n\t\t\t\t\tthis.videoPlayer.visible = false;\r\n\t\t\t\t\tthis.videoPlayer.context.stop();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmessageInputFocusin() {\r\n\t\t\t\tthis.otherTypesMessagePanelVisible = false;\r\n\t\t\t\tthis.emoji.visible = false;\r\n\t\t\t},\r\n\t\t\tswitchEmojiKeyboard() {\r\n\t\t\t\tthis.emoji.visible = !this.emoji.visible;\r\n\t\t\t\tthis.otherTypesMessagePanelVisible = false;\r\n\t\t\t},\r\n\t\t\tshowOtherTypesMessagePanel() {\r\n\t\t\t\tthis.otherTypesMessagePanelVisible = !this.otherTypesMessagePanelVisible;\r\n\t\t\t\tthis.emoji.visible = false;\r\n\t\t\t},\r\n\t\t\tchooseEmoji(emojiKey) {\r\n\t\t\t\tthis.text += emojiKey;\r\n\t\t\t},\r\n\t\t\tprivateCall() {\r\n\t\t\t\tuni.$showMsg('暂未完成！')\r\n\t\t\t\t// uni.showActionSheet({\r\n\t\t\t\t// \titemList: ['视频通话', '音频通话'],\r\n\t\t\t\t// \tsuccess: (res) => {\r\n\t\t\t\t// \t\tconst mediaType = res.tapIndex === 0 ? 1 : 0;\r\n\t\t\t\t// \t\tconst notificationBody = res.tapIndex === 0 ? '邀请你视频通话' : '邀请你语音通话';\r\n\t\t\t\t// \t\tGRTC.call({\r\n\t\t\t\t// \t\t\tcalleeId: this.friend.id,\r\n\t\t\t\t// \t\t\tmediaType: mediaType,\r\n\t\t\t\t// \t\t\tnotification: {\r\n\t\t\t\t// \t\t\t\ttitle: this.currentUser.username,\r\n\t\t\t\t// \t\t\t\tbody: notificationBody,\r\n\t\t\t\t// \t\t\t\tsound: 'ring',\r\n\t\t\t\t// \t\t\t\tbadge: '+1'\r\n\t\t\t\t// \t\t\t},\r\n\t\t\t\t// \t\t}).then(() => {\r\n\t\t\t\t// \t\t\tuni.navigateTo({\r\n\t\t\t\t// \t\t\t\turl: `/rtcPages/private/dial`,\r\n\t\t\t\t// \t\t\t})\r\n\t\t\t\t// \t\t}).catch((error) => {\r\n\t\t\t\t// \t\t\tconsole.log(\"呼叫失败:\", error);\r\n\t\t\t\t// \t\t\tuni.showToast({\r\n\t\t\t\t// \t\t\t\ticon: \"error\",\r\n\t\t\t\t// \t\t\t\ttitle: \"呼叫失败:\" + error,\r\n\t\t\t\t// \t\t\t\tduration: 2000\r\n\t\t\t\t// \t\t\t})\r\n\t\t\t\t// \t\t})\r\n\t\t\t\t// \t},\r\n\t\t\t\t// \tfail: (res) => {\r\n\t\t\t\t// \t\tconsole.log(res.errMsg);\r\n\t\t\t\t// \t}\r\n\t\t\t\t// });\r\n\t\t\t},\r\n\t\t\tscrollToBottom() {\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tuni.pageScrollTo({\r\n\t\t\t\t\t\tscrollTop: 2000000,\r\n\t\t\t\t\t\tduration: 0\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tmarkPrivateMessageAsRead() {\r\n\t\t\t\tGoEasy.im.markMessageAsRead({\r\n\t\t\t\t\tid: this.to.id,\r\n\t\t\t\t\ttype: this.to.type,\r\n\t\t\t\t\tonSuccess: function() {\r\n\t\t\t\t\t\tconsole.log('标记私聊已读成功');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonFailed: function(error) {\r\n\t\t\t\t\t\tconsole.log(\"标记私聊已读失败\", error);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t@import url('../static/style/chatInterface.css');\r\n</style>","import mod from \"-!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./privateChat.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./privateChat.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1714124055340\n      var cssReload = require(\"E:/微信小程序/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}