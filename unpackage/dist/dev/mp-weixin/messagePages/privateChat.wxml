<view><view data-event-opts="{{[['contextmenu',[['',['$event']]]]]}}" class="chatInterface" bindcontextmenu="__e"><scroll-view scroll-y="{{true}}"><view class="scroll-view"><block wx:if="{{history.loading}}"><image class="history-loaded" src="https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/a20764d7-3552-44f9-b046-b4edefa689a5.svg"></image></block><block wx:else><view data-event-opts="{{[['tap',[['loadHistoryMessage',[false]]]]]}}" class="{{[history.allLoaded?'history-loaded':'load']}}" bindtap="__e"><view>{{history.allLoaded?'':'点击获取历史消息'}}</view></view></block><checkbox-group data-event-opts="{{[['change',[['selectMessages',['$event']]]]]}}" bindchange="__e"><block wx:for="{{$root.l0}}" wx:for-item="message" wx:for-index="index" wx:key="messageId"><view><view class="time-lag">{{''+message.m0+''}}</view><block wx:if="{{message.$orig.recalled}}"><view class="message-recalled"><block wx:if="{{message.$orig.recaller.id===message.g0}}"><view class="message-recalled-self"><view>你撤回了一条消息</view><block wx:if="{{message.g1}}"><label data-event-opts="{{[['tap',[['editRecalledMessage',['$0'],[[['history.messages','messageId',message.$orig.messageId,'payload.text']]]]]]]}}" bindtap="__e" class="_span">重新编辑</label></block></view></block><block wx:else><view>{{message.$orig.recaller.data.name+"撤回了一条消息"}}</view></block></view></block><block wx:else><view class="message-item"><view class="message-item-checkbox"><checkbox hidden="{{!(messageSelector.visible&&message.$orig.status!=='sending')}}" value="{{message.$orig.messageId}}" checked="{{message.g2}}"></checkbox></view><view class="{{['message-item-content',(message.$orig.senderId===message.g3)?'self':'']}}"><view class="avatar"><image src="{{message.$orig.senderId===message.g4?currentUser.avatar:friend.avatar}}"></image></view><view data-event-opts="{{[['contextmenu',[['showActionPopup',['$0'],[[['history.messages','messageId',message.$orig.messageId]]]]]],['longpress',[['showActionPopup',['$0'],[[['history.messages','messageId',message.$orig.messageId]]]]]]]}}" class="content" bindcontextmenu="__e" bindlongpress="__e"><view class="message-payload"><block wx:if="{{message.$orig.status==='sending'}}"><view class="pending _b"></view></block><block wx:if="{{message.$orig.status==='fail'}}"><view class="send-fail _b"></view></block><block wx:if="{{message.$orig.type==='text'}}"><view class="text-content" style="{{'background:'+(message.$orig.senderId===message.g5?'#b2d235':'#fff')+';'}}"><rich-text nodes="{{message.m1}}"></rich-text></view></block><block wx:if="{{message.$orig.type==='image'}}"><image class="image-content" data-url="{{message.$orig.payload.url}}" src="{{message.$orig.payload.thumbnail}}" mode="heightFix" data-event-opts="{{[['tap',[['showImageFullScreen',['$event']]]]]}}" bindtap="__e"></image></block><block wx:if="{{message.$orig.type==='video'}}"><view class="video-snapshot" data-url="{{message.$orig.payload.video.url}}" data-event-opts="{{[['tap',[['playVideo',['$event']]]]]}}" bindtap="__e"><image style="{{'height:'+(message.m2+'rpx')+';'}}" src="{{message.$orig.payload.thumbnail.url}}" mode="heightFix"></image><view class="video-play-icon"></view></view></block><block wx:if="{{message.$orig.type==='file'}}"><view class="file-content"><view class="file-info"><label class="file-name _span">{{message.$orig.payload.name}}</label><label class="file-size _span">{{message.g6+"KB"}}</label></view><image class="file-img" src="https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/3bc4d574-ee5a-4b5f-adce-e517600884f6.png"></image></view></block><block wx:if="{{message.$orig.type==='audio'}}"><view data-event-opts="{{[['tap',[['playAudio',['$0'],[[['history.messages','messageId',message.$orig.messageId]]]]]]]}}" class="audio-content" bindtap="__e"><view class="audio-facade" style="{{'width:'+(message.g7*7+50+'px')+';'}}"><view class="{{['audio-facade-bg',(audioPlayer.playingMessage&&audioPlayer.playingMessage.messageId===message.$orig.messageId)?'play-icon':'']}}"></view><view>{{message.g8}}<label class="_span">"</label></view></view></view></block></view><block wx:if="{{message.$orig.senderId===message.g9}}"><view class="{{[message.$orig.read?'message-read':'message-unread']}}"><block wx:if="{{message.$orig.status==='success'}}"><view style="font-size:24rpx;">{{''+(message.$orig.read?'已读':'未读')+''}}</view></block></view></block></view></view></view></block></view></block></checkbox-group></view></scroll-view><block wx:if="{{!videoPlayer.visible&&!messageSelector.visible}}"><view class="action-box"><view class="action-top"><view data-event-opts="{{[['tap',[['switchAudioKeyboard',['$event']]]]]}}" bindtap="__e"><block wx:if="{{audio.visible}}"><image class="more" src="https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/0a3d0722-0088-4183-963f-d67c1e854ea0.png"></image></block><block wx:else><image class="more" src="https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/0e6e759e-58ea-4f55-9af8-361b71febefd.png"></image></block></view><block wx:if="{{audio.visible}}"><view data-event-opts="{{[['touchend',[['onRecordEnd',['$event']]]],['touchstart',[['onRecordStart',['$event']]]]]}}" class="record-input" catchtouchend="__e" catchtouchstart="__e">{{''+(recorderManager.recording?'松开发送':'按住录音')+''}}</view></block><block wx:else><input class="consult-input" maxlength="700" placeholder="发送消息" type="text" data-event-opts="{{[['confirm',[['sendTextMessage',['$event']]]],['input',[['__set_model',['','text','$event',[]]]]]]}}" value="{{text}}" bindconfirm="__e" bindinput="__e"/></block><view data-event-opts="{{[['tap',[['switchEmojiKeyboard',['$event']]]]]}}" bindtap="__e"><block wx:if="{{emoji.visible}}"><image class="more" src="https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/0a3d0722-0088-4183-963f-d67c1e854ea0.png"></image></block><block wx:else><image class="more" src="https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/29da9893-822a-4c2c-9c61-d584f46a76d0.png"></image></block></view><view><image class="more" src="https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/37c2a7b6-d727-4127-9653-dffc77091d70.png" data-event-opts="{{[['tap',[['showOtherTypesMessagePanel']]]]}}" bindtap="__e"></image></view><block wx:if="{{text}}"><view class="send-btn-box"><text data-event-opts="{{[['tap',[['sendTextMessage']]]]}}" class="btn" bindtap="__e">发送</text></view></block></view><scroll-view scroll-y="{{true}}"><block wx:if="{{emoji.visible}}"><view class="action-bottom action-bottom-emoji"><block wx:for="{{$root.l1}}" wx:for-item="emojiItem" wx:for-index="emojiKey" wx:key="$index"><image class="emoji-item" src="{{emoji.url+emojiItem.$orig}}" data-event-opts="{{[['tap',[['chooseEmoji',[emojiKey]]]]]}}" bindtap="__e"></image></block></view></block><view style="margin-bottom:30rpx;"></view></scroll-view><block wx:if="{{otherTypesMessagePanelVisible}}"><view class="action-bottom"><view data-event-opts="{{[['tap',[['sendImageMessage']]]]}}" class="more-icon" bindtap="__e"><u--image vue-id="33ad5b22-1" src="https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/4917825a-1aba-452d-ba41-b6e4104d39a0.png" width="70rpx" height="70rpx" bind:__l="__l"></u--image><view data-event-opts="{{[['tap',[['sendImageMessage']]]]}}" class="operation-title" bindtap="__e">图片</view></view><view data-event-opts="{{[['tap',[['sendVideoMessage']]]]}}" class="more-icon" bindtap="__e"><u--image vue-id="33ad5b22-2" src="https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/f6d1b8dc-68e4-4076-a2a7-b4dc7e73227d.png" width="70rpx" height="70rpx" bind:__l="__l"></u--image><view data-event-opts="{{[['tap',[['sendVideoMessage']]]]}}" class="operation-title" bindtap="__e">视频</view></view><view data-event-opts="{{[['tap',[['privateCall']]]]}}" class="more-icon" bindtap="__e"><u--image vue-id="33ad5b22-3" src="https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/d095f46a-cf09-4f94-b778-9013b158dc50.png" width="70rpx" height="70rpx" bind:__l="__l"></u--image><view class="operation-title">视频通话</view></view></view></block></view></block><block wx:if="{{actionPopup.visible}}"><view data-event-opts="{{[['touchmove',[['',['$event']]]]]}}" class="action-popup" catchtouchmove="__e"><view class="layer"></view><view class="action-list"><view data-event-opts="{{[['tap',[['deleteSingleMessage',['$event']]]]]}}" class="action-item" bindtap="__e">删除</view><block wx:if="{{actionPopup.recallable}}"><view data-event-opts="{{[['tap',[['recallMessage',['$event']]]]]}}" class="action-item" bindtap="__e">撤回</view></block><view data-event-opts="{{[['tap',[['showCheckBox',['$event']]]]]}}" class="action-item" bindtap="__e">多选</view><view data-event-opts="{{[['tap',[['hideActionPopup',['$event']]]]]}}" class="action-item" bindtap="__e">取消</view></view></view></block><block wx:if="{{messageSelector.visible}}"><view class="messageSelector-box"><image class="messageSelector-btn" src="https://wangzhenghai-oss.oss-cn-hangzhou.aliyuncs.com/4afc537d-a916-4788-ab2f-81e4877001b4.png" data-event-opts="{{[['tap',[['deleteMultipleMessages',['$event']]]]]}}" bindtap="__e"></image></view></block><block wx:if="{{recorderManager.recording}}"><view class="record-loading"></view></block><block wx:if="{{videoPlayer.visible}}"><video src="{{videoPlayer.url}}" id="videoPlayer" data-event-opts="{{[['fullscreenchange',[['onVideoFullScreenChange',['$event']]]]]}}" bindfullscreenchange="__e"></video></block></view></view>